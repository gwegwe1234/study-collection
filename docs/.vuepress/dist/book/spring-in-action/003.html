<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.d9b30d9c.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.4f5f64cd.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.5e892776.js" as="script"><link rel="preload" href="/study-collection/assets/js/76.e409a605.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.5f5c5821.js"><link rel="prefetch" href="/study-collection/assets/js/100.79f89c7f.js"><link rel="prefetch" href="/study-collection/assets/js/101.62f2a263.js"><link rel="prefetch" href="/study-collection/assets/js/102.2a015e66.js"><link rel="prefetch" href="/study-collection/assets/js/103.9b84bea5.js"><link rel="prefetch" href="/study-collection/assets/js/104.421d6428.js"><link rel="prefetch" href="/study-collection/assets/js/105.0a132d4c.js"><link rel="prefetch" href="/study-collection/assets/js/106.e581c211.js"><link rel="prefetch" href="/study-collection/assets/js/107.1cc79a91.js"><link rel="prefetch" href="/study-collection/assets/js/108.df0beb06.js"><link rel="prefetch" href="/study-collection/assets/js/109.fe44f17c.js"><link rel="prefetch" href="/study-collection/assets/js/11.268fb45c.js"><link rel="prefetch" href="/study-collection/assets/js/110.bd1c37d9.js"><link rel="prefetch" href="/study-collection/assets/js/111.3a334f3d.js"><link rel="prefetch" href="/study-collection/assets/js/112.dabde6b4.js"><link rel="prefetch" href="/study-collection/assets/js/113.15600039.js"><link rel="prefetch" href="/study-collection/assets/js/114.4fb2f335.js"><link rel="prefetch" href="/study-collection/assets/js/115.3be630ba.js"><link rel="prefetch" href="/study-collection/assets/js/116.4a4f9eac.js"><link rel="prefetch" href="/study-collection/assets/js/117.8f63d11b.js"><link rel="prefetch" href="/study-collection/assets/js/118.dd9b4805.js"><link rel="prefetch" href="/study-collection/assets/js/119.d061ae41.js"><link rel="prefetch" href="/study-collection/assets/js/12.946b7d38.js"><link rel="prefetch" href="/study-collection/assets/js/120.f14ccb7b.js"><link rel="prefetch" href="/study-collection/assets/js/121.d99d809f.js"><link rel="prefetch" href="/study-collection/assets/js/122.55d91c29.js"><link rel="prefetch" href="/study-collection/assets/js/123.86026058.js"><link rel="prefetch" href="/study-collection/assets/js/124.24ae0a19.js"><link rel="prefetch" href="/study-collection/assets/js/125.2b1d65ce.js"><link rel="prefetch" href="/study-collection/assets/js/126.2f16721a.js"><link rel="prefetch" href="/study-collection/assets/js/127.fd703755.js"><link rel="prefetch" href="/study-collection/assets/js/128.3a944092.js"><link rel="prefetch" href="/study-collection/assets/js/129.9691bffb.js"><link rel="prefetch" href="/study-collection/assets/js/13.1d6a6900.js"><link rel="prefetch" href="/study-collection/assets/js/130.3639b984.js"><link rel="prefetch" href="/study-collection/assets/js/131.828b8141.js"><link rel="prefetch" href="/study-collection/assets/js/132.b4c2f398.js"><link rel="prefetch" href="/study-collection/assets/js/133.1c17baf3.js"><link rel="prefetch" href="/study-collection/assets/js/134.6b91c316.js"><link rel="prefetch" href="/study-collection/assets/js/135.2e9884a2.js"><link rel="prefetch" href="/study-collection/assets/js/136.d7bd9b0e.js"><link rel="prefetch" href="/study-collection/assets/js/137.03b844ad.js"><link rel="prefetch" href="/study-collection/assets/js/138.c8d478de.js"><link rel="prefetch" href="/study-collection/assets/js/139.bdf6c163.js"><link rel="prefetch" href="/study-collection/assets/js/14.fe0249b2.js"><link rel="prefetch" href="/study-collection/assets/js/140.42eb003d.js"><link rel="prefetch" href="/study-collection/assets/js/141.2b72f8fb.js"><link rel="prefetch" href="/study-collection/assets/js/142.3363b327.js"><link rel="prefetch" href="/study-collection/assets/js/143.717432d8.js"><link rel="prefetch" href="/study-collection/assets/js/144.2db69140.js"><link rel="prefetch" href="/study-collection/assets/js/145.0920bb84.js"><link rel="prefetch" href="/study-collection/assets/js/146.dd2b16e9.js"><link rel="prefetch" href="/study-collection/assets/js/147.13a52162.js"><link rel="prefetch" href="/study-collection/assets/js/148.ef42dbea.js"><link rel="prefetch" href="/study-collection/assets/js/149.ebb7d715.js"><link rel="prefetch" href="/study-collection/assets/js/15.274ebfb3.js"><link rel="prefetch" href="/study-collection/assets/js/150.11fc2617.js"><link rel="prefetch" href="/study-collection/assets/js/151.f22056ba.js"><link rel="prefetch" href="/study-collection/assets/js/152.f3cfc06e.js"><link rel="prefetch" href="/study-collection/assets/js/153.a27a80b1.js"><link rel="prefetch" href="/study-collection/assets/js/154.833af25a.js"><link rel="prefetch" href="/study-collection/assets/js/155.2ef74b89.js"><link rel="prefetch" href="/study-collection/assets/js/156.ab2221c0.js"><link rel="prefetch" href="/study-collection/assets/js/16.b554b708.js"><link rel="prefetch" href="/study-collection/assets/js/17.fb29732f.js"><link rel="prefetch" href="/study-collection/assets/js/18.36b9d818.js"><link rel="prefetch" href="/study-collection/assets/js/19.39391880.js"><link rel="prefetch" href="/study-collection/assets/js/20.b7aa2612.js"><link rel="prefetch" href="/study-collection/assets/js/21.a24d9397.js"><link rel="prefetch" href="/study-collection/assets/js/22.db1a83c2.js"><link rel="prefetch" href="/study-collection/assets/js/23.db6234b3.js"><link rel="prefetch" href="/study-collection/assets/js/24.0b462536.js"><link rel="prefetch" href="/study-collection/assets/js/25.aa0fd03f.js"><link rel="prefetch" href="/study-collection/assets/js/26.2ad9b1ca.js"><link rel="prefetch" href="/study-collection/assets/js/27.fbdc549e.js"><link rel="prefetch" href="/study-collection/assets/js/28.887c1bce.js"><link rel="prefetch" href="/study-collection/assets/js/29.e3b0af97.js"><link rel="prefetch" href="/study-collection/assets/js/3.7d4df81e.js"><link rel="prefetch" href="/study-collection/assets/js/30.64f824b8.js"><link rel="prefetch" href="/study-collection/assets/js/31.2d8b7425.js"><link rel="prefetch" href="/study-collection/assets/js/32.864c4ef5.js"><link rel="prefetch" href="/study-collection/assets/js/33.ed26c461.js"><link rel="prefetch" href="/study-collection/assets/js/34.deb6597a.js"><link rel="prefetch" href="/study-collection/assets/js/35.d6a81b2e.js"><link rel="prefetch" href="/study-collection/assets/js/36.59ab6b64.js"><link rel="prefetch" href="/study-collection/assets/js/37.6550abc2.js"><link rel="prefetch" href="/study-collection/assets/js/38.b5e42513.js"><link rel="prefetch" href="/study-collection/assets/js/39.2de0197c.js"><link rel="prefetch" href="/study-collection/assets/js/4.08f2d1b0.js"><link rel="prefetch" href="/study-collection/assets/js/40.5e244a7f.js"><link rel="prefetch" href="/study-collection/assets/js/41.9a892199.js"><link rel="prefetch" href="/study-collection/assets/js/42.36d1b696.js"><link rel="prefetch" href="/study-collection/assets/js/43.00cb2d75.js"><link rel="prefetch" href="/study-collection/assets/js/44.866b3bb7.js"><link rel="prefetch" href="/study-collection/assets/js/45.a5e56880.js"><link rel="prefetch" href="/study-collection/assets/js/46.19fe51c7.js"><link rel="prefetch" href="/study-collection/assets/js/47.483b753c.js"><link rel="prefetch" href="/study-collection/assets/js/48.4f878869.js"><link rel="prefetch" href="/study-collection/assets/js/49.c8d87dc1.js"><link rel="prefetch" href="/study-collection/assets/js/5.0aa6b6fb.js"><link rel="prefetch" href="/study-collection/assets/js/50.fd8b91c1.js"><link rel="prefetch" href="/study-collection/assets/js/51.b901f3e0.js"><link rel="prefetch" href="/study-collection/assets/js/52.b433b37c.js"><link rel="prefetch" href="/study-collection/assets/js/53.256cd3d3.js"><link rel="prefetch" href="/study-collection/assets/js/54.4536ebc5.js"><link rel="prefetch" href="/study-collection/assets/js/55.8c9fc3cc.js"><link rel="prefetch" href="/study-collection/assets/js/56.16550368.js"><link rel="prefetch" href="/study-collection/assets/js/57.73c16a7d.js"><link rel="prefetch" href="/study-collection/assets/js/58.8913edfe.js"><link rel="prefetch" href="/study-collection/assets/js/59.9e8bb394.js"><link rel="prefetch" href="/study-collection/assets/js/6.c13e11f3.js"><link rel="prefetch" href="/study-collection/assets/js/60.cf3a4199.js"><link rel="prefetch" href="/study-collection/assets/js/61.5cb9025c.js"><link rel="prefetch" href="/study-collection/assets/js/62.78c69753.js"><link rel="prefetch" href="/study-collection/assets/js/63.2e8d224e.js"><link rel="prefetch" href="/study-collection/assets/js/64.61f0a8c4.js"><link rel="prefetch" href="/study-collection/assets/js/65.7c467bd7.js"><link rel="prefetch" href="/study-collection/assets/js/66.12c25cae.js"><link rel="prefetch" href="/study-collection/assets/js/67.f141029f.js"><link rel="prefetch" href="/study-collection/assets/js/68.e6fc698f.js"><link rel="prefetch" href="/study-collection/assets/js/69.09d1de11.js"><link rel="prefetch" href="/study-collection/assets/js/7.db13a9f9.js"><link rel="prefetch" href="/study-collection/assets/js/70.ec30d3ae.js"><link rel="prefetch" href="/study-collection/assets/js/71.dd4e50ba.js"><link rel="prefetch" href="/study-collection/assets/js/72.bd6ab5c8.js"><link rel="prefetch" href="/study-collection/assets/js/73.4f60cc6d.js"><link rel="prefetch" href="/study-collection/assets/js/74.1f579edf.js"><link rel="prefetch" href="/study-collection/assets/js/75.af370df4.js"><link rel="prefetch" href="/study-collection/assets/js/77.e4ab3a4f.js"><link rel="prefetch" href="/study-collection/assets/js/78.f1a78d30.js"><link rel="prefetch" href="/study-collection/assets/js/79.1a0edc83.js"><link rel="prefetch" href="/study-collection/assets/js/8.b620357c.js"><link rel="prefetch" href="/study-collection/assets/js/80.8ab76479.js"><link rel="prefetch" href="/study-collection/assets/js/81.4ae4589d.js"><link rel="prefetch" href="/study-collection/assets/js/82.a7940c2b.js"><link rel="prefetch" href="/study-collection/assets/js/83.fc044f05.js"><link rel="prefetch" href="/study-collection/assets/js/84.4d84387e.js"><link rel="prefetch" href="/study-collection/assets/js/85.6a275e91.js"><link rel="prefetch" href="/study-collection/assets/js/86.e58a1bc3.js"><link rel="prefetch" href="/study-collection/assets/js/87.f5d699f6.js"><link rel="prefetch" href="/study-collection/assets/js/88.c33a95ef.js"><link rel="prefetch" href="/study-collection/assets/js/89.25932ca0.js"><link rel="prefetch" href="/study-collection/assets/js/9.35ede549.js"><link rel="prefetch" href="/study-collection/assets/js/90.3d792880.js"><link rel="prefetch" href="/study-collection/assets/js/91.0950a526.js"><link rel="prefetch" href="/study-collection/assets/js/92.08c3a697.js"><link rel="prefetch" href="/study-collection/assets/js/93.80f72687.js"><link rel="prefetch" href="/study-collection/assets/js/94.69748e0f.js"><link rel="prefetch" href="/study-collection/assets/js/95.199ab735.js"><link rel="prefetch" href="/study-collection/assets/js/96.96d118fd.js"><link rel="prefetch" href="/study-collection/assets/js/97.b9caac65.js"><link rel="prefetch" href="/study-collection/assets/js/98.1ef00c38.js"><link rel="prefetch" href="/study-collection/assets/js/99.92514737.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.d9b30d9c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>스프링 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/spring-in-action/001.html" class="sidebar-link">1장 스프링 속으로</a></li><li><a href="/study-collection/book/spring-in-action/002.html" class="sidebar-link">2장 빈 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/003.html" class="active sidebar-link">3장 고급 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/004.html" class="sidebar-link">4장 애스펙트 지향 스프링</a></li><li><a href="/study-collection/book/spring-in-action/005.html" class="sidebar-link">5장 스프링 웹 어플리케이션 만들기</a></li><li><a href="/study-collection/book/spring-in-action/006.html" class="sidebar-link">6장 웹 뷰 렌더링</a></li><li><a href="/study-collection/book/spring-in-action/007.html" class="sidebar-link">7장 고급 스프링MVC</a></li><li><a href="/study-collection/book/spring-in-action/008.html" class="sidebar-link">8장 스프링 웹플로로 작업하기</a></li><li><a href="/study-collection/book/spring-in-action/009.html" class="sidebar-link">9장 웹 어플리케이션 보안</a></li><li><a href="/study-collection/book/spring-in-action/010.html" class="sidebar-link">10장 스프링과 JDBC를 사용하여 데이터베이스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/011.html" class="sidebar-link">11장 객체 관계형 매핑을 통한 데이터 퍼시스팅</a></li><li><a href="/study-collection/book/spring-in-action/012.html" class="sidebar-link">12장 NoSQL 데이터베이스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/013.html" class="sidebar-link">13장 데이터 캐싱하기</a></li><li><a href="/study-collection/book/spring-in-action/014.html" class="sidebar-link">14장 시큐리티 메소드</a></li><li><a href="/study-collection/book/spring-in-action/015.html" class="sidebar-link">15장 원격 서비스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/016.html" class="sidebar-link">16장 스프링 MVC로 REST API 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/017.html" class="sidebar-link">17장 스프링 메시징</a></li><li><a href="/study-collection/book/spring-in-action/018.html" class="sidebar-link">18장 WebSocket과 STOMP를 사용하여 메시징하기</a></li><li><a href="/study-collection/book/spring-in-action/019.html" class="sidebar-link">19장 이메일 전송을 위해 스프링 설정하기</a></li><li><a href="/study-collection/book/spring-in-action/020.html" class="sidebar-link">20장 JMX를 이용한 스프링 빈 관리</a></li><li><a href="/study-collection/book/spring-in-action/021.html" class="sidebar-link">21장 스프링 부트를 사용한 스프링 개발 간소화</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>고 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Go 언어를 활용한 마이크로서비스 개발</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>카프카 스트림즈 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>모던 자바 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>객체지향의 사실과 오해</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>뇌를 자극하는 윈도우즈 시스템 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링5를 활용한 리액티브 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3강"><a href="#_3강" class="header-anchor">#</a> 3강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-환경과-프로필">1. 환경과 프로필</a></li><li><a href="#_2-빈-프로필-설정">2. 빈 프로필 설정</a></li><li><a href="#_3-프로필-활성화">3. 프로필 활성화</a></li><li><a href="#_4-조건부-빈">4. 조건부 빈</a></li><li><a href="#_4-오토와이어링의-모호성">4. 오토와이어링의 모호성</a><ul><li><a href="#_4-1-기본빈-지정-primary">4-1. 기본빈 지정 (@Primary)</a></li><li><a href="#_4-2-이름주기-qualifier">4-2. 이름주기 (@Qualifier)</a></li></ul></li><li><a href="#_5-빈-범위">5. 빈 범위</a></li><li><a href="#_6-런타임-값-주입">6. 런타임 값 주입</a></li><li><a href="#_7-spel">7. SpEL</a></li></ul></div><p></p> <h2 id="_1-환경과-프로필"><a href="#_1-환경과-프로필" class="header-anchor">#</a> 1. 환경과 프로필</h2> <ul><li>소프트웨어 개발 시 특정 환경에서 다른 어플리케이션으로 마이그레이션 하는일은 어렵다.</li> <li>로컬 / 테스트환경에서 잘 동작하던 프로젝트가 상용에서 안돌다던지</li> <li>DB의 예시를 들면 개발환경에서 특정 내장된 테스트 데이터를 이용해 사용한다고 가정해보자.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod<span class="token operator">=</span><span class="token string">&quot;shutdown&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EmbededDatabaseBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:schema.sql&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:test-data.sql&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 스프링 구성 클래스에서는 EmbededDatabaseBuilder를 사용한다.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 하면 schema.sql로 스키마를 생성하고, test-data.sql로 데이터를 세팅한다.</li> <li>이런건 개발환경에서 테스트하기엔 매우 좋지만, 상용에선 매우 구리다.</li> <li>이유를 생각해보면, 새로운 데이터를 추가하거나 하려면 소스내부를 수정해야 되는거같음</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Datasource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JndiObjectFactoryBean</span> jndiObjectFactoryBean <span class="token operator">=</span> 
        <span class="token keyword">new</span> <span class="token class-name">JndiObjectFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setJndiName</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc/myDS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setResourceRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setProxyInterface</span><span class="token punctuation">(</span>javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Datasource</span><span class="token punctuation">)</span> jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위에처럼 jndi로 관리해주면, 상용에서 사용해주기 조금더 좋다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod<span class="token operator">=</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSoruce</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BasicDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>위에는 BasicDataSource 자료형으로 객체를 생성해 일일히 설정을 세팅해주는 방법이다.</p></li> <li><p>책에선 QA설정이라고 나와있는데, 우린 local / sandbox 설정 할 때 저렇게해줌.</p></li> <li><p>여기서 중요한건 결국 데이터소스를 어떻게 설정하는지가 중요하다기 보단, 개발 환경에 따라 설정이 다를 경우가 있다는걸 얘기하고 싶은거다.</p></li> <li><p>해결방법으로 각각의 환경마다 개별 클래스를 만들고, 메이븐에서 프로필 설정을 해주고난 후 빌드타임에 프로필을 넣어 적절한 컴파일 환경을 선택하는 것이다. (약간 이해가 안됨)</p></li> <li><p>이렇게하면 환경별로 애플리케이션을 재구성 해야한다. -&gt; war가 재빌드된다고 보면된다.</p></li></ul> <h2 id="_2-빈-프로필-설정"><a href="#_2-빈-프로필-설정" class="header-anchor">#</a> 2. 빈 프로필 설정</h2> <ul><li>위에 문제가 별로여서, 스프링에서 제공해주는 빈 프로필을 사용하는 것이다.</li> <li>실제로 환경 설정관련에 따라 바뀌는 부분을 프로젝트 빌드시에 결정하는 것이 아닌, 프로젝트 빌드는 다 똑같이하고 실제로 프로필에 맞는 빈생성 및 선택을 스프링에게 위임하는 형식이다.</li> <li>즉 war를 굳이 환경별로 재빌드를 할 필요가 없이, 같은 war파일로 실행을 하면서 환경변수로 넣어주는 프로필 값으로 스프링이 알아서 맞는 빈을 만들고 쓴다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;DEV&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevelopmentProfileConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Datasource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 @Profile 어노테이션을 통해 프로필을 지정해 줄 수 있다.</li> <li>클래스에 붙어있는 @Profile은 프로필이 DEV일 때만 빈을 생성해준다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;DEV&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token function">devDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;PROD&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token function">prodDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>메소드 단위로 프로필을 걸 수도 있다. 이렇게하면 하나의 클래스에서 관련 설정들을 쫙 해줄 수 있어서 이쁨</li></ul> <h2 id="_3-프로필-활성화"><a href="#_3-프로필-활성화" class="header-anchor">#</a> 3. 프로필 활성화</h2> <ul><li>spring.profiles.active / spring.profiles.default</li> <li>default는 active가 설정 안될때의 값이다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>프로필 설정 방법
- DispatcherServlet에 초기화된 파라미터
- 웹 애플리케이션의 컨텍스트 파라미터
- JNDI 엔트리
- 환경변수
- JVM 시스템 프로퍼티
- 통테 클래스에서 @ActiveProfile 어노테이션
</code></pre></div><ul><li>web.xml 에서 default profile 설정이 가능하다.</li> <li>프로필은 복수개 설정이 가능하다.</li></ul> <h2 id="_4-조건부-빈"><a href="#_4-조건부-빈" class="header-anchor">#</a> 4. 조건부 빈</h2> <ul><li>말그대로 조건에 맞춰서 빈을 생성해주는 방법으로, 특정 조건이 참일 경우 생성하는 빈</li> <li>@Conditional 어노테이션 사용</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">ManyMuchMoneyCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Happy</span> <span class="token function">superHappy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SuperHappy</span><span class="token punctuation">(</span><span class="token string">&quot;Money is best&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 경우, ManyMuchMoneyCondition 클래스 조건을 만족해야 superHappy 빈이 생성된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> ctxt<span class="token punctuation">,</span>
                  <span class="token class-name">AnnotatedTypeMetadata</span> metadta<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>@Conditional에 지정된 클래스는 Condition 인터페이스를 구현한 클래스여야 한다.</li> <li>mathes 는 boolean 값을 뱉어내는데, 결국 true가 될 때만 @Conditional이 걸린게 빈으로 설정된단 소리</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ManyMuchMoneyCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Environment</span> env <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token string">&quot;MONEY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 matches를 만들어서 특정 프로퍼티가 있을 시 라는 조건을 만들어 줄 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConditionContext</span> <span class="token punctuation">{</span>
    <span class="token class-name">BeanDefinitionRegistry</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ConfigurableListableBeanFactory</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Environment</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResourceLoader</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ClassLoader</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>matches에서 파라미터로 받는 ConditionContext 클래스를 보면 빈, 환경변수 등등 필요한 것들을 가져올 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AnnotatedTypeMetadata</span> <span class="token punctuation">{</span>

	<span class="token keyword">boolean</span> <span class="token function">isAnnotated</span><span class="token punctuation">(</span><span class="token class-name">String</span> annotationName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">String</span> annotationName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">String</span> annotationName<span class="token punctuation">,</span> <span class="token keyword">boolean</span>   classValuesAsString<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">String</span> annotationName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">String</span> annotationName<span class="token punctuation">,</span> <span class="token keyword">boolean</span> classValuesAsString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>AnnotatedTypeMetadata는 @Bean 메소드의 어노테이션을 검사 할 수 있다.</p></li> <li><p>@Profile 어노테이션도 @Conditional 어노테이션 기반으로 만들어진 어노테이션이다.</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">ProfileCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 요거. 실제로 들어가보면 환경변수 체크해준다.</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Profile</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-오토와이어링의-모호성"><a href="#_4-오토와이어링의-모호성" class="header-anchor">#</a> 4. 오토와이어링의 모호성</h2> <ul><li>오토와이어링이 동작 하는 방식은 정확하게 조건과 일치하는 한개의 빈이 있을때 동작한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGameConsole</span><span class="token punctuation">(</span><span class="token class-name">GameConsole</span> gameConsole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameConsole <span class="token operator">=</span> gameConsole<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위에서 보면 setGameConsole 메소드가 오토와이어드 되어있다.</li> <li>GameConsole 은 인터페이스라고 가정하고, 3개정도의 클래스가 구현됐다고 가정해본다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> PS4 <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> XBOX <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Switch</span> <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 경우를 보면, 세터 인젝션을 할때 넣을 수 있는 게임기는 3개나 되서 스프링은 NoUniqueBeanDefinition 예외가 발생한다.</li></ul> <h3 id="_4-1-기본빈-지정-primary"><a href="#_4-1-기본빈-지정-primary" class="header-anchor">#</a> 4-1. 기본빈 지정 (@Primary)</h3> <ul><li>위와같은 상황 해결을 위해, @Primary 빈을 등록하는 방법이 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Switch</span> <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>요러면 스위치를 먼저 선택하게 된다.</li> <li>하지만 마찬가지로, 다른 클래스에도 @Primary를 넣으면 똑같이 모호해지는 문제가 생긴다.</li></ul> <h3 id="_4-2-이름주기-qualifier"><a href="#_4-2-이름주기-qualifier" class="header-anchor">#</a> 4-2. 이름주기 (@Qualifier)</h3> <ul><li>@Primary도 결국 모호해 질 수 있는 문제가 있다.</li> <li>이런 경우를 해결하기 위해, 좀더 명확하게 @Qualifier 어노테이션을 사용 할 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;switch&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGameConsole</span><span class="token punctuation">(</span><span class="token class-name">GameConsole</span> gameConsole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameConsole <span class="token operator">=</span> gameConsole<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이럴 경우, 위의 오토와이어는 switch라는 아이디를 가진 빈을 오토와이어링을 해준다.</li> <li>특정 클래스가 명시적으로 빈의 아이디를 설정 해주지 않으면, 기본으로 앞글자를 소문자를 만들어 빈을 생성해 주는데, 이럴 경우 클래스명이 바뀌거나 하면 위의 코드는 또 에러가 나게된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;nintendo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Switch</span> <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 사용될 빈에도 @Qualifier 어노테이션을 사용해 이름을 지정해주면, 이제 클래스명이 바껴도 문제가 없다.</li> <li>사용될 빈에 @Qualifier 를 사용 할 땐, 해당 클래스를 설명할 수 있는 포괄적인 용어를 사용하는것이 좋다.</li> <li>닌텐도에서 새로운 게임기를 내서 클래스명이 바뀔수도 있지만, 닌텐도란 이름은 안바뀔 테니까</li> <li>근데 이럴 경우 또 문제점이 생길 수 있는게, 같은 Qualifer 이름을 갖는 클래스가 생성 되서 또 모호해 질 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;nintendo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> nintendo3DS <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>이럴 경우 nintendo로 오토와이어 할 경우, 2개의 빈이생겨 또다시 문제가 생겨버린다.</li> <li>이런 문제를 해결하려고 2개의 Qualifier를 사용하면 좋은데, 자바는 두개의 같은 어노테이션을 반복하는 걸 싫어해서 오류를 뱉어낸다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;nintendo&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;version3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Switch</span> <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;nintendo&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;version3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGameConsole</span><span class="token punctuation">(</span><span class="token class-name">GameConsole</span> gameConsole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameConsole <span class="token operator">=</span> gameConsole<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 이렇게 하면 될 것 같지만, 같은 어노테이션 두개라 에러가 발생한다.</span>
</code></pre></div><ul><li>이런 경우엔 그냥 특정 Quaifier에 정의된 이름으로 커스텀 어노테이션을 만들면 된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// @Nintendo</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>CONSTRUCTOR<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span>
         <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Nintendo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment">// @VersionThree</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>CONSTRUCTOR<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span>
         <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">VersionThree</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>이제 @Qualifier 대신에 해당 어노테이션들을 사용하면 된다. -&gt; 수십개도 가능</li> <li>또한 Qualifier에 문자열 넣는거보다 좀더 type-safe 해지니 어노테이션을 이용하도록 하자</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Nintendo</span>
<span class="token annotation punctuation">@VersionThree</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Switch</span> <span class="token keyword">implements</span> <span class="token class-name">GameConsole</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Nintendo</span>
<span class="token annotation punctuation">@VersionThree</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGameConsole</span><span class="token punctuation">(</span><span class="token class-name">GameConsole</span> gameConsole<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>setGameConsole <span class="token operator">=</span> gameConsole<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//깔끔!</span>
</code></pre></div><h2 id="_5-빈-범위"><a href="#_5-빈-범위" class="header-anchor">#</a> 5. 빈 범위</h2> <ul><li>기본적으로 생성되는 빈은 전부다 싱글톤이다.</li> <li>대부분의 경우 싱글톤이 짱짱맨이지만, 가끔은 다른걸 써야할 때도 있다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>- 싱글톤 : 전체 어플리케이션을 위해 생성되는 빈의 인스턴스 하나
- 프로토타입 : 빈이 주입될 때마다 생성되거나 스프링 어플리케이션 컨텍스트에서 얻는 빈의 인스턴스 하나
- 세션 : 웹 어플리케이션에서 각 세션용으로 생성되는 빈의 인스턴스 하나
- 요청 : 웹 어플리케이션에서 각 요청용으로 생성되는 빈의 인슽턴스 하나
</code></pre></div><ul><li>@Scope 어노테이션을 통해 설정이 가능하다</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotePadd</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>세션 범위로 범위를 줄 수도 있다.</li> <li>장바구니 같은게 대표적인 예인데, 장바구니는 개인별로 따로 갖고 있으므로 세션단위로 주는게 적절하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>
    value<span class="token operator">=</span><span class="token class-name">WebApplicationContext</span><span class="token punctuation">.</span>SCOPE_SESSION<span class="token punctuation">,</span>
    proxyMode<span class="token operator">=</span><span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span>INTERFACES
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ShoppingCart</span> <span class="token function">cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>요렇게 생성이 되는데, 세션별로 쇼핑카트 빈이 생성되고, 그 빈은 해당 세션에 관해서는 싱글톤이다.</li> <li>proxyMode 도 중요한대, 문제가 발생 할 수 있는 시나리오를 보면</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StoreService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setShoppingCart</span><span class="token punctuation">(</span><span class="token class-name">ShoppingCart</span> shoppingCart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>shoppingCart <span class="token operator">=</span> shoppingCart<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>위의 상황을 보면, 스프링에서 저장 서비스를 빈으로 만드는데, 쇼핑카트는 고객이 세션을 만들때 까지 존재하지 않게된다.</p></li> <li><p>위에 처럼 단일한 인스턴스를 주입하는 저장 서비스는 잘못 설계된 것이다.</p></li> <li><p>이런 문제를 해결하기 위해 proxyMode를 INTERFACE로 설정해 준다.</p></li> <li><p>정리해보면, 빈을 등록할때 모드를 인터페이스로 지정해주면, 오토와이어링을 하면 실제 빈이 등록되는게 아니라 프록시 인터페이스가 등록되고, 실제 빈생성은 세션이 생성될 때 작동한다.</p></li> <li><p>만약 ShoppingCart가 인터페이스가 아니라면 (위의 예시는 인터페이스 이지만) 스프링은 자동으로 프록시 인터페이스를 만들어 주는 것 같다. CGLIB을 사용해서. (이거 디버깅 하다보면 많이 나왔는데 이런 상황에서 쓰는거같다.)</p></li> <li><p>여기에 추가로 요청 범위 빈 (request)도 비슷한 문제를 발생시키므로, 요청 범위 빈 자체도 또한 프록시로 주입이 된다.</p></li> <li><p>https://stackoverflow.com/questions/39945163/proxymode-scopedproxymode-target-class-vs-scopedproxymode-interface</p></li> <li><p>https://livebook.manning.com/book/spring-in-action-fourth-edition/chapter-3/185</p></li></ul> <p><img src="/study-collection/assets/img/proxy.d9458957.jpg" alt="Alt text"></p> <h2 id="_6-런타임-값-주입"><a href="#_6-런타임-값-주입" class="header-anchor">#</a> 6. 런타임 값 주입</h2> <ul><li>DI와 와이어링을 할 때, 하드코딩된 값이 아닌 런타임에 값이 정해지는게 필요할 때가 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">iUAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Love poem&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;IU&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 이런식으로 노래제목과 가수를 하드코딩 되도 되지만, 따로 주입받을 수도 있다.</span>
</code></pre></div><ul><li>이걸 해주는 방법은 Porperty placeholders, SpEL 이다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpaht:~/application.properties&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpressiveConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Environment</span> env<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> blankDisc <span class="token function">disc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span>
            env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;disc.title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            env<span class="token punctuation">.</span><span class="token function">getProeprty</span><span class="token punctuation">(</span><span class="token string">&quot;disc.artist&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>프로퍼티에서 값을 가져오는 방법</li> <li>getProperty는 key만 받는게 아닌 다른 타입을 받거나, 디폴트값을 설정할 수 도 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 액티프 프로필 목록 </span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 기본 프로필 목록</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDefaultProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 해당 프로필이 허용 프로필인지 확인해줌</span>
<span class="token keyword">boolean</span> <span class="token function">acceptsProfiles</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> profiles<span class="token punctuation">)</span>
</code></pre></div><ul><li>보통 프로퍼티값을 가져올 땐 @Value를 사용해서 가져온다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BlackDisc</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${disc.tiitle}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${disc.artist}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> artist
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li>이러한 플레이스홀더 값을 사용하기 위해서 PropertyPlaceholderConfigurer 빈 또는 PropertySourcePlaceholderConfigurer 빈을 설정한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PropertySourcePlaceholderConfigurer</span> <span class="token function">placeholderConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PropertySourcesPlaceholderConfigurere</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-spel"><a href="#_7-spel" class="header-anchor">#</a> 7. SpEL</h2> <ul><li>SpEL은 런타임에 표현식을 사용하여 빈의 프로퍼티나 생성자 파라미터에 값을 전달하게 하는 스프링 표현 언어 이다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>기능들
- ID로 빈을 참조하는 기능
- 메소드 호출과 객체의 프로퍼티 액세스
- 값에서의 수학적인 동작, 관계와 관련된 동작, 논리연산 동작
- 정규 표현식 매칭
- 컬렉션 처리
</code></pre></div><ul><li>여러가지 예시가 있는데 쓸때 찾아보자</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/spring-in-action/002.html" class="prev">2장 빈 와이어링</a></span> <span class="next"><a href="/study-collection/book/spring-in-action/004.html">4장 애스펙트 지향 스프링</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.4f5f64cd.js" defer></script><script src="/study-collection/assets/js/2.5e892776.js" defer></script><script src="/study-collection/assets/js/76.e409a605.js" defer></script>
  </body>
</html>
