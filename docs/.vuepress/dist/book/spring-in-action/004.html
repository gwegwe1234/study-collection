<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.48760978.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.391b7f5b.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.edca0e58.js" as="script"><link rel="preload" href="/study-collection/assets/js/6.029aab9d.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.eb0fa5ab.js"><link rel="prefetch" href="/study-collection/assets/js/11.21fdda25.js"><link rel="prefetch" href="/study-collection/assets/js/12.dcc91991.js"><link rel="prefetch" href="/study-collection/assets/js/13.ed405df4.js"><link rel="prefetch" href="/study-collection/assets/js/14.7cac9370.js"><link rel="prefetch" href="/study-collection/assets/js/15.ded150eb.js"><link rel="prefetch" href="/study-collection/assets/js/16.e9b11c0e.js"><link rel="prefetch" href="/study-collection/assets/js/17.24d1d634.js"><link rel="prefetch" href="/study-collection/assets/js/18.1b382353.js"><link rel="prefetch" href="/study-collection/assets/js/19.b2516dee.js"><link rel="prefetch" href="/study-collection/assets/js/20.a2bcaaa1.js"><link rel="prefetch" href="/study-collection/assets/js/21.590f503b.js"><link rel="prefetch" href="/study-collection/assets/js/22.3be06d58.js"><link rel="prefetch" href="/study-collection/assets/js/23.aefe83eb.js"><link rel="prefetch" href="/study-collection/assets/js/24.f79ec0e5.js"><link rel="prefetch" href="/study-collection/assets/js/25.3e0c8faa.js"><link rel="prefetch" href="/study-collection/assets/js/26.c605e99a.js"><link rel="prefetch" href="/study-collection/assets/js/27.369fc2cd.js"><link rel="prefetch" href="/study-collection/assets/js/28.b8e9fac1.js"><link rel="prefetch" href="/study-collection/assets/js/29.e4e8e27f.js"><link rel="prefetch" href="/study-collection/assets/js/3.75a4c84f.js"><link rel="prefetch" href="/study-collection/assets/js/30.d359cb11.js"><link rel="prefetch" href="/study-collection/assets/js/31.51904f76.js"><link rel="prefetch" href="/study-collection/assets/js/32.6f9e40b3.js"><link rel="prefetch" href="/study-collection/assets/js/33.0ed05b12.js"><link rel="prefetch" href="/study-collection/assets/js/34.fe519afa.js"><link rel="prefetch" href="/study-collection/assets/js/35.77db278b.js"><link rel="prefetch" href="/study-collection/assets/js/36.94ce3599.js"><link rel="prefetch" href="/study-collection/assets/js/37.43c61069.js"><link rel="prefetch" href="/study-collection/assets/js/38.4729fb50.js"><link rel="prefetch" href="/study-collection/assets/js/39.7bb9b59d.js"><link rel="prefetch" href="/study-collection/assets/js/4.50049d70.js"><link rel="prefetch" href="/study-collection/assets/js/40.eaead491.js"><link rel="prefetch" href="/study-collection/assets/js/41.e3c5416b.js"><link rel="prefetch" href="/study-collection/assets/js/42.c28f2e42.js"><link rel="prefetch" href="/study-collection/assets/js/43.11be8f4e.js"><link rel="prefetch" href="/study-collection/assets/js/44.8580b8e9.js"><link rel="prefetch" href="/study-collection/assets/js/45.680d931b.js"><link rel="prefetch" href="/study-collection/assets/js/46.584ed026.js"><link rel="prefetch" href="/study-collection/assets/js/47.aa21fe37.js"><link rel="prefetch" href="/study-collection/assets/js/48.2c9180a5.js"><link rel="prefetch" href="/study-collection/assets/js/49.098763c2.js"><link rel="prefetch" href="/study-collection/assets/js/5.76af0dac.js"><link rel="prefetch" href="/study-collection/assets/js/50.ac6d71f0.js"><link rel="prefetch" href="/study-collection/assets/js/51.d8a5fc3e.js"><link rel="prefetch" href="/study-collection/assets/js/52.f1edefd4.js"><link rel="prefetch" href="/study-collection/assets/js/53.b57de2d8.js"><link rel="prefetch" href="/study-collection/assets/js/54.987dff92.js"><link rel="prefetch" href="/study-collection/assets/js/7.3e71367f.js"><link rel="prefetch" href="/study-collection/assets/js/8.24325bf6.js"><link rel="prefetch" href="/study-collection/assets/js/9.2707cd90.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.48760978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>스프링 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/spring-in-action/001.html" class="sidebar-link">1장 스프링 속으로</a></li><li><a href="/study-collection/book/spring-in-action/002.html" class="sidebar-link">2장 빈 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/003.html" class="sidebar-link">3장 고급 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/004.html" class="active sidebar-link">4장 애스펙트 지향 스프링</a></li><li><a href="/study-collection/book/spring-in-action/005.html" class="sidebar-link">5장 스프링 웹 어플리케이션 만들기</a></li><li><a href="/study-collection/book/spring-in-action/006.html" class="sidebar-link">6장 웹 뷰 렌더링</a></li><li><a href="/study-collection/book/spring-in-action/007.html" class="sidebar-link">7장 고급 스프링MVC</a></li><li><a href="/study-collection/book/spring-in-action/008.html" class="sidebar-link">8장 스프링 웹플로로 작업하기</a></li><li><a href="/study-collection/book/spring-in-action/009.html" class="sidebar-link">9장 웹 어플리케이션 보안</a></li><li><a href="/study-collection/book/spring-in-action/010.html" class="sidebar-link">10장 스프링과 JDBC를 사용하여 데이터베이스 사용하기</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_4강"><a href="#_4강" class="header-anchor">#</a> 4강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-aop란">1. AOP란?</a></li><li><a href="#_2-aop-용어">2. AOP 용어</a><ul><li><a href="#_2-1-어드바이스">2-1 어드바이스</a></li><li><a href="#_2-2-조인포인트">2-2 조인포인트</a></li><li><a href="#_2-3-포인트커트">2-3 포인트커트</a></li><li><a href="#_2-4-애스펙트">2-4 애스펙트</a></li><li><a href="#_2-5-인트로덕션">2-5 인트로덕션</a></li><li><a href="#_2-6-위빙">2-6 위빙</a></li></ul></li><li><a href="#_3-스프링의-aop">3. 스프링의 AOP</a></li><li><a href="#_4-포인트커트를-이용한-조인포인트-선택">4. 포인트커트를 이용한 조인포인트 선택</a></li><li><a href="#_5-애스펙트-어노테이션-만들기">5. 애스펙트 어노테이션 만들기</a><ul><li><a href="#_5-1-애스팩트-정의">5-1 애스팩트 정의</a></li><li><a href="#_5-2-around-어드바이스">5-2 Around 어드바이스</a></li><li><a href="#_5-3-어드바이스에서-파라미터-처리">5-3 어드바이스에서 파라미터 처리</a></li><li><a href="#_5-4-인트로덕션-어노테이션">5-4 인트로덕션 어노테이션</a></li></ul></li><li><a href="#_6-aspectj">6. AspectJ</a></li></ul></div><p></p> <h2 id="_1-aop란"><a href="#_1-aop란" class="header-anchor">#</a> 1. AOP란?</h2> <ul><li>애스팩트의 목적은 횡단 관심사의 모듈화 이다.</li> <li>즉 한 프로젝트에서 여러부분에 영향을 주는 기능이다.</li> <li>횡단으로 중복된 코드를 줄여주는 역할을 한다.</li> <li>대부분의 서비스들은 로깅과 트랜잭션 처리같은 기능이 필요하지만, 모든 비지니스 로직에 해당 기능이 들어가면 보기가 싫다.</li></ul> <p><img src="/study-collection/assets/img/aop.71ef000a.jpg" alt="Alt text"></p> <ul><li>애스팩트는 여러 애플리케이션 객체에 걸치는 로직에 적용된 횡단 관심사 (로깅, 트랜잭션 등)를 모듈화 한다.</li> <li>객체 지향에서 공통된 기능을 재사용 하기위해 사용하는 기법</li> <li>AOP도 공통 기능을 한곳에 모아두어 선언적으로 적용할지 선언이 가능하고, 대상클래스의 수정없이 적용이 가능하다.</li></ul> <div class="language-zsh extra-class"><pre class="language-text"><code>AOP의 장점
1. 전체 코드 기반에 흩어져있는 공통적인 기능이 하나의 장소로 응집된다.
2. 서비스 로직에서 실제 비지니스 로직을 제외한 기능들을 모두 애스팩트로 모아둬 코드가 깔끔하다.
</code></pre></div><h2 id="_2-aop-용어"><a href="#_2-aop-용어" class="header-anchor">#</a> 2. AOP 용어</h2> <p><img src="/study-collection/assets/img/aop2.0707afca.jpg" alt="Alt text"></p> <h3 id="_2-1-어드바이스"><a href="#_2-1-어드바이스" class="header-anchor">#</a> 2-1 어드바이스</h3> <ul><li>애스팩트가 해야할 작업을 AOP 용어에서 어드바이스라고 정의한다.</li> <li>어드바이스는 애스팩트가 <em>무엇</em>을 <em>언제</em> 할지를 정의한다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>어드바이스 종류
- before : 어드바이스 대상 메소드가 호출되기 전에 어드바이스 기능 수행
- after : 결과에 상관 없이 어드바이스 대상 메소드가 완료된 이후에 어드바이스 기능 수행
- after-returning : 대상 메소드가 성공적으로 리턴한 후 어드바이스 기능 수행
- after-throwing : 대상 메소드가 예외를 던진 후 어드바이스 기능 수행
- around : 어드바이스가 어드바이스 대상 메소드를 감싸 전,후로 작동
</code></pre></div><h3 id="_2-2-조인포인트"><a href="#_2-2-조인포인트" class="header-anchor">#</a> 2-2 조인포인트</h3> <ul><li>어드바이스를 적용 할 수 있는 곳을 조인포인트 라고 정의한다.</li> <li>끼울 수 있는 지점은 메소드 호출 지점, 예외발생, 필드 값 수정 등이 있다.</li> <li>조인포인트에 애스팩트가 삽입되면 정상적인 어플리케이션 흐름에 추가 기능이 적용 된다.</li></ul> <h3 id="_2-3-포인트커트"><a href="#_2-3-포인트커트" class="header-anchor">#</a> 2-3 포인트커트</h3> <ul><li>포인트커트란 애스팩트가 어드바이스 할 조인포인트의 영역을 좁히는 일을 하는 기능이다.</li> <li>어드바이스는 무엇을 언제 라면 포인트커트는 <em>어디서</em> 할지를 정의한다.</li></ul> <h3 id="_2-4-애스펙트"><a href="#_2-4-애스펙트" class="header-anchor">#</a> 2-4 애스펙트</h3> <ul><li>어드바이스 + 포인트커트 = 애스팩트</li></ul> <h3 id="_2-5-인트로덕션"><a href="#_2-5-인트로덕션" class="header-anchor">#</a> 2-5 인트로덕션</h3> <ul><li>인트로덕션은 기존 코드 수정 없이 메소드나 멤버 변수를 추가하는 기능</li></ul> <h3 id="_2-6-위빙"><a href="#_2-6-위빙" class="header-anchor">#</a> 2-6 위빙</h3> <ul><li>타깃 객체에 애스펙트를 적용해 새로운 프록시 객체를 생성하는 절차</li> <li>애스팩트는 타깃 객체의 조인포인트로 위빙된다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>수행 시점
- compile time : 타깃 클래스가 컴파일 될 때 애스펙트가 위빙되며, 별도의 컴파일러가 필요. AspectJ의 위빙 컴파일러는 이러한 목적으로 사용된다.
- classload time : 클래스가 JVM에 로드될 때 애스팩트가 위빙된다. 특정 클래스 로더 필요
- runtime : 애플리케이션 실행 중에 애스팩트가 위빙된다. 보통 타깃 객체에 호출을 위임하는 구조의 프록시 객체를 위빙중에 AOP 컨테이너가 동적으로 만들어 낸다. 스프링의 AOP 위빙 방식
</code></pre></div><h2 id="_3-스프링의-aop"><a href="#_3-스프링의-aop" class="header-anchor">#</a> 3. 스프링의 AOP</h2> <ul><li>스프링은 4가지 형태의 AOP를 지원</li></ul> <div class="language- extra-class"><pre class="language-text"><code>- classic 스프링 프록시 기반 AOP
- Pure-POJO 애스팩트
- @AspectJ 어노테이션 기반 애스팩트
- AspectJ 애스펙트에 빈 주입 (스프링의 모든 버전 지원)
</code></pre></div><ul><li>클래식은 복잡하니 버림</li> <li>스프링에서 생성하는 모든 어드바이스는 표준 자바 클래스로 작성한다.</li> <li>포인트 커트의 경우 어드바이스를 적용할 곳을 정의하는데, 보통 xml(...) 설정을 해주면 된다.</li> <li>AspectJ는 지금은 어노테이션기반으로 작동하지만, 자바 언어를 확장한 형태라 러닝커브가 높다.</li></ul> <p><img src="/study-collection/assets/img/aop3.8872a3ed.jpg" alt="Alt text"></p> <ul><li>스프링에서의 어드바이스는 위의 그림처럼 프록시객체가 타깃 객체를 감싸고, 대상 메소드로의 호출을 가로챈 후 타깃 객체로 호출을 포워딩 해준다.</li> <li>애스펙트의 로직은 프록시가 메소드의 호출을 훔친 후에 실행되고, 그 이후에 타깃 빈의 메소드가 호출된다. (after 일땐?)</li> <li>스프링은 프록시 타깃 빈을 실제 필요로 하기 전까지 프록시 타깃 객체를 생성하지 않는다.</li> <li>스프링은 런타임 시에 프록시를 생성하므로, 스프링 AOP의 애스팩트를 위빙하기 위한 별도의 컴파일러는 필요로 하지 않는다.</li> <li>스프링은 메소드 조인포인트만 지원한다.</li> <li>AspectJ나 JBoss같은 AOP 프레임워크들은 필드나 생성자 조인 포인트까지 제공</li> <li>즉 스프링은 필드같은걸 포인트커트로 지정이 불가능헤, 세밀하게 필드값 조정같은건 안된다.</li></ul> <h2 id="_4-포인트커트를-이용한-조인포인트-선택"><a href="#_4-포인트커트를-이용한-조인포인트-선택" class="header-anchor">#</a> 4. 포인트커트를 이용한 조인포인트 선택</h2> <ul><li>스프링은 AspectJ에서 지정자에 속하는 포인트커트만 지원한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> concert<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Performance</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 소스에서 Performance 의 perform() 메소드를 트리거링하는 애스팩트를 작성할 수 있다.</li></ul> <p><img src="/study-collection/assets/img/aop4.2fe49fbe.jpg" alt="Alt text"></p> <ul><li>AspectJ의 포인트커트 표현식을 이용한 Performance의 perform() 메소드 선택</li> <li>*은 모든타입 리턴이고, 패키지+클래스 명과 메소드명 지정, 이후에 받는 인자를 적어준다.</li></ul> <p><img src="/study-collection/assets/img/aop5.7306a170.jpg" alt="Alt text"></p> <ul><li>위에처럼 콘서트 패키지에서 호출건만 처리하도록 제한을 둘 수도 있다.</li> <li>포인트커트에서 bean() 지정자 사용이 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> concert<span class="token punctuation">.</span><span class="token class-name">Performance</span><span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> and <span class="token function">bean</span><span class="token punctuation">(</span><span class="token string">'woodstock'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_5-애스펙트-어노테이션-만들기"><a href="#_5-애스펙트-어노테이션-만들기" class="header-anchor">#</a> 5. 애스펙트 어노테이션 만들기</h2> <h3 id="_5-1-애스팩트-정의"><a href="#_5-1-애스팩트-정의" class="header-anchor">#</a> 5-1 애스팩트 정의</h3> <ul><li>@Aspect 어노테이션을 사용하면 클래스를 애스펙트로 바꿀 수 있다.</li> <li>위의 Performance 예시를 다시 사용해보자</li> <li>공연에 관객이 없으면 공연은 의미가없다. 하지만 공연 자체의 기능은 관객이 아니다. 따라서 관객은 애스펙트로 지정해줄 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> concert<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Audience</span> <span class="token punctuation">{</span>
    <span class="token comment">// 공연 이전에 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">silenceCellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 공연 이전에 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">takeSeats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 공연 이후에 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">applause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 공연이 실패하면 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demandRefund</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>맨위의 @Aspect 어노테이션은 해당 관객 클래스가 POJO가 아닌 애스펙트임을 명시해 준다.</li> <li>관객은 공연(어드바이스된 타깃 클래스)의 전,후,문제발생 시의 행동을 어노테이션을 통해 정의가 가능하다.</li> <li>모든 어노테이션은 포인트커트 표현식 값의 형태로 설정된다. (execution...)</li> <li>위의 예시에서 모든 어드바이스 어노테이션은 같은 포인트커트 표현식을 사용하고 있어 중복된 모습이 별로다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> concert<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Audience</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// 공연 이전에 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">silenceCellPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 공연 이전에 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">takeSeats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 공연 이후에 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">applause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 공연이 실패하면 관객이 해야할 행동</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demandRefund</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>중복은 보기 싫으니까 @Pointcut 어노테이션을 사용해 특정 포인트커트 표현식을 따로 정의해 주도록 하자.</li> <li>Audience 클래스는 어노테이션과 별개로 POJO 이다.. (이거 뭔소린지 모르겠음. 위에선 아니랬는데)</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Audience</span> <span class="token function">audience</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Audience</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 이런식으로 다른 자바 클래스처럼 스프링에서 빈으로 와이어링 된다.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게만 설정해주면 Audience는 일반 스프링 빈처럼 사용된다.</li> <li>애스팩트 어노테이션을 썼지만, 애스팩트로 변경해주는 프록시를 생성하고, 어노테이션을 해석하기 위해선 @EnableAspectJAutoProxy 어노테이션을 JavaConfig에 넣어줘서 오토프록싱을 가능하게 해야한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span> <span class="token comment">// AspectJ 오토 프록싱 할성화</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcertConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Audience</span> <span class="token function">audience</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Audience</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 빈선언</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-around-어드바이스"><a href="#_5-2-around-어드바이스" class="header-anchor">#</a> 5-2 Around 어드바이스</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Audience</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(** concert.Performance.perform(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;performance()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">watchPerformance</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> jp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Syso</span><span class="token punctuation">(</span><span class="token string">&quot;silent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">Syso</span><span class="token punctuation">(</span><span class="token string">&quot;take seat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Syso</span><span class="token punctuation">(</span><span class="token string">&quot;Applause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Syso</span><span class="token punctuation">(</span><span class="token string">&quot;refund&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>@Around 어드바이스는 watchPerformance() 메소드에 포인트커트가 적용 되었다.</li> <li>이전에 4개로 나눠진 어드바이스는 하나로 뭉쳐졌다.</li> <li>특이한건 ProceedingJoinPoint를 파라미터로 받는데, 이건 어드바이스 대상 메소드를 실행을 제어하는거라고 생각하면 된다.</li> <li>즉 silent, seat 을 하고난 후, jp.proceed() 를 하면 공연 (perform()) 메소드를 실행하고, 이후에 박수를 치게 된다.</li> <li>@Around 어노테이션을 쓰려면 ProceedingJoinPoint는 필수!</li> <li>재밌는건 저 proceed()메소드는 어드바이스 내에서 여러번 호출이 가능하다. 즉 대상 메소드 반복 수행하는 재시도 로직도 구현이 가능하다.</li></ul> <h3 id="_5-3-어드바이스에서-파라미터-처리"><a href="#_5-3-어드바이스에서-파라미터-처리" class="header-anchor">#</a> 5-3 어드바이스에서 파라미터 처리</h3> <ul><li>어드바이스에서 파라미터를 받아 처리할 수도 있다.</li> <li>blank disc에 플레이 횟수를 카운트하는 애스펙트를 만든다고 가정하면</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrackCounter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> trackCounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span>
        <span class="token string">&quot;execution(* soundsystem.CompactDisc.playTrack(int))&quot;</span> <span class="token operator">+</span> 
        <span class="token string">&quot;&amp;&amp; args(trackNumber)&quot;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">trackPlayed</span><span class="token punctuation">(</span><span class="token keyword">int</span> trackNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;trackPlayed(trackNumber)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countTrack</span><span class="token punctuation">(</span><span class="token keyword">int</span> trackNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> currentCount <span class="token operator">=</span> <span class="token function">getPlayCount</span><span class="token punctuation">(</span>trackNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        trackCounts<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>trackNumber<span class="token punctuation">,</span> currentCount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPlayCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> trackNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> trackCounts<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>trackNumber<span class="token punctuation">)</span> 
            <span class="token operator">?</span> trackCounts<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>trackNumber<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/study-collection/assets/img/aop6.28378646.jpg" alt="Alt text"></p> <ul><li>이전 것과의 차이는 trackNumber라는 파라미터를 받았다.</li> <li>Pointcut에 정의되어있는 args(trackNumber) 식별자로, playTrack() 메소드에 전달되는 int인자가 어드바이스에도 똑같이 전해진다는 것을 뜻한다.</li> <li>즉 실제로직에서 playTrack(3); 을 하면, 어드바이스에서도 인자로 3을 받게 된다.</li> <li>그리고 나서, 실제로 그 3이라는 인자는 trackPlayed 포인트커트로 설정된 @Before로 정의되어 있는 메소드 countTrack의 인자 (int trackNumber) 에도 전달이 되게 된다. (꼬리에 꼬리에 꼬리에)</li></ul> <h3 id="_5-4-인트로덕션-어노테이션"><a href="#_5-4-인트로덕션-어노테이션" class="header-anchor">#</a> 5-4 인트로덕션 어노테이션</h3> <ul><li>AOP를 이용하면, 루비나 그루비처럼 동적으로 객체나 클래스에 새로운 메소드를 추가해주는 기능을 유사하게 구현이 가능하다.</li> <li>실제로 객체에 새로운 메소드를 추가하진 않았지만, 위에서 구현한 것처럼 Around 어드바이스를 사용하면 기존 메소드 전, 후로 새로운 기능을 추가 할 수있다.</li> <li>이러한 개념과 비슷하게 실제로 새롭게 도입된 AOP개념으로 애스펙트는 스프링 빈에 새로운 메소드(?!)를 추가 할 수 있다.</li></ul> <p><img src="/study-collection/assets/img/aop7.d4aaf843.jpg" alt="Alt text"></p> <ul><li>실제로 애스펙트는 어드바이스 대상 빈과 동일한 인터페이스를 구현하는 프록시 일 뿐이다.</li> <li>반대로 생각해서 위의 그림처럼 하부 구현 클래스가 없어도, 애스펙트가 어드바이스한 모든 빈은 새로운 인터페이스를 구현하기 위해 나타난다. (그냥 새로 생성되는거인듯)</li> <li>정리하면 스프링 AOP로 새로운 메소드를 빈에 추가하게 되면 프록시는 메소드 호출을 가로채고, 메소드를 구현한 다른 객체에 위임해 버린다. -&gt; 위의 그림에서 Introduction 빈은 Advised bean으로 기능을 위임함 -&gt; 메소드가 추가된 거!</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> concert<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Encoreable</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">performEncore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 앵콜 기능을 모든 Performance 구현체에 제공해보기</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>앵콜 기능을 추가로 개발을 하게 되었는데, 모든 Performance 구현체를 다 바꿀 수가 없다.</li> <li>이럴때 쓰는게 AOP 인트로덕션!</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> concert<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EncoreableIntroducer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@DeclareParents</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;concert.Performance+&quot;</span><span class="token punctuation">,</span>
                           defaultImpl<span class="token operator">=</span><span class="token class-name">DefaultEncoreable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Encoreable</span> encoreable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>새로운 EncoreableIntroducer 애스펙트인데, 기존과 달리 @Before 같은 어드바이스가 없다.</li> <li>대신 DeclareParents 어노테이션을 사용해서, Performance빈에 Encoreable 인터페이스를 제공한다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>DeclareParents 어노테이션
- value 애트리뷰트는 인터페이스를 제공하는 여러 빈을 식별한다. 위에선 Performance 구현체
- defaultImpl 애트리뷰트는 인트로덕션 구현체를 제공하는 클래스를 식별한다. 여기선 기본앵콜!
- DeclareParents로 어노테이션 되는 적정 프로퍼티는 도입 인터페이스를 지정한다. 여기선 encorable
</code></pre></div><h2 id="_6-aspectj"><a href="#_6-aspectj" class="header-anchor">#</a> 6. AspectJ</h2> <ul><li>스프링 AOP만으로 해결이 안되는 건 AspectJ로 해결이 가능하다.</li> <li>실제로 AspectJ는 스프링을 위한거라기 보단 자바 어플리케이션을 위한 라이브러리 라고 보는게 맞다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> concert<span class="token punctuation">;</span>

<span class="token keyword">public</span> aspect <span class="token class-name">CriticAspect</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">CriticAspect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    pointcut <span class="token function">performace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">excution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token function">perform</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">afterRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">performance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Syso</span><span class="token punctuation">(</span>criticismEngine<span class="token punctuation">.</span><span class="token function">getCriticism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">CriticismEngine</span> criticismEngine<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCriticismEngine</span><span class="token punctuation">(</span><span class="token class-name">CriticismEngine</span> criticismEngine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>criticismEngine <span class="token operator">=</span> criticismEngine<span class="token punctuation">;</span>
        <span class="token comment">// CriticismEngine 주입</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 짜면 모든 perform에 대해서 끝나고나면 (afterRunning) 비평을 시작하는 애스펙트를 얻게된다.</li> <li>문제는 심사위원 혼자서 평가하는게 아니라 CriticismEngine 객체와 같이 평가 (getCriticism())를 내린다.</li> <li>CriticismEngine에 관한 레퍼런스는 위에선 세터 인젝션을 통해 얻게 된다.</li></ul> <p><img src="/study-collection/assets/img/aop8.a81eef85.jpg" alt="Alt text"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CriticismEngineImpl</span> <span class="token keyword">implements</span> <span class="token class-name">CriticismEngine</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">// 이렇게 CriticismEngine을 구현한 Impl 클래스도 만들어준다.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위에처럼 Impl 클래스도 구현이 되면, CriticismEngineImpl 을 CriticAspect로 와이어링을 해주면 끝나는데, AspectJ는 스프링이랑은 상관없이 애플리케이션에 위빙된다.</li> <li>이러한 문제를 막기위해, 위의 CriticAspect를 CriticismEngine 빈이 주입된 빈으로 설정해 주면 끝!</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/spring-in-action/003.html" class="prev">3장 고급 와이어링</a></span> <span class="next"><a href="/study-collection/book/spring-in-action/005.html">5장 스프링 웹 어플리케이션 만들기</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.391b7f5b.js" defer></script><script src="/study-collection/assets/js/2.edca0e58.js" defer></script><script src="/study-collection/assets/js/6.029aab9d.js" defer></script>
  </body>
</html>
