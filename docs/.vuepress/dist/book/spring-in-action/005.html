<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.48760978.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.e26ebf70.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.7ece6ebb.js" as="script"><link rel="preload" href="/study-collection/assets/js/19.c4d4a505.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.28a03744.js"><link rel="prefetch" href="/study-collection/assets/js/11.6b8610f5.js"><link rel="prefetch" href="/study-collection/assets/js/12.948dc1b3.js"><link rel="prefetch" href="/study-collection/assets/js/13.5a293087.js"><link rel="prefetch" href="/study-collection/assets/js/14.641da538.js"><link rel="prefetch" href="/study-collection/assets/js/15.e25b8d68.js"><link rel="prefetch" href="/study-collection/assets/js/16.8e544039.js"><link rel="prefetch" href="/study-collection/assets/js/17.83874a10.js"><link rel="prefetch" href="/study-collection/assets/js/18.f0409cc4.js"><link rel="prefetch" href="/study-collection/assets/js/20.5977738e.js"><link rel="prefetch" href="/study-collection/assets/js/21.4dac6c96.js"><link rel="prefetch" href="/study-collection/assets/js/22.b5044e4d.js"><link rel="prefetch" href="/study-collection/assets/js/23.e3760d83.js"><link rel="prefetch" href="/study-collection/assets/js/24.cec3a640.js"><link rel="prefetch" href="/study-collection/assets/js/25.44d53e3a.js"><link rel="prefetch" href="/study-collection/assets/js/26.42ca649b.js"><link rel="prefetch" href="/study-collection/assets/js/27.105ffc67.js"><link rel="prefetch" href="/study-collection/assets/js/28.336d72d4.js"><link rel="prefetch" href="/study-collection/assets/js/29.9485870b.js"><link rel="prefetch" href="/study-collection/assets/js/3.398b82b0.js"><link rel="prefetch" href="/study-collection/assets/js/30.d0809725.js"><link rel="prefetch" href="/study-collection/assets/js/31.54da8fe3.js"><link rel="prefetch" href="/study-collection/assets/js/32.03a8a270.js"><link rel="prefetch" href="/study-collection/assets/js/33.992b2b65.js"><link rel="prefetch" href="/study-collection/assets/js/34.03aab2ec.js"><link rel="prefetch" href="/study-collection/assets/js/35.2f4ba775.js"><link rel="prefetch" href="/study-collection/assets/js/36.eea35a67.js"><link rel="prefetch" href="/study-collection/assets/js/37.96ca2997.js"><link rel="prefetch" href="/study-collection/assets/js/38.73a4f10d.js"><link rel="prefetch" href="/study-collection/assets/js/39.8c77dd2d.js"><link rel="prefetch" href="/study-collection/assets/js/4.7ef535b2.js"><link rel="prefetch" href="/study-collection/assets/js/40.ebfff417.js"><link rel="prefetch" href="/study-collection/assets/js/41.519aa0d7.js"><link rel="prefetch" href="/study-collection/assets/js/42.1c150801.js"><link rel="prefetch" href="/study-collection/assets/js/43.6240de8a.js"><link rel="prefetch" href="/study-collection/assets/js/44.b84fca74.js"><link rel="prefetch" href="/study-collection/assets/js/45.1cc126d8.js"><link rel="prefetch" href="/study-collection/assets/js/46.fd253fd2.js"><link rel="prefetch" href="/study-collection/assets/js/47.590cd851.js"><link rel="prefetch" href="/study-collection/assets/js/48.7198cba8.js"><link rel="prefetch" href="/study-collection/assets/js/49.ee337c98.js"><link rel="prefetch" href="/study-collection/assets/js/5.f59e4bba.js"><link rel="prefetch" href="/study-collection/assets/js/50.366ff6e1.js"><link rel="prefetch" href="/study-collection/assets/js/51.4b527d3b.js"><link rel="prefetch" href="/study-collection/assets/js/52.c13a2e3f.js"><link rel="prefetch" href="/study-collection/assets/js/53.5f19f1c3.js"><link rel="prefetch" href="/study-collection/assets/js/54.5563e2d1.js"><link rel="prefetch" href="/study-collection/assets/js/55.ea854315.js"><link rel="prefetch" href="/study-collection/assets/js/56.a22b06f4.js"><link rel="prefetch" href="/study-collection/assets/js/57.a2380b62.js"><link rel="prefetch" href="/study-collection/assets/js/58.380b5c0c.js"><link rel="prefetch" href="/study-collection/assets/js/59.0d7a0092.js"><link rel="prefetch" href="/study-collection/assets/js/6.b461b06d.js"><link rel="prefetch" href="/study-collection/assets/js/60.60191211.js"><link rel="prefetch" href="/study-collection/assets/js/7.c90e6808.js"><link rel="prefetch" href="/study-collection/assets/js/8.e1a38b84.js"><link rel="prefetch" href="/study-collection/assets/js/9.8109b20c.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.48760978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>스프링 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/spring-in-action/001.html" class="sidebar-link">1장 스프링 속으로</a></li><li><a href="/study-collection/book/spring-in-action/002.html" class="sidebar-link">2장 빈 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/003.html" class="sidebar-link">3장 고급 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/004.html" class="sidebar-link">4장 애스펙트 지향 스프링</a></li><li><a href="/study-collection/book/spring-in-action/005.html" class="active sidebar-link">5장 스프링 웹 어플리케이션 만들기</a></li><li><a href="/study-collection/book/spring-in-action/006.html" class="sidebar-link">6장 웹 뷰 렌더링</a></li><li><a href="/study-collection/book/spring-in-action/007.html" class="sidebar-link">7장 고급 스프링MVC</a></li><li><a href="/study-collection/book/spring-in-action/008.html" class="sidebar-link">8장 스프링 웹플로로 작업하기</a></li><li><a href="/study-collection/book/spring-in-action/009.html" class="sidebar-link">9장 웹 어플리케이션 보안</a></li><li><a href="/study-collection/book/spring-in-action/010.html" class="sidebar-link">10장 스프링과 JDBC를 사용하여 데이터베이스 사용하기</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_5강"><a href="#_5강" class="header-anchor">#</a> 5강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-스프링-mvc-시작하기">1. 스프링 MVC 시작하기</a></li><li><a href="#_2-스프링-mvc-설정하기">2. 스프링 MVC 설정하기</a><ul><li><a href="#_2-1-dispatcherservlet-설정하기">2-1. DispatcherServlet 설정하기</a></li><li><a href="#_2-2-두-애플리케이션-컨텍스트">2-2. 두 애플리케이션 컨텍스트</a></li><li><a href="#_2-3-스프링-mvc-활성화하기">2-3 스프링 MVC 활성화하기</a></li></ul></li><li><a href="#_3-간단한-컨트롤러-작성하기">3. 간단한 컨트롤러 작성하기</a><ul><li><a href="#_3-1-컨트롤러-테스팅">3-1 컨트롤러 테스팅</a></li><li><a href="#_3-2-클래스-레벨-요청-처리-정의하기">3-2 클래스 레벨 요청 처리 정의하기</a></li><li><a href="#_3-3-뷰에-모델-전달">3-3 뷰에 모델 전달</a></li></ul></li><li><a href="#_4-요청-입력받기">4. 요청 입력받기</a><ul><li><a href="#_4-1-쿼리-파라미터">4-1 쿼리 파라미터</a></li><li><a href="#_4-2-패스-파라미터">4-2 패스 파라미터</a></li><li><a href="#_4-3-form">4-3 Form</a></li><li><a href="#_4-4-form-검증">4-4 Form 검증</a></li></ul></li></ul></div><p></p> <h2 id="_1-스프링-mvc-시작하기"><a href="#_1-스프링-mvc-시작하기" class="header-anchor">#</a> 1. 스프링 MVC 시작하기</h2> <ul><li>사용자가 웹브라우저에서 작업을 하면, 리퀘스트가 서버로 들어가고, 작업 처리 후 리스폰스를 반환한다.</li> <li>그 작업 처리를 해주는 부분이 스프링 MVC 이다.</li></ul> <p><img src="/study-collection/assets/img/mvc1.4b11a46d.jpg" alt="Alt text"></p> <ul><li>1에서 리퀘스트가 들어 올 때, 사용자가 원하는 정보가 포함되어 전달이 된다.</li> <li>리퀘스트의 첫 정거장은 프로트 컨트롤러 역할을 하는 DispatcherServlet이다.</li> <li>DispatcherServlet의 임무는 리퀘스트를 스프링 MVC 컨트롤러로 전달하는 일이다.</li> <li>일반적으로 어플리케이션은 여러개의 컨트롤러가 있어서 어떠한 컴포넌트로 찾아갈지 2의 핸들러 매핑에게 도움을 청한다.</li> <li>핸들러 매핑을 통해 컨트롤러가 선택되면, DispatcherServlet은 선택된 컨트롤러 3으로 리퀘스트를 전달한다.</li> <li>컨트롤러에서 요청은 페이로드 (사용자에 의해 입력된 정보) 를 떨군다.</li> <li>컨트롤러가 내부 로직을 타서 리퀘스트를 잘 처리하면, 브라우저에 표시되기 위한 형태의 정보를 반환하는데, 이것을 보통 모델이라고 한다.</li> <li>이때 컨트롤러는 뷰의 이름도 같이 던지게 되는데, DispatcherServlet은 이걸 받아서 view resolver에서 적절핟 뷰를 매핑해 다시 던져준다.</li> <li>위의 작업이 완료되면, 이제 리스폰스에 해당 정보를 담아 화면단으로 던져준다.</li></ul> <h2 id="_2-스프링-mvc-설정하기"><a href="#_2-스프링-mvc-설정하기" class="header-anchor">#</a> 2. 스프링 MVC 설정하기</h2> <h3 id="_2-1-dispatcherservlet-설정하기"><a href="#_2-1-dispatcherservlet-설정하기" class="header-anchor">#</a> 2-1. DispatcherServlet 설정하기</h3> <ul><li>DispatcherServlet을 설정하는 방법은 web.xml 과 java 설정이 있다. web.xml은 버림</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpittrWebAppInitializer</span>
        <span class="token keyword">extends</span> <span class="token class-name">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="token punctuation">{</span>
        
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//DispatcherServlet을 /에 매핑</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getRootConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token class-name">RootConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getServletConfigClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 설정 클래스를 지정해 준다.</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token class-name">WebConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>서블릿 3.0 환경에서 컨테이너는 클래스패스 내의 javax.servlet.ServletContainerInitializer 인터페이스를 구현한 모든 클래스들을 찾아보도록 되어 있다.</li> <li>여기서 발견된 클래스들은 서블릿 컨테이너들을 설정하는데 사용된다.</li> <li>스프링은 SpringServletContainerInitailizer의 구현을 제공하고, 순차적으로 WebApplicationInitializer의 구현 클래스를 찾아 설정을 위임한다.</li> <li>스프링에선 AbstractAnnotationConfigDispatcherServletInitializer라고 하는 미리 구성되어있는 WebApplicationInitializer의 구현체를 만들어 놓았다.</li> <li>위의 코드 설정도, AbstractAnnotationConfigDispatcherServletInitializer를 상속 받아 기초 설정들을 스프링이 찾을 수 있도록 설정을 해 주었음.</li></ul> <h3 id="_2-2-두-애플리케이션-컨텍스트"><a href="#_2-2-두-애플리케이션-컨텍스트" class="header-anchor">#</a> 2-2. 두 애플리케이션 컨텍스트</h3> <ul><li>DispatcherServlet이 시작되면 스프링 어플리케이션 컨텍스트를 생성하고, WebConfig 에서 설정된 빈을 로딩한다.</li> <li>DispatcherServlet은 컨트롤러, 뷰리졸버, 핸들러 매핑과 같은 웹 컴포넌트가 포함된 빈을 로딩한다.</li> <li>ContextLoaderListener는 그 외의 다른 빈들을 로딩한다.</li> <li>내부적으로 AbstractAnnotationConfigDispatcherServletInitializer는 DispatcherServlet과 ContextLoaderListenr를 생성한다.</li> <li>ContextLoader의 설정은 RootConfig 에 설정되어있고, DispatcherServlet은 WebConfig에 설정 되어 있다.</li> <li>이러한 java클래스를 사용한 DispatcherServlet 설정 방식은 톰캣 7 과 같이 서블릿 3.0 이상을 지원하는 서버에서반 작동을 한다.</li></ul> <h3 id="_2-3-스프링-mvc-활성화하기"><a href="#_2-3-스프링-mvc-활성화하기" class="header-anchor">#</a> 2-3 스프링 MVC 활성화하기</h3> <ul><li>가장 간단하게 MVC 설정 방법은 @EnableWebMvc 어노테이션을 붙여주는거다</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위와 같이 설정하면, 기본적인 MVC를 적용한다는 것을 스프링에겐 알려주지만 조금더 디테일한 설정이 필요하다</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span> <span class="token comment">// Spring MVC 활성화</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;spitter.web&quot;</span><span class="token punctuation">)</span> <span class="token comment">// component scan 활성화</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// JSP 뷰 리졸버 설정</span>
        <span class="token class-name">InternalResourceViewResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InternalResourceViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">&quot;.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setExposeContextBeansAsAttributes</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configurerDefaultServletHandling</span><span class="token punctuation">(</span>
        <span class="token class-name">DefaultServlethandlerConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 정적 콘텐츠 처리 설정</span>
        configurer<span class="token punctuation">.</span><span class="token function">enalbe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 추가적인 설정을 통해 필요한 설정들을 해줘야 한다.</li> <li>참고 RootConfig</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;spitter&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    excludeFilters<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token class-name">EnableWebMvc</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RootConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// 자세한건 뒤에서 보도록합시당</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Spitter 어플리케이션을 예제 소스로 개발한다.</li> <li>Spring + Twitter 란다..</li> <li>MVC 에서 컨트롤러는 메소드를 포함하는 단순한 클래스, @RequestMapping이 있다.</li></ul> <h2 id="_3-간단한-컨트롤러-작성하기"><a href="#_3-간단한-컨트롤러-작성하기" class="header-anchor">#</a> 3. 간단한 컨트롤러 작성하기</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET<span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 컨트롤러에서 리턴을 단순히 스트링 &quot;home&quot;을 해주지만, 이 String은 스프링 MVC에 의해 렌더링할 뷰의 이름으로 해석이 된다.</li> <li>DispatcherServlet은 뷰 리졸버에게 이 뷰의 이름으로 실제 뷰를 결정하도록 요청한다.</li> <li>실제로 WebConfig에서 jsp로 설정을 해서 home.jsp로 찾아가게 된다.</li> <li>HomeController를 다른 관점에서 보면, 어노테이션만 제외하면 POJO이다.</li></ul> <h3 id="_3-1-컨트롤러-테스팅"><a href="#_3-1-컨트롤러-테스팅" class="header-anchor">#</a> 3-1 컨트롤러 테스팅</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeControllerTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">HomeController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HomeController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;home&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위와같은 형태는 완전 야매 테스트코드로, 단순 컨트롤러 호출시 String home을 리턴하는지만 봐줘서 MVC와는 관계가 없다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeControllerTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">HomeController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HomeController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MockMvc</span> mockMvc <span class="token operator">=</span> <span class="token function">standaloneSetup</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MockMvc 셋업</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 테스트코드는 MockMvc 객체를 통해 &quot;/&quot; 에 get 메소드를 호출해 해당 뷰 이름이 home인지 체크한다.</li></ul> <h3 id="_3-2-클래스-레벨-요청-처리-정의하기"><a href="#_3-2-클래스-레벨-요청-처리-정의하기" class="header-anchor">#</a> 3-2 클래스 레벨 요청 처리 정의하기</h3> <ul><li>클래스 레벨로 패스 매핑을 위한 부분을 따로 두도록 변경해 보자</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span>GET<span class="token punctuation">)</span> <span class="token comment">// 이런식으로 분리해준다.</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 소스에는 클래스 레벨에서 핸들러 메소드는 &quot;/&quot; 하나를 사용한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/homepage&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 이런식으로 핸들러를 2개를 받을 수도 있다.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-3-뷰에-모델-전달"><a href="#_3-3-뷰에-모델-전달" class="header-anchor">#</a> 3-3 뷰에 모델 전달</h3> <ul><li>실제로 위에처럼 간단하게 스트링만 넘겨주면 편하겠지만, 데이터를 화면에 넘겨줘야할일이 많다.(거의 대부분이다)</li> <li>위의 예시에서 데이터에 접근하기위한 SpittleRepository를 정의해 준다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpittleRepository</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> <span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token keyword">long</span> max<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 최대 ID값 , 총 갯수</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> spittr<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spittle</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Date</span> time<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Double</span> latitude<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Double</span> longitude<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token class-name">Spittle</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Date</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">Spittle</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Date</span> time<span class="token punctuation">,</span> <span class="token class-name">Double</span> longitude<span class="token punctuation">,</span> <span class="token class-name">Double</span> latitude<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>longitude <span class="token operator">=</span> longitude<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>latitude <span class="token operator">=</span> latitude<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> time<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> latitude<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> longitude<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">HashCodeBuilder</span><span class="token punctuation">.</span><span class="token function">reflectionHashCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Apache Common Langs</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> that<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">EqualsBuilder</span><span class="token punctuation">.</span><span class="token function">reflectionEquals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> that<span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Apache Common Langs</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>기본적인 POJO vo 형태이며, haseCode 와 eqauls는 apache common langs 내 메소드를 사용했다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldShowRecentSpittles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> expectedSpittles <span class="token operator">=</span> <span class="token function">createSpittleList</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpittelRepository</span> mockRepository <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">SpittleRepository</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mock 저장소</span>
    <span class="token function">when</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SpittleController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpittleController</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MockMvc</span> mockMvc <span class="token operator">=</span> <span class="token function">standaloneSetup</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSingleView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternalResourceView</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views/spittles.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/spittles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;spittles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attributeExists</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">,</span> 
                                    <span class="token function">hasItems</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre></div><ul><li>/spittles에 대한 GET 요청을 수행하고, 뷰 이름이 spittles인지 모델이 spittleList인지 테스트 한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/spittles&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpittleController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">SpittleRepository</span> spittleRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SpittleController</span><span class="token punctuation">(</span><span class="token class-name">SpittleRepository</span> spittleRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>spittleRepository <span class="token operator">=</span> spittleRepository<span class="token punctuation">;</span> 
        <span class="token comment">// 이 구현체를 구현한게 없어서 오토와이어안됨..</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spittles</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// model 추가</span>
        model<span class="token punctuation">.</span><span class="token function">addAtrribute</span><span class="token punctuation">(</span>spittleRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span>
            <span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">20</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;spittles&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 Model을 추가해 값을 넘길 수도 있다. Map같은거 써도되는데 개인적으로 비추</li> <li>위의 모델은 key,value로 매핑되는데, 키가 없을경우 값으로 설정된 객체 타입으로 추측한다.</li> <li>위엔 객체 타입이 List<Spittle> 이므로, 키는 spittleList로 추측된다.</Spittle></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> <span class="token function">spittles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> spittleRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>모델과는 다른 방법인데, 뷰이름이나 모델을 리턴하는게 아닌 Spittle List를 리턴한다.</li> <li>이럴 경우, 핸들러 메소드가 객체나 컬렉션의 리턴값은 모델로 설정하고, 키는 타입에 따라 추측한다. (spittleList)</li> <li>뷰의 네임은 요청 패스를 통해 추론되는데, /spittles의 GET요청을 처리하는거로 확인되어, spittles로 뷰네임을 설정해 준다.</li> <li>위의 spittles를 호출하면, Spittle 객체 리스트는 SpittleList 키와 함께 모델에 저장되고, 뷰 자체의 이름은 spittles가 된다.
= InternalResourceViewResolver에 설정된 방법에 따라 뷰는 spittles.jsp로 찾아간다.</li></ul> <h2 id="_4-요청-입력받기"><a href="#_4-요청-입력받기" class="header-anchor">#</a> 4. 요청 입력받기</h2> <ul><li>클라이어트에서 컨트롤러의 핸들러 메소드로 데이터를 전달해주는 방법</li></ul> <div class="language- extra-class"><pre class="language-text"><code>1. 쿼리 파라미터
2. 폼 파라미터
3. 패스 변수
</code></pre></div><h3 id="_4-1-쿼리-파라미터"><a href="#_4-1-쿼리-파라미터" class="header-anchor">#</a> 4-1 쿼리 파라미터</h3> <ul><li>위의 SpittleController에서 max 파라미터와 count 파라미터를 받게 구현해보자</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldShowRecentSpittles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> expectedSpittles <span class="token operator">=</span> <span class="token function">createSpittleList</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpittelRepository</span> mockRepository <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">SpittleRepository</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mock 저장소</span>
    <span class="token function">when</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">.</span><span class="token function">findSpittles</span><span class="token punctuation">(</span><span class="token number">238900</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// max 와 count 파라미터를 예상</span>
        <span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SpittleController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpittleController</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MockMvc</span> mockMvc <span class="token operator">=</span> <span class="token function">standaloneSetup</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSingleView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternalResourceView</span><span class="token punctuation">(</span><span class="token string">&quot;/WEB-INF/views/spittles.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/spittles?max=238900&amp;count=50&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 쿼리 파라미터로 값을 받는다.</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;spittles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attributeExists</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">&quot;spittleList&quot;</span><span class="token punctuation">,</span> 
                                    <span class="token function">hasItems</span><span class="token punctuation">(</span>expectedSpittles<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre></div><ul><li>기존과 달라진 점은 GET 요청을 max 와 count를 쿼리 파라미터로 포함시켜 받은 점이다</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token class-name">RequestMapping</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spittle</span><span class="token punctuation">&gt;</span></span> spittles <span class="token punctuation">(</span>
    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span>
                  defaultValue<span class="token operator">=</span>MAX_LONG_AS_STRING<span class="token punctuation">)</span> <span class="token keyword">long</span> max<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// @RequestParam 어노테이션으로 쿼리파라미터로 받을 변수들을 설정해 준다.</span>
        <span class="token comment">// 초기값 설정도 가능</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-2-패스-파라미터"><a href="#_4-2-패스-파라미터" class="header-anchor">#</a> 4-2 패스 파라미터</h3> <ul><li>위와 같은 쿼리 파라미터는 동작은 되지만, 리소스 관점에서 이상적인 방식은 아니다.</li> <li>리소스가 쿼리 파라미터가 아닌 URL 패스에 의해 식별되어야 이상적임</li> <li>즉 /spittles/show?abcd=def 따위보다 /spittles/show/def 이런게 좀더 보기 좋다</li> <li>전자는 검색될 리소스를 식별하지만, 후자는 파라미터에 대한 동작을 서술하는데 기본적으로는 HTTP 상의 RPC이다.</li> <li>이런 패스 파라미터를 사용하기 위해선, @RequestMapping 패스에 플레이스홀더를 사용한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{spittleId}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">ReequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spittle</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;spittleId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> spittleId<span class="token punctuation">,</span>
    <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAtribute</span><span class="token punctuation">(</span>spittleRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>spittleId<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">&quot;spittle&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 @RequestMapping 엔 {플레이스홀더} 로 처리를 하고, 실제 파라미터로 @PathVariable을 사용해 값을 받아온다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{spittleId}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">ReequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spittle</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">long</span> spittleId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAtribute</span><span class="token punctuation">(</span>spittleRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>spittleId<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">&quot;spittle&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>패스 파라미터와, 파라미터 인자가 이름이 같으면 키값이 보기싫으니까 생략도 가능</li> <li>요기서 모델로 담아준거는 Spittle 객체이므로, 키값은 spittle 이고, 실제 jsp에선 아래처럼 사용한다.</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>spittleView<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>spittleMessage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">c:</span>out</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${spittle.message}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_4-3-form"><a href="#_4-3-form" class="header-anchor">#</a> 4-3 Form</h3> <ul><li>위와 같이 패스 파라미터로 보낼때 값이 몇개 없으면 간단하게 보낼 수 있지만 만항지면 복잡해진다.</li> <li>이럴 때 사용하는게 바로 폼</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    FirstName: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>firstName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    ...

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Register<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
...
</code></pre></div><ul><li>등록 form jsp</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/spittr&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpitterController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">SpitterRepository</span> spitterRepository<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SpitterController</span><span class="token punctuation">(</span><span class="token class-name">SpitterRepository</span> spitterRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>spitterRepository <span class="token operator">=</span> spitterRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET<span class="token punctuation">)</span> 
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">showRegistrationForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> registerForm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processingRegistration</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        spitterRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/spitter/&quot;</span> <span class="token operator">+</span> spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{username}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>GET
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">showSpitterProfile</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Spitter</span> spitter <span class="token operator">=</span> spitterRepository<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;profile&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 post 메소드를 살펴보면, 위의 html에서 보내주는 Spitter 객체 형태로 파라미터로 받고, 저장한다.</li> <li>이후에 리다이렉트를 해주는데, InternalResourceViewResolver에서 처리하며, forward도 있음</li></ul> <h3 id="_4-4-form-검증"><a href="#_4-4-form-검증" class="header-anchor">#</a> 4-4 Form 검증</h3> <ul><li>사용자가 username이나 password를 비워둔 채로 폼을 제출하면, 공백으로 Spitter 객체를 생서하게 된다.</li> <li>요런 경우 잘못된 요청이므로, 걸러줘야 한다.</li> <li>핸들러 메소드를 검증 로직따위로 꽉꽉 채우지 말고, 스프링에서 제공하는 자바 인증 api를 사용하면 좋다.</li></ul> <p><img src="/study-collection/assets/img/mvc3.d7999d2a.png" alt="Alt text"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spitter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>  max<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span>POST<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">processRegistration</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@Valid</span> <span class="token class-name">Spitter</span> spitter<span class="token punctuation">,</span> <span class="token class-name">Errors</span> erros<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;registerForm&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 검증 오류가 나면 error 에서 잡힌다.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/spring-in-action/004.html" class="prev">4장 애스펙트 지향 스프링</a></span> <span class="next"><a href="/study-collection/book/spring-in-action/006.html">6장 웹 뷰 렌더링</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.e26ebf70.js" defer></script><script src="/study-collection/assets/js/2.7ece6ebb.js" defer></script><script src="/study-collection/assets/js/19.c4d4a505.js" defer></script>
  </body>
</html>
