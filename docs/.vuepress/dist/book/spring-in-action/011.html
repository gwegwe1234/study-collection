<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>11강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.48760978.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.65d03ea7.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.f504b8bc.js" as="script"><link rel="preload" href="/study-collection/assets/js/46.5c443226.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.41791bdb.js"><link rel="prefetch" href="/study-collection/assets/js/100.3a5883ac.js"><link rel="prefetch" href="/study-collection/assets/js/101.db21ac59.js"><link rel="prefetch" href="/study-collection/assets/js/102.e73dc207.js"><link rel="prefetch" href="/study-collection/assets/js/103.441a913e.js"><link rel="prefetch" href="/study-collection/assets/js/104.7a705b88.js"><link rel="prefetch" href="/study-collection/assets/js/105.9a17fa3f.js"><link rel="prefetch" href="/study-collection/assets/js/106.f6292fb6.js"><link rel="prefetch" href="/study-collection/assets/js/107.2d3d76e6.js"><link rel="prefetch" href="/study-collection/assets/js/108.d5d0f45b.js"><link rel="prefetch" href="/study-collection/assets/js/109.77437451.js"><link rel="prefetch" href="/study-collection/assets/js/11.caa8ceaa.js"><link rel="prefetch" href="/study-collection/assets/js/110.adcbee07.js"><link rel="prefetch" href="/study-collection/assets/js/111.f7cc14f4.js"><link rel="prefetch" href="/study-collection/assets/js/112.62dbe207.js"><link rel="prefetch" href="/study-collection/assets/js/113.08d9a8c3.js"><link rel="prefetch" href="/study-collection/assets/js/114.cd885318.js"><link rel="prefetch" href="/study-collection/assets/js/115.0072620f.js"><link rel="prefetch" href="/study-collection/assets/js/116.921e42e4.js"><link rel="prefetch" href="/study-collection/assets/js/117.81ac7ea3.js"><link rel="prefetch" href="/study-collection/assets/js/118.e5fadc3f.js"><link rel="prefetch" href="/study-collection/assets/js/119.a6cb9093.js"><link rel="prefetch" href="/study-collection/assets/js/12.7912686e.js"><link rel="prefetch" href="/study-collection/assets/js/120.197b75bc.js"><link rel="prefetch" href="/study-collection/assets/js/121.855786de.js"><link rel="prefetch" href="/study-collection/assets/js/122.32b23b66.js"><link rel="prefetch" href="/study-collection/assets/js/13.6662360c.js"><link rel="prefetch" href="/study-collection/assets/js/14.48818be1.js"><link rel="prefetch" href="/study-collection/assets/js/15.79be0a3f.js"><link rel="prefetch" href="/study-collection/assets/js/16.738ed49a.js"><link rel="prefetch" href="/study-collection/assets/js/17.c63720b3.js"><link rel="prefetch" href="/study-collection/assets/js/18.fc8a1bc3.js"><link rel="prefetch" href="/study-collection/assets/js/19.3966bd0d.js"><link rel="prefetch" href="/study-collection/assets/js/20.0e4f7e23.js"><link rel="prefetch" href="/study-collection/assets/js/21.74f821a8.js"><link rel="prefetch" href="/study-collection/assets/js/22.006d7492.js"><link rel="prefetch" href="/study-collection/assets/js/23.bc6125f8.js"><link rel="prefetch" href="/study-collection/assets/js/24.bea7de70.js"><link rel="prefetch" href="/study-collection/assets/js/25.963bf479.js"><link rel="prefetch" href="/study-collection/assets/js/26.8a64689d.js"><link rel="prefetch" href="/study-collection/assets/js/27.235380e9.js"><link rel="prefetch" href="/study-collection/assets/js/28.1f1c72b6.js"><link rel="prefetch" href="/study-collection/assets/js/29.58e051c5.js"><link rel="prefetch" href="/study-collection/assets/js/3.f7bb52fb.js"><link rel="prefetch" href="/study-collection/assets/js/30.56915c0a.js"><link rel="prefetch" href="/study-collection/assets/js/31.bdc1e66f.js"><link rel="prefetch" href="/study-collection/assets/js/32.3cda140b.js"><link rel="prefetch" href="/study-collection/assets/js/33.7e8cb48a.js"><link rel="prefetch" href="/study-collection/assets/js/34.ff8ddf04.js"><link rel="prefetch" href="/study-collection/assets/js/35.ebb2c76d.js"><link rel="prefetch" href="/study-collection/assets/js/36.271f97b6.js"><link rel="prefetch" href="/study-collection/assets/js/37.b8217726.js"><link rel="prefetch" href="/study-collection/assets/js/38.46be2fc6.js"><link rel="prefetch" href="/study-collection/assets/js/39.5c1f2525.js"><link rel="prefetch" href="/study-collection/assets/js/4.be408479.js"><link rel="prefetch" href="/study-collection/assets/js/40.1239d9d7.js"><link rel="prefetch" href="/study-collection/assets/js/41.8723ba9a.js"><link rel="prefetch" href="/study-collection/assets/js/42.c9ec46a4.js"><link rel="prefetch" href="/study-collection/assets/js/43.96289944.js"><link rel="prefetch" href="/study-collection/assets/js/44.7481c1c9.js"><link rel="prefetch" href="/study-collection/assets/js/45.94122945.js"><link rel="prefetch" href="/study-collection/assets/js/47.b414e5a9.js"><link rel="prefetch" href="/study-collection/assets/js/48.b6312261.js"><link rel="prefetch" href="/study-collection/assets/js/49.792a269b.js"><link rel="prefetch" href="/study-collection/assets/js/5.9a3d93a0.js"><link rel="prefetch" href="/study-collection/assets/js/50.f7732566.js"><link rel="prefetch" href="/study-collection/assets/js/51.ed4523d7.js"><link rel="prefetch" href="/study-collection/assets/js/52.f77b286c.js"><link rel="prefetch" href="/study-collection/assets/js/53.d969fac2.js"><link rel="prefetch" href="/study-collection/assets/js/54.16e6404a.js"><link rel="prefetch" href="/study-collection/assets/js/55.d7bc2f95.js"><link rel="prefetch" href="/study-collection/assets/js/56.9906ceb8.js"><link rel="prefetch" href="/study-collection/assets/js/57.4826cb9d.js"><link rel="prefetch" href="/study-collection/assets/js/58.53810a11.js"><link rel="prefetch" href="/study-collection/assets/js/59.597a6568.js"><link rel="prefetch" href="/study-collection/assets/js/6.d972300e.js"><link rel="prefetch" href="/study-collection/assets/js/60.bba2fc52.js"><link rel="prefetch" href="/study-collection/assets/js/61.cc2592b0.js"><link rel="prefetch" href="/study-collection/assets/js/62.59a4b1e8.js"><link rel="prefetch" href="/study-collection/assets/js/63.9f90cff7.js"><link rel="prefetch" href="/study-collection/assets/js/64.fcab4508.js"><link rel="prefetch" href="/study-collection/assets/js/65.06cd00a9.js"><link rel="prefetch" href="/study-collection/assets/js/66.59798667.js"><link rel="prefetch" href="/study-collection/assets/js/67.9b570a86.js"><link rel="prefetch" href="/study-collection/assets/js/68.f285d15a.js"><link rel="prefetch" href="/study-collection/assets/js/69.59f2b82a.js"><link rel="prefetch" href="/study-collection/assets/js/7.bf4d57cc.js"><link rel="prefetch" href="/study-collection/assets/js/70.4d509565.js"><link rel="prefetch" href="/study-collection/assets/js/71.380eb6fe.js"><link rel="prefetch" href="/study-collection/assets/js/72.19e9c587.js"><link rel="prefetch" href="/study-collection/assets/js/73.a7a308b0.js"><link rel="prefetch" href="/study-collection/assets/js/74.c221c038.js"><link rel="prefetch" href="/study-collection/assets/js/75.617d2890.js"><link rel="prefetch" href="/study-collection/assets/js/76.22584d85.js"><link rel="prefetch" href="/study-collection/assets/js/77.ce32320b.js"><link rel="prefetch" href="/study-collection/assets/js/78.2730a58a.js"><link rel="prefetch" href="/study-collection/assets/js/79.2a59303d.js"><link rel="prefetch" href="/study-collection/assets/js/8.281855fd.js"><link rel="prefetch" href="/study-collection/assets/js/80.b8321bde.js"><link rel="prefetch" href="/study-collection/assets/js/81.a01aef60.js"><link rel="prefetch" href="/study-collection/assets/js/82.ec1772b3.js"><link rel="prefetch" href="/study-collection/assets/js/83.64090e4a.js"><link rel="prefetch" href="/study-collection/assets/js/84.80a36bcf.js"><link rel="prefetch" href="/study-collection/assets/js/85.46dd6640.js"><link rel="prefetch" href="/study-collection/assets/js/86.aacce767.js"><link rel="prefetch" href="/study-collection/assets/js/87.4401214c.js"><link rel="prefetch" href="/study-collection/assets/js/88.988e6cca.js"><link rel="prefetch" href="/study-collection/assets/js/89.1c0abc67.js"><link rel="prefetch" href="/study-collection/assets/js/9.1d201326.js"><link rel="prefetch" href="/study-collection/assets/js/90.40c5c586.js"><link rel="prefetch" href="/study-collection/assets/js/91.21207215.js"><link rel="prefetch" href="/study-collection/assets/js/92.929ab16d.js"><link rel="prefetch" href="/study-collection/assets/js/93.0c2f8a47.js"><link rel="prefetch" href="/study-collection/assets/js/94.a0557841.js"><link rel="prefetch" href="/study-collection/assets/js/95.8ccd9537.js"><link rel="prefetch" href="/study-collection/assets/js/96.713dd8f7.js"><link rel="prefetch" href="/study-collection/assets/js/97.2c7e8281.js"><link rel="prefetch" href="/study-collection/assets/js/98.916f6105.js"><link rel="prefetch" href="/study-collection/assets/js/99.c759b84e.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.48760978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>스프링 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/spring-in-action/001.html" class="sidebar-link">1장 스프링 속으로</a></li><li><a href="/study-collection/book/spring-in-action/002.html" class="sidebar-link">2장 빈 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/003.html" class="sidebar-link">3장 고급 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/004.html" class="sidebar-link">4장 애스펙트 지향 스프링</a></li><li><a href="/study-collection/book/spring-in-action/005.html" class="sidebar-link">5장 스프링 웹 어플리케이션 만들기</a></li><li><a href="/study-collection/book/spring-in-action/006.html" class="sidebar-link">6장 웹 뷰 렌더링</a></li><li><a href="/study-collection/book/spring-in-action/007.html" class="sidebar-link">7장 고급 스프링MVC</a></li><li><a href="/study-collection/book/spring-in-action/008.html" class="sidebar-link">8장 스프링 웹플로로 작업하기</a></li><li><a href="/study-collection/book/spring-in-action/009.html" class="sidebar-link">9장 웹 어플리케이션 보안</a></li><li><a href="/study-collection/book/spring-in-action/010.html" class="sidebar-link">10장 스프링과 JDBC를 사용하여 데이터베이스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/011.html" class="active sidebar-link">11장 객체 관계형 매핑을 통한 데이터 퍼시스팅</a></li><li><a href="/study-collection/book/spring-in-action/012.html" class="sidebar-link">12장 NoSQL 데이터베이스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/013.html" class="sidebar-link">13장 데이터 캐싱하기</a></li><li><a href="/study-collection/book/spring-in-action/014.html" class="sidebar-link">14장 시큐리티 메소드</a></li><li><a href="/study-collection/book/spring-in-action/015.html" class="sidebar-link">15장 원격 서비스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/016.html" class="sidebar-link">16장 스프링 MVC로 REST API 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/017.html" class="sidebar-link">17장 스프링 메시징</a></li><li><a href="/study-collection/book/spring-in-action/018.html" class="sidebar-link">18장 WebSocket과 STOMP를 사용하여 메시징하기</a></li><li><a href="/study-collection/book/spring-in-action/019.html" class="sidebar-link">19장 이메일 전송을 위해 스프링 설정하기</a></li><li><a href="/study-collection/book/spring-in-action/020.html" class="sidebar-link">20장 JMX를 이용한 스프링 빈 관리</a></li><li><a href="/study-collection/book/spring-in-action/021.html" class="sidebar-link">21장 스프링 부트를 사용한 스프링 개발 간소화</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>고 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Go 언어를 활용한 마이크로서비스 개발</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>카프카 스트림즈 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>모던 자바 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>객체지향의 사실과 오해</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_11강"><a href="#_11강" class="header-anchor">#</a> 11강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#intro">Intro</a></li><li><a href="#_1-스프링과-하이버네이트-통합">1. 스프링과 하이버네이트 통합</a><ul><li><a href="#_1-1-하이버네이트-세션-팩토리-선언">1-1. 하이버네이트 세션 팩토리 선언</a></li><li><a href="#_1-2-스프링으로부터-해방된-하이버네이트-구성">1-2. 스프링으로부터 해방된 하이버네이트 구성</a></li></ul></li><li><a href="#_2-스프링과-자바-퍼시스턴스-api">2. 스프링과 자바 퍼시스턴스 API</a><ul><li><a href="#_2-1-엔티티-관리자-팩토리-설정">2-1. 엔티티 관리자 팩토리 설정</a></li><li><a href="#_2-2-jpa-기반-저장소-작성">2-2. JPA 기반 저장소 작성</a></li></ul></li><li><a href="#_3-스프링-데이터를-사용한-자동-jpa-저장소">3. 스프링 데이터를 사용한 자동 JPA 저장소</a><ul><li><a href="#_3-1-쿼리-메소드-정의하기">3-1. 쿼리 메소드 정의하기</a></li><li><a href="#_3-2-맞춤형-쿼리-선언하기">3-2 맞춤형 쿼리 선언하기</a></li><li><a href="#_3-3-맞춤형-기능-혼합">3-3. 맞춤형 기능 혼합</a></li></ul></li></ul></div><p></p> <h2 id="intro"><a href="#intro" class="header-anchor">#</a> Intro</h2> <ul><li>퍼시스턴스 기술에서 필요한 복잡한 기술들
<ul><li>지연 로딩 (lazy loading) : 필요한 데이터만 불러오고 로딩을 최대한 늦추는 기능</li> <li>조기 인출 (eager fetching) : 지연 로딩의 반대 개념. 한번의 쿼리로 전체 객체 구조를 가져오는 것. 한번의 연산으로 모든 데이터를 가져와서 매번 DB &lt;-&gt; 어플리케이션 비용을 줄임</li> <li>캐스케이딩 (cascading) : DB 테이블에 변경이 있을 때, 다른 테이블도 동일하게 변경되어야 하는 경우가 존재한다.</li></ul></li></ul> <hr> <ul><li>이런 서비스들을 객체 관계 매핑 (ORM, Obeject-Relational-Mapping) 라고 부른다.</li> <li>어플리케이션의 퍼시스턴스 계층에 ORM 도구를 사용하면 많은 양의 코드를 줄이고 개발 시간을 단축한다.</li> <li>SQL문도 안써서 오류를 줄일 수도 있어 요구사항에 좀더 집중하게 만들어준다.</li></ul> <hr> <ul><li>스프링은 ORM 프레임워크를 지원하기 위해 다음과 같은 부가적인 서비스를 제공한다.
<ul><li>스프링의 선언적 트랜잭션에 대한 통합된 지원</li> <li>투명한 예외 처리</li> <li>스레드 안정성을 갖춘 경량의 템플릿 클래스</li> <li>DAO 지원 클래스</li> <li>자원 관리</li></ul></li></ul> <h2 id="_1-스프링과-하이버네이트-통합"><a href="#_1-스프링과-하이버네이트-통합" class="header-anchor">#</a> 1. 스프링과 하이버네이트 통합</h2> <h3 id="_1-1-하이버네이트-세션-팩토리-선언"><a href="#_1-1-하이버네이트-세션-팩토리-선언" class="header-anchor">#</a> 1-1. 하이버네이트 세션 팩토리 선언</h3> <ul><li>org.hibernate.Session은 하이버네이트 작업에 가장 중심이 되는 인터페이스</li> <li>Session 인터페이스는 데이터베이스로부터 객체에대한 저장, 업데이트, 삭제, 로드같은 기본적인 데이터 엑세스 기능을 제공한다.</li> <li>Session 객체 레퍼런스를 얻으려면 SessionFactory 인터페이스를 사용해야 한다.</li> <li>스프링에서 하이버네이트 Session 설정하는 팩토리 빈
<ul><li>org.springframework.orm.hibernate3.LocalSessionFactoryBean</li> <li>org.springframework.orm.hibernate3.annotation.AnnotationSession-FactoryBean</li> <li>org.springframework.orm.hibernate4.LocalSessionFactoryBean</li></ul></li> <li>이러한 세션 팩토리 빈은 스프링의 FactoryBean 인터페이스의 구현체이다.</li></ul> <hr> <ul><li>하이버네이트 3.2 ~ 4.0 사이의 버전을 XML로 매핑한다면, 스프링의 org.springframework.orm.hibernate3.LocalSessionFactoryBean 을 사용해 빈 설정을 해준다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalSessionFactoryBean</span> <span class="token function">sessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">LocalSessionFactoryBean</span> sfb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setMappingResources</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;Spitter.hbm.xml&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;dialect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.hibernate.dialect.H2Dialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setHibernateProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sfb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>하이버네이트 4가 아니고 어노테이션을 사용하면 AnnotationSessionFactoryBean 을 사용한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AnnotationSessionFactoryBean</span> <span class="token function">sessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> ds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">AnnotationSessionFactoryBean</span> sfb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setPackagesToScan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;com.habuma.spittr.domain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;dialect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.hibernate.dialect.H2Dialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setHibernateProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sfb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>하이버네이트 4를 사용한다면 org.springframework.orm.hibernate4.LocalSessionFactoryBean</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalSessionFactoryBean</span> <span class="token function">sessionFactory</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">LocalSessionFactoryBean</span> sfb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setPackagesToScan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;com.habuma.spittr.domain&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;dialect&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.hibernate.dialect.H2Dialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfb<span class="token punctuation">.</span><span class="token function">setHibernateProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sfb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>3버전과 차이점은 하이버네이트 매핑 파일을 나열하는 대신, packagesToScan으로 패키징을 검사한다.</li> <li>JPA 의 @Entity나 @MappingSuperclass, 하이버네이트의 @Entity 가 포함된다.</li> <li>class 명으로도 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>sfb<span class="token punctuation">.</span><span class="token function">setAnnotationClasses</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">Spitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> spittle<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>몇 개 안되는 도메인 설정을 할 땐 annotatedClass 가 나쁘진 않다.</li> <li>많거나, 모두 나열하고 싶지 않으면 pacakgesToScan 이 더 적합하다.</li></ul> <h3 id="_1-2-스프링으로부터-해방된-하이버네이트-구성"><a href="#_1-2-스프링으로부터-해방된-하이버네이트-구성" class="header-anchor">#</a> 1-2. 스프링으로부터 해방된 하이버네이트 구성</h3> <ul><li>하이버네이트 상황 세션을 이용한다.</li> <li>하이버네이트 SessionFactory를 직접 저장소에 와이어링한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HibernateSpitterRepository</span> <span class="token keyword">implements</span> <span class="token class-name">SpitterRepository</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">SessionFactory</span> sessionFactory<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Inject</span>
    <span class="token keyword">public</span> <span class="token class-name">HibernateSpitterRepository</span><span class="token punctuation">(</span><span class="token class-name">SessionFactory</span> sessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sessionFactory <span class="token operator">=</span> sessionFactory<span class="token punctuation">;</span>	
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Session</span> <span class="token function">currentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Serializable</span> id <span class="token operator">=</span> <span class="token function">currentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>	

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Spitter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> id<span class="token punctuation">,</span>
                spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                spitter<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                spitter<span class="token punctuation">.</span><span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                spitter<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                spitter<span class="token punctuation">.</span><span class="token function">isUpdateByEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">)</span> <span class="token function">currentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">)</span> <span class="token function">currentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token function">currentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-스프링과-자바-퍼시스턴스-api"><a href="#_2-스프링과-자바-퍼시스턴스-api" class="header-anchor">#</a> 2. 스프링과 자바 퍼시스턴스 API</h2> <h3 id="_2-1-엔티티-관리자-팩토리-설정"><a href="#_2-1-엔티티-관리자-팩토리-설정" class="header-anchor">#</a> 2-1. 엔티티 관리자 팩토리 설정</h3> <ul><li>JPA로 만든 어플리케이션은 EntityManagerFactory의 구현 객체를 이용해 EntityManager의 인스턴스를 획득해야 한다.</li> <li>JPA 명세서의 2가지 엔티티 관리자</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">1.</span> 어플리케이션 관리형 <span class="token punctuation">(</span>application managed<span class="token punctuation">)</span>
어플리케이션이 엔티티 관리자 팩토리에서 직접 엔티티 관리자를 요청함으로써 엔티티 관리자가 생성되는 유형이다<span class="token punctuation">.</span>
해당 엔티티 관리자를 사용하면<span class="token punctuation">,</span> 어플맄이션이 엔티티 관리자를 열고 닫고를 해야하고<span class="token punctuation">,</span> 트랜잭션에 엔티티 관리자를
연관시키는 일까지 직접 해야됨<span class="token punctuation">.</span>
<span class="token operator">-&gt;</span> 자바 EE 컨테이너 없이 실행되는 독립형 어플리케이션에 적합

<span class="token number">2.</span> 컨테이너 관리형 <span class="token punctuation">(</span>container<span class="token operator">-</span>managed<span class="token punctuation">)</span>
자바 EE 컨테이너에 의해 생성되고 관리되는 엔티티 관리자<span class="token punctuation">.</span>
어플리케이션은 엔티티 관리자 팩토리와 직접 상호작용하지 않고<span class="token punctuation">,</span> 대신 엔티티 관리자를 종속객체주입<span class="token punctuation">(</span>DI<span class="token punctuation">)</span>나 
JNDI를 통해 직접적으로 획득하는 방식<span class="token punctuation">.</span> 
이 유형의 엔티티 관리자는 단순히 persistence<span class="token punctuation">.</span>xml로 지정한 것 이상의 자바 EE 컨테이너 서비스를 제공받을때 유리
</code></pre></div><ul><li>유형은 다르더라도 모든 엔티티 관리자는 동일한 EntityManager 인터페이스를 구축한다.</li> <li>차이는 EntityManager가 생성되고 관리되는 방식</li> <li>근데 스프링 쓰면 뭐 알아서 관리해줘서 별 큰 차이가 없다.
<ul><li>LocalEntityManagerFactoryBean : 어플리케이션 관리형 EntityManagerFactory 생성</li> <li>LocalContainerEntityManagerFactoryBean : 컨테이너 관리형 EntityManagerFactory 생성</li></ul></li></ul> <h4 id="어플리케이션-관리형-jpa-구성하기"><a href="#어플리케이션-관리형-jpa-구성하기" class="header-anchor">#</a> 어플리케이션 관리형 JPA 구성하기</h4> <ul><li>어플리케이션 관리형 엔티티 팩토리 설정은 대부분 META-INF 안의 persistence.xml 설정파일에서 가저온다.</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://java.sun.com/xml/ns/persistence<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>persistence-unit</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>spitterPU<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span><span class="token punctuation">&gt;</span></span>com.habuma.spittr.domain.Spitter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>class</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span><span class="token punctuation">&gt;</span></span>com.habuma.spittr.domain.Spittle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>class</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toplink.jdbc.driver<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.hsqldb.jdbcDriver<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toplink.jdbc.url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>
            <span class="token punctuation">&quot;</span>jdbc:hsqldb:hsql://localhost/spitter/spitter<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toplink.jdbc.user<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sa<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>toplink.jdbc.password<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence-unit</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>persistence</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>이런식으로 persistence unit을 설정해주고</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalEntityManagerFactoryBean</span> <span class="token function">entityManagerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">LocalEntityManagerFactoryBean</span> emfb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalEntityManagerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    emfb<span class="token punctuation">.</span><span class="token function">setPersistenceUnitName</span><span class="token punctuation">(</span><span class="token string">&quot;spitterPU&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> emfb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 빈으로 등록해준다.</li> <li>하지만 이런건 스프링에서 쓰기가 어렵다.</li></ul> <h4 id="컨테이너-관리형-jpa-구성하기"><a href="#컨테이너-관리형-jpa-구성하기" class="header-anchor">#</a> 컨테이너 관리형 JPA 구성하기</h4> <ul><li>데이터소스 세부 정보를 persistence.xml에 설정하는 대신, 자바 빈으로 설정해준다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> <span class="token function">entityManagerFactory</span><span class="token punctuation">(</span>
    <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">,</span> <span class="token class-name">JpaVendorAdapter</span> jpaVendorAdapter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> emfb <span class="token operator">=</span> 
            <span class="token keyword">new</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        emfb<span class="token punctuation">.</span><span class="token function">setJpaVendorAdapter</span><span class="token punctuation">(</span>jpaVendorAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>      
        <span class="token keyword">return</span> emfb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>스프링에서 설정한 dataSource를 사용하고, jpaVenderAdapter로 특정 JPA 구현체에 대해 특화된 정보를 제공한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">JpaVendorAdapter</span> <span class="token function">jpaVendorAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HibernateJpaVendorAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HibernateJpaVendorAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;HSQL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">setShowSql</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">setGenerateDdl</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">setDatabasePlatform</span><span class="token punctuation">(</span><span class="token string">&quot;org.hibernate.dialect.HSQLDialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>어댑터 설정에 제일 중요한 것은 database 프로퍼티로 사용할 데이터베이스를 정하는 것이다.</li></ul> <p><img src="/study-collection/assets/img/jpa1.d6a83145.png" alt="어댑터디비명"></p> <ul><li>LocalContainerEntityManagerFactoryBean으로 트릭키하게 사용도 가능하다.</li> <li>persistence.xml의 주목적은 퍼시스턴스 유닛에서 엔티티 클래스를 구별하는것이다.</li> <li>하지만 pacakageToScan 프로퍼티를 사용해 LocalContainerEntityManagerFactoryBean을 직접 사용하면 편하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> <span class="token function">entityManagerFactory</span><span class="token punctuation">(</span>
        <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">,</span> <span class="token class-name">JpaVendorAdapter</span> jpaVendorAdapter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> emfb <span class="token operator">=</span>
      <span class="token keyword">new</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  emfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  emfb<span class="token punctuation">.</span><span class="token function">setJpaVendorAdapter</span><span class="token punctuation">(</span>jpaVendorAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  emfb<span class="token punctuation">.</span><span class="token function">setPackagesToScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.habuma.spittr.domain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> emfb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 ~.domian 패키지안의 @Entity를 스캔한다.</li> <li>따라서 그지같은 xml은 필요없다.</li> <li><em>LocalContainerEntityManagerFactoryBean</em>을 적극 활용하자</li></ul> <h4 id="jndi에서-entitymanagerfactory-가져오기"><a href="#jndi에서-entitymanagerfactory-가져오기" class="header-anchor">#</a> JNDI에서 EntityManagerFactory 가져오기</h4> <ul><li>서버에 JNDI 설정을 해주다.</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jee:</span>jndi-lookup</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>emf<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jndi-name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>persistence/spitterPU<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>자바 빈설정</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">JndiObjectFactoryBean</span> <span class="token function">entityManagerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JndiObjectFactoryBean</span> jndiObjectFB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JndiObjectFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFB<span class="token punctuation">.</span><span class="token function">setJndiName</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc/SpittrDS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> jndiObjectFB<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-jpa-기반-저장소-작성"><a href="#_2-2-jpa-기반-저장소-작성" class="header-anchor">#</a> 2-2. JPA 기반 저장소 작성</h3> <ul><li>스프링의 JpaTemplate에 의존하지 않는 JPA 저장소 개발하는 방법 기반</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpaSpitterRepository</span> <span class="token keyword">implements</span> <span class="token class-name">SpitterRepository</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PersistenceUnit</span>
    <span class="token keyword">private</span> <span class="token class-name">EntityManagerFactory</span> emf<span class="token punctuation">;</span>	<span class="token comment">// EntityManagerFactory 주입</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      emf<span class="token punctuation">.</span><span class="token function">createEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// EntityManager 생성 및 사용</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">getSpitterById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> emf<span class="token punctuation">.</span><span class="token function">createEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      emf<span class="token punctuation">.</span><span class="token function">createEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>EntityManagerFactory 를 사용해서 데이터베이스 대상 동작을 수행하도록 소스 구성</li> <li>EntityManager가 스레드 세이프하지 않아 계속 생성되어 문제가 복잡해 질 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpaSpitterRepository</span> <span class="token keyword">implements</span> <span class="token class-name">SpitterRepository</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@PersistenceContext</span>
  <span class="token keyword">private</span> <span class="token class-name">EntityManager</span> em<span class="token punctuation">;</span>	<span class="token comment">// EntityManager 주입</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    em<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// EntityManager 사용</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">getSpitterById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    em<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>새로운 소스는 EntityManager를 직접 주입되어 사용되어지다. EntityManagerFactory에서 계속 생산할 필요 X</li> <li>하지만 여전히 쓰레드 세이프 하지않는다.</li> <li>그래서 쓰는게 @PersistenceContext</li> <li>@PersistenceContext는 EntityManager를 주입하지 않고, 저장소에 EntityManager를 주고, 실제로는 EntityManager에 대한 프록시를 제공하는 형태이다. -&gt; 스레드 세이프하다.</li> <li>@PersistenceUtil &amp; @PersistenceContext는 스프링께 아니다.</li> <li>스프링이 EntityManagerFactory || EntityManager를 주입하려면, PersistenceAnnotationBeanPostProcessor를 구성해야한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PersistenceAnnotationBeanPostProcessor</span> <span class="token function">paPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PersistenceAnnotationBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-스프링-데이터를-사용한-자동-jpa-저장소"><a href="#_3-스프링-데이터를-사용한-자동-jpa-저장소" class="header-anchor">#</a> 3. 스프링 데이터를 사용한 자동 JPA 저장소</h2> <ul><li>위의 소스들은 메소드가 매우 간단해 보이지만, 데이터베이스에 쿼리를 하기 위해서 EntityManager와 직접 상호연동을 한다.</li> <li>근데 보면 좀 쓸모없는 부분 탐색도 하고 그런다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    entityManger<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>spitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpitterRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>스프링 데이터 JPA 저장소 작성 키는 인터페이스 중 하나의 확장이다.</li> <li>여기서 SpitterRepository는 스프링 데이터 JPA의 JpaRepository를 확장한다.</li> <li>이제 스프링 데이터 JPA를 설정해 본다.</li> <li>@EnableJpaRepositories를 사용해 설정이 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 스프링 데이터 JPA 설정</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token string">&quot;com.habuma.spittr.db&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpaConfiguration</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>저장소는 스프링 어플리케이션 컨텍스트가 생성되는 것처럼, 어플리케이션 시작 시간에 저장소가 구현이 된다.</li> <li>JpaRepository 를 확장해서 구현했기 때문에, 자동으로 SpitterRepository 구현을 진행한다.</li> <li>스프링 데이터 JPA는 퍼시스턴스 코드를 따로 작성할 필요 없이 Spitter객체의 일반 JPA 동작을 위한 18개의 메소드를 제공한다.</li> <li>즉 자동설정이 가능하다는 소리.</li></ul> <h3 id="_3-1-쿼리-메소드-정의하기"><a href="#_3-1-쿼리-메소드-정의하기" class="header-anchor">#</a> 3-1. 쿼리 메소드 정의하기</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpitterRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Spitter</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>SpitterRepository에서 findByUsername()을 추가하기 위해 구현할 것은 없다.</li> <li>메소드 시그니처는 메소드 구현체를 만들기 위해 알아야 할 모든 것을 스프링 데이터 JPA에 알려준다.</li> <li>저장소를 만들때, 스프링데이터는 메소드들을 검증하고 파싱하고 하면서 메소드가 무슨 역할을 하는지 이해하고 알아서 만든다..(?)</li> <li>JpaRepository가 Spitter로 파라미터화 되므로 스프링 데이터는 이 메소드의 용도가 Spitter를 찾는걸 알아낸다.(..!)</li> <li>신기</li></ul> <hr> <ul><li>저장소 메소드는
<ul><li>동사</li> <li>선택대상</li> <li>단어 By 및 조건</li></ul></li> <li>으로 구성된다.</li> <li>findByUsername()은 찾는 동작을 나타내고, 조건은 사용자명을 나타내고, 대상은 지정안되도 Spitter임을 안다.</li></ul> <p><img src="/study-collection/assets/img/jpa2.76b9928f.png" alt="jpa2"></p> <ul><li>결국 JPA 레파지토리내 메소드는 동사 + 선택대상 + 단어 및 조건으로 알아서 메소드를 생성해준다.</li> <li>OrderBy 같은거 넣어서 순서 정렬도 된다</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">&gt;</span></span> <span class="token function">readByFirstnameOrLastnameOrderByLastnameAsc</span><span class="token punctuation">(</span><span class="token class-name">String</span> first<span class="token punctuation">,</span> <span class="token class-name">String</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>조건은 And Or 로 분리된다.</li></ul> <h3 id="_3-2-맞춤형-쿼리-선언하기"><a href="#_3-2-맞춤형-쿼리-선언하기" class="header-anchor">#</a> 3-2 맞춤형 쿼리 선언하기</h3> <ul><li>물론 가끔은 메소드 선언으로 쿼리를 나타내는데 한계가 있을 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllGmailSpitters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>위의 메소드 명은 스프링 데이터의 메소드 명명 규칙을 준수하지 않는다.</li> <li>스프링 데이터가 이 메소드를 위한 구현체를 만들고자 할 때, 메소드 명의 내용과 Spitter 메타 모델이 매칭이 되지 않으면서 예외가 발생한다.</li> <li>이런상황에선 @Query 메소드를 쓴다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select s from Spitter s where s.email like '%gmail.com'&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllGmailSpitters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>아직은 메소드 구현을 만들 순 없다, 단지 스프링 데이터 JPA에 메소드 구현에 대한 힌트를 주기 위해 쿼리를 수행했을 뿐</li> <li>아주 긴 이름에도 쓰기 좋다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span>
  <span class="token function">findByCustomerAddressZipCodeOrCustomerNameAndCustomerAddressState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>이런건 이름이 너무 길어 이해하기 어려우니 @Query 어노테이션을 사용해 보자</li></ul> <h3 id="_3-3-맞춤형-기능-혼합"><a href="#_3-3-맞춤형-기능-혼합" class="header-anchor">#</a> 3-3. 맞춤형 기능 혼합</h3> <ul><li>@Query도 안먹히는게 있다.</li> <li>옛날 방식, 즉 EntityManager를 직접 사용할 필요가 있을수도 있다.</li> <li>이렇게되면 JPA를 버려야 하는가 싶지만, 그럴 필요없이 설정이 가능하다.</li></ul> <hr> <ol><li><p>스프링 데이터 JPA는 저장소 인터페이스 구현체를 생성하고, Impl 접미어를 가지는 인터페이스의 이름과 같은 클래스를 찾는다.</p></li> <li><p>클래스가 존재하는 경우, 스프링 데이터 JPA는 스프링 데이터 JPA에 의해 생성된 방법과 병합된다.</p></li> <li><p>SpitterRepository 인터페이스의 경우, 그것을 찾는 클래슨느 SpitterRepositoryImpl이라는 이름으로 지정된다.</p></li> <li><p>1000회 이상의 spittle을 게시한 모든 Spitter를 업데이트하는 SpitterRepository 메소드가 필요하다고 가정하고, Spitter는 엘리트 상태로 설정한다.</p></li> <li><p>기존처럼 JPA의 메소드 명명법을 따르거나, @Query로 명명해도 되지만, eliteSweep() 메소드를 사용하는 방법이 있다.</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpitterRepositoryImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SpitterSweeper</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@PersistenceContext</span>
  <span class="token keyword">private</span> <span class="token class-name">EntityManager</span> em<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">eliteSweep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> update <span class="token operator">=</span>
        <span class="token string">&quot;UPDATE Spitter spitter &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;SET spitter.status = 'Elite' &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;WHERE spitter.status = 'Newbie' &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;AND spitter.id IN (&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;SELECT s FROM Spitter s WHERE (&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;  SELECT COUNT(spittles) FROM s.spittles spittles) &gt; 10000&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;)&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>특별하진 않다. 주입된 EntityManager를 사용한다.</li> <li>SpitterRepositoryImpl은 SpitterRepository를 구현하지 않는다, 스프링 데이터 JPA가 책임을 짐</li> <li>대신 SpitterSweeper를 구현하며, 다음과 같이 나타낼 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpitterSweeper</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">eliteSweep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpitterRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">SpitterSweeper</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>언급한 대로, 구현체 명이 인터페이스 명에 기반을 두므로 스프링 데이터 JPA는 인터페이스와 구현 클래스를 연관시킨다.</li> <li>Impl 접미어는 기본적으로 사용된다.</li> <li>만약 다른거 원하면 repositoryImplementationPostfix 어트리뷰트를 설정하여 @EnableJpaRepositories에 넣는다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>
  basePackages<span class="token operator">=</span><span class="token string">&quot;com.habuma.spittr.db&quot;</span><span class="token punctuation">,</span>
  repositoryImplementationPostfix<span class="token operator">=</span><span class="token string">&quot;Helper&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>이렇게 하면 스프링 데이터 JPA는 SpitterRepository 인터페이스를 매칭하기 위해 SpitterRepositoryHelper 클래스를 찾게 된다.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/spring-in-action/010.html" class="prev">10장 스프링과 JDBC를 사용하여 데이터베이스 사용하기</a></span> <span class="next"><a href="/study-collection/book/spring-in-action/012.html">12장 NoSQL 데이터베이스 사용하기</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.65d03ea7.js" defer></script><script src="/study-collection/assets/js/2.f504b8bc.js" defer></script><script src="/study-collection/assets/js/46.5c443226.js" defer></script>
  </body>
</html>
