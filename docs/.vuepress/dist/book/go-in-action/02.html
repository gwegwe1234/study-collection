<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.48760978.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.e4aeeab3.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.5c09ce41.js" as="script"><link rel="preload" href="/study-collection/assets/js/58.93d46332.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.785350b6.js"><link rel="prefetch" href="/study-collection/assets/js/100.d8ad668c.js"><link rel="prefetch" href="/study-collection/assets/js/101.46a39ceb.js"><link rel="prefetch" href="/study-collection/assets/js/102.4418bfbd.js"><link rel="prefetch" href="/study-collection/assets/js/103.df34ab2e.js"><link rel="prefetch" href="/study-collection/assets/js/104.6e1de863.js"><link rel="prefetch" href="/study-collection/assets/js/105.66159205.js"><link rel="prefetch" href="/study-collection/assets/js/106.c920bb75.js"><link rel="prefetch" href="/study-collection/assets/js/107.ca98de8f.js"><link rel="prefetch" href="/study-collection/assets/js/108.a511b16c.js"><link rel="prefetch" href="/study-collection/assets/js/109.8b9f6635.js"><link rel="prefetch" href="/study-collection/assets/js/11.a7ed2b4d.js"><link rel="prefetch" href="/study-collection/assets/js/110.e2a916ed.js"><link rel="prefetch" href="/study-collection/assets/js/111.c0bf71c1.js"><link rel="prefetch" href="/study-collection/assets/js/112.9280e359.js"><link rel="prefetch" href="/study-collection/assets/js/113.0eff234c.js"><link rel="prefetch" href="/study-collection/assets/js/114.dd7e0f44.js"><link rel="prefetch" href="/study-collection/assets/js/115.0764541c.js"><link rel="prefetch" href="/study-collection/assets/js/116.ef50daa6.js"><link rel="prefetch" href="/study-collection/assets/js/117.e6a5b20b.js"><link rel="prefetch" href="/study-collection/assets/js/118.f13a2eb8.js"><link rel="prefetch" href="/study-collection/assets/js/119.921b1fdb.js"><link rel="prefetch" href="/study-collection/assets/js/12.3b115c22.js"><link rel="prefetch" href="/study-collection/assets/js/120.0a709fc1.js"><link rel="prefetch" href="/study-collection/assets/js/121.5bb1da57.js"><link rel="prefetch" href="/study-collection/assets/js/122.d5e5f108.js"><link rel="prefetch" href="/study-collection/assets/js/123.c539a2ae.js"><link rel="prefetch" href="/study-collection/assets/js/124.cbe1c283.js"><link rel="prefetch" href="/study-collection/assets/js/125.3e41127f.js"><link rel="prefetch" href="/study-collection/assets/js/126.a002bc73.js"><link rel="prefetch" href="/study-collection/assets/js/127.5ad48dea.js"><link rel="prefetch" href="/study-collection/assets/js/128.2e79e84d.js"><link rel="prefetch" href="/study-collection/assets/js/129.dbb8ffec.js"><link rel="prefetch" href="/study-collection/assets/js/13.c31eb47d.js"><link rel="prefetch" href="/study-collection/assets/js/130.0e72e722.js"><link rel="prefetch" href="/study-collection/assets/js/131.31ae0dec.js"><link rel="prefetch" href="/study-collection/assets/js/14.0b0f1a16.js"><link rel="prefetch" href="/study-collection/assets/js/15.f095dbb0.js"><link rel="prefetch" href="/study-collection/assets/js/16.59706b58.js"><link rel="prefetch" href="/study-collection/assets/js/17.600e56d4.js"><link rel="prefetch" href="/study-collection/assets/js/18.dcff83cc.js"><link rel="prefetch" href="/study-collection/assets/js/19.eb5dfd33.js"><link rel="prefetch" href="/study-collection/assets/js/20.c1caa5e6.js"><link rel="prefetch" href="/study-collection/assets/js/21.3eec743e.js"><link rel="prefetch" href="/study-collection/assets/js/22.d6a1f673.js"><link rel="prefetch" href="/study-collection/assets/js/23.a17f39a2.js"><link rel="prefetch" href="/study-collection/assets/js/24.657a5848.js"><link rel="prefetch" href="/study-collection/assets/js/25.1bebb78b.js"><link rel="prefetch" href="/study-collection/assets/js/26.af7a4e9c.js"><link rel="prefetch" href="/study-collection/assets/js/27.f7b0318d.js"><link rel="prefetch" href="/study-collection/assets/js/28.16c3811e.js"><link rel="prefetch" href="/study-collection/assets/js/29.55ac33d3.js"><link rel="prefetch" href="/study-collection/assets/js/3.11771ed7.js"><link rel="prefetch" href="/study-collection/assets/js/30.06cb797c.js"><link rel="prefetch" href="/study-collection/assets/js/31.863e062e.js"><link rel="prefetch" href="/study-collection/assets/js/32.167281d5.js"><link rel="prefetch" href="/study-collection/assets/js/33.e9535cd1.js"><link rel="prefetch" href="/study-collection/assets/js/34.b1044e0c.js"><link rel="prefetch" href="/study-collection/assets/js/35.d955af7f.js"><link rel="prefetch" href="/study-collection/assets/js/36.66174ccd.js"><link rel="prefetch" href="/study-collection/assets/js/37.cc3f831b.js"><link rel="prefetch" href="/study-collection/assets/js/38.710d0bc0.js"><link rel="prefetch" href="/study-collection/assets/js/39.6c10aca7.js"><link rel="prefetch" href="/study-collection/assets/js/4.8e03be29.js"><link rel="prefetch" href="/study-collection/assets/js/40.0de62739.js"><link rel="prefetch" href="/study-collection/assets/js/41.ad388a11.js"><link rel="prefetch" href="/study-collection/assets/js/42.ee6dfc4b.js"><link rel="prefetch" href="/study-collection/assets/js/43.08b577d3.js"><link rel="prefetch" href="/study-collection/assets/js/44.2fb421c9.js"><link rel="prefetch" href="/study-collection/assets/js/45.0aa0c6ac.js"><link rel="prefetch" href="/study-collection/assets/js/46.49264dd7.js"><link rel="prefetch" href="/study-collection/assets/js/47.0e652633.js"><link rel="prefetch" href="/study-collection/assets/js/48.478b5206.js"><link rel="prefetch" href="/study-collection/assets/js/49.92d00356.js"><link rel="prefetch" href="/study-collection/assets/js/5.67a0ead5.js"><link rel="prefetch" href="/study-collection/assets/js/50.93d71b52.js"><link rel="prefetch" href="/study-collection/assets/js/51.a7461927.js"><link rel="prefetch" href="/study-collection/assets/js/52.6f7eec88.js"><link rel="prefetch" href="/study-collection/assets/js/53.5b5094b0.js"><link rel="prefetch" href="/study-collection/assets/js/54.f119d0e9.js"><link rel="prefetch" href="/study-collection/assets/js/55.30872002.js"><link rel="prefetch" href="/study-collection/assets/js/56.5ae2f011.js"><link rel="prefetch" href="/study-collection/assets/js/57.0caef5ab.js"><link rel="prefetch" href="/study-collection/assets/js/59.aa6cb962.js"><link rel="prefetch" href="/study-collection/assets/js/6.e7a763cd.js"><link rel="prefetch" href="/study-collection/assets/js/60.79b5bb2e.js"><link rel="prefetch" href="/study-collection/assets/js/61.1371182c.js"><link rel="prefetch" href="/study-collection/assets/js/62.70870644.js"><link rel="prefetch" href="/study-collection/assets/js/63.889ccefa.js"><link rel="prefetch" href="/study-collection/assets/js/64.2c9d617d.js"><link rel="prefetch" href="/study-collection/assets/js/65.92b3e044.js"><link rel="prefetch" href="/study-collection/assets/js/66.04af76e6.js"><link rel="prefetch" href="/study-collection/assets/js/67.042bffd3.js"><link rel="prefetch" href="/study-collection/assets/js/68.d50cc632.js"><link rel="prefetch" href="/study-collection/assets/js/69.8ab0e2d0.js"><link rel="prefetch" href="/study-collection/assets/js/7.2b3f702e.js"><link rel="prefetch" href="/study-collection/assets/js/70.71711e2e.js"><link rel="prefetch" href="/study-collection/assets/js/71.7e5d4ce9.js"><link rel="prefetch" href="/study-collection/assets/js/72.b010ef47.js"><link rel="prefetch" href="/study-collection/assets/js/73.2e934c5e.js"><link rel="prefetch" href="/study-collection/assets/js/74.6591fdaf.js"><link rel="prefetch" href="/study-collection/assets/js/75.fc92beea.js"><link rel="prefetch" href="/study-collection/assets/js/76.c9327d9d.js"><link rel="prefetch" href="/study-collection/assets/js/77.4a659db7.js"><link rel="prefetch" href="/study-collection/assets/js/78.132c20ed.js"><link rel="prefetch" href="/study-collection/assets/js/79.10cc882c.js"><link rel="prefetch" href="/study-collection/assets/js/8.2135754d.js"><link rel="prefetch" href="/study-collection/assets/js/80.76697f85.js"><link rel="prefetch" href="/study-collection/assets/js/81.20b51b6a.js"><link rel="prefetch" href="/study-collection/assets/js/82.414e04f0.js"><link rel="prefetch" href="/study-collection/assets/js/83.377f0b10.js"><link rel="prefetch" href="/study-collection/assets/js/84.5d9a84a4.js"><link rel="prefetch" href="/study-collection/assets/js/85.a86e1447.js"><link rel="prefetch" href="/study-collection/assets/js/86.457a9323.js"><link rel="prefetch" href="/study-collection/assets/js/87.afb26f28.js"><link rel="prefetch" href="/study-collection/assets/js/88.fbd72dd1.js"><link rel="prefetch" href="/study-collection/assets/js/89.122e5169.js"><link rel="prefetch" href="/study-collection/assets/js/9.2b26a5cb.js"><link rel="prefetch" href="/study-collection/assets/js/90.93e401b3.js"><link rel="prefetch" href="/study-collection/assets/js/91.eb1cb57c.js"><link rel="prefetch" href="/study-collection/assets/js/92.a249c659.js"><link rel="prefetch" href="/study-collection/assets/js/93.7e507c14.js"><link rel="prefetch" href="/study-collection/assets/js/94.21a950f6.js"><link rel="prefetch" href="/study-collection/assets/js/95.fd508562.js"><link rel="prefetch" href="/study-collection/assets/js/96.dedd5e3f.js"><link rel="prefetch" href="/study-collection/assets/js/97.9ce7ba9b.js"><link rel="prefetch" href="/study-collection/assets/js/98.bbfe69b5.js"><link rel="prefetch" href="/study-collection/assets/js/99.1af1908f.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.48760978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>고 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/go-in-action/01.html" class="sidebar-link">1장 Go와의 첫 만남</a></li><li><a href="/study-collection/book/go-in-action/02.html" class="active sidebar-link">2장 Go 간단히 살펴보기</a></li><li><a href="/study-collection/book/go-in-action/03.html" class="sidebar-link">3장 패키징과 내장 도구들</a></li><li><a href="/study-collection/book/go-in-action/04.html" class="sidebar-link">4장 배열, 슬라이스, 맵</a></li><li><a href="/study-collection/book/go-in-action/05.html" class="sidebar-link">5장 Go의 타입 시스템</a></li><li><a href="/study-collection/book/go-in-action/06.html" class="sidebar-link">6장 동시성</a></li><li><a href="/study-collection/book/go-in-action/07.html" class="sidebar-link">7장 동시성 패턴</a></li><li><a href="/study-collection/book/go-in-action/08.html" class="sidebar-link">8장 표준 라이브러리</a></li><li><a href="/study-collection/book/go-in-action/09.html" class="sidebar-link">9장 테스트와 벤치마킹</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Go 언어를 활용한 마이크로서비스 개발</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>카프카 스트림즈 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>모던 자바 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>객체지향의 사실과 오해</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2강"><a href="#_2강" class="header-anchor">#</a> 2강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-프로그램-아키텍쳐">1. 프로그램 아키텍쳐</a></li><li><a href="#_2-main-패키지">2. main 패키지</a></li><li><a href="#_3-search-패키지">3. Search 패키지</a><ul><li><a href="#_3-1-search-go">3-1. search.go</a></li><li><a href="#_3-2-feed-go">3-2. feed.go</a></li><li><a href="#_3-3-match-go-default-go">3-3. match.go/default.go</a></li></ul></li><li><a href="#_4-rss-검색기">4. RSS 검색기</a></li><li><a href="#_5-요약">5. 요약</a></li></ul></div><p></p> <h2 id="_1-프로그램-아키텍쳐"><a href="#_1-프로그램-아키텍쳐" class="header-anchor">#</a> 1. 프로그램 아키텍쳐</h2> <p><img src="/study-collection/assets/img/goinaction2-1.aab4d52a.png" alt="archi"></p> <ul><li>서로 다른 피드를 대상으로 검색을 수행하는 방법</li> <li>프로그램은 각기 다른 고루틴에 의해 실행되는 여러 단계로 나누어진다.</li> <li>주 고루틴에서 시작해 검색과 추적을 담당하는 고루틴의 코드를 살펴본 후 다시 주 고루틴의 코드로 돌아오는 순서로 실행</li></ul> <div class="language- extra-class"><pre class="language-text"><code>cd $GOPATH/src/github.com/goinaction/code/chapter2

- sample
    - data
        data.json -- 데이터 피드를 가지고 있는 파일
    - matchers
        rss.go -- RSS 피드 검색기를 구현
    - search
        default.go -- 데이터 검색을 위한 기본적인 검색기 코드
        feed.go -- JSON 데이터 파일을 읽기 위한 코드
        match.go -- 서로 다른 종류의 검색기를 지원하기 위한 인터페이스
        search.go -- 검색을 수행하는 주요 로직이 구현된 파일
    main.go -- 시작점
</code></pre></div><h2 id="_2-main-패키지"><a href="#_2-main-패키지" class="header-anchor">#</a> 2. main 패키지</h2> <ul><li>프로그램의 진입점 (main)</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter2/sample/matchers&quot;</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter2/sample/search&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 표준 출력으로 로그를 출력하도록 변경한다</span>
	log<span class="token punctuation">.</span><span class="token function">SetOutput</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 지정된 검색어로 검색을 수행</span>
	search<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;Sherlock Holmes&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>mian 함수가 들어간 go 파일의 package는 main으로 선언해 준다</li> <li>go의 모든 파일은 패키지에 종속</li> <li>import는 특정 패키지를 가져오는것</li> <li>같은 폴더에 저장된 모든 소스 파일은 같은 패키지 이름을 사용해야 하며, 폴더 이름과 동일한 패키지 이름을 사용하는 것이 좋다</li> <li>_를 사용해 빈 식별자를 사용할 수도 있다</li> <li>init 함수는 main보다 먼저 실행된다</li> <li>init 후 메인 실행. search 패키지에 있는 Run 함수를 실행한다</li></ul> <h2 id="_3-search-패키지"><a href="#_3-search-패키지" class="header-anchor">#</a> 3. Search 패키지</h2> <ul><li>search 패키지는 프로그램을 위한 프레임워크와 비지니스 로직을 구현한 패키지</li> <li>4개의 go 파일로 구성된다.</li></ul> <h3 id="_3-1-search-go"><a href="#_3-1-search-go" class="header-anchor">#</a> 3-1. search.go</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> search

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> matchers <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Matcher<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span>searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 검색할 피드의 목록 조회</span>
	feeds<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">RetrieveFeeds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 버퍼가 없는 채널을 생성하여 화면에 표시할 검색 결과를 전달 받는다</span>
	results <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token operator">*</span>Result<span class="token punctuation">)</span>

	<span class="token comment">// 모든 피드를 처리할 때까지 기다릴 대기 그룹(Wait group)을 설정</span>
	<span class="token keyword">var</span> waitGroup sync<span class="token punctuation">.</span>WaitGroup

	<span class="token comment">// 개별 피드를 처리하는 동안 대기해야 함</span>
	<span class="token comment">// 고루틴의 개수를 설정</span>
	waitGroup<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>feeds<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// 각기 다른 종류의 피드를 처리할 고루틴을 실행</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> feed <span class="token operator">:=</span>  <span class="token keyword">range</span> feeds <span class="token punctuation">{</span>
		<span class="token comment">// 검색을 위해 검색기 조회</span>
		matcher<span class="token punctuation">,</span> exists <span class="token operator">:=</span> matchers<span class="token punctuation">[</span>feed<span class="token punctuation">.</span>Type<span class="token punctuation">]</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>exists <span class="token punctuation">{</span>
			matcher <span class="token operator">=</span> matchers<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 검색을 실행하기 위해 고루틴을 실행</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>matcher Matcher<span class="token punctuation">,</span> feed <span class="token operator">*</span>Feed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">Match</span><span class="token punctuation">(</span>matcher<span class="token punctuation">,</span> feed<span class="token punctuation">,</span> searchTerm<span class="token punctuation">,</span> results<span class="token punctuation">)</span>
			waitGroup<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>matcher<span class="token punctuation">,</span> feed<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 모든 작업이 완료되었는지를 모니터링할 고루틴을 실행</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 모든 자업이 처리될 때까지 기다린다</span>
		waitGroup<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// Display 함수에게 프로그램을 종류할 수 있음을 알리기 위해 채널을 닫는다.</span>
		<span class="token function">close</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 검색 결과 화면 표시</span>
	<span class="token function">Display</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code>feeds<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">RetrieveFeeds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>RetrieveFeeds는 같은 패키지 내에 선언되어 있는 함수이다.</li> <li>동적 배열을 구현한 Slice를 리턴한다</li> <li>feeds, err 처럼 리턴값이 2개도 가능</li> <li>:= 는 변수의 선언과 초기화를 동시에 가능하게 해주는 연산자</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 버퍼가 없는 채널을 생성하여 화면에 표시할 검색 결과를 전달 받는다</span>
	results <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token operator">*</span>Result<span class="token punctuation">)</span>
</code></pre></div><ul><li>chan은 채널변수 -&gt; 고루틴간의 데이터 전달</li></ul> <div class="language-go extra-class"><pre class="language-go"><code>	<span class="token comment">// 모든 피드를 처리할 때까지 기다릴 대기 그룹(Wait group)을 설정</span>
	<span class="token keyword">var</span> waitGroup sync<span class="token punctuation">.</span>WaitGroup

	<span class="token comment">// 개별 피드를 처리하는 동안 대기해야 함</span>
	<span class="token comment">// 고루틴의 개수를 설정</span>
	waitGroup<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>feeds<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>WaitGroup을 사용하는 이유는 Go는 메인이 끝나버리면 고루틴도 다 끝나버려서 메인이 리턴되기 전에 모든 고루틴을 실행하기 위해 쓴다</li> <li>WaitGroup은 카운팅 세마포어여서 고루틴의 실행이 종료될 때마다 전체 개수를 하나씩 줄임</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 각기 다른 종류의 피드를 처리할 고루틴을 실행</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> feed <span class="token operator">:=</span>  <span class="token keyword">range</span> feeds <span class="token punctuation">{</span>
		<span class="token comment">// 검색을 위해 검색기 조회</span>
		matcher<span class="token punctuation">,</span> exists <span class="token operator">:=</span> matchers<span class="token punctuation">[</span>feed<span class="token punctuation">.</span>Type<span class="token punctuation">]</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>exists <span class="token punctuation">{</span>
			matcher <span class="token operator">=</span> matchers<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 검색을 실행하기 위해 고루틴을 실행</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>matcher Matcher<span class="token punctuation">,</span> feed <span class="token operator">*</span>Feed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">Match</span><span class="token punctuation">(</span>matcher<span class="token punctuation">,</span> feed<span class="token punctuation">,</span> searchTerm<span class="token punctuation">,</span> results<span class="token punctuation">)</span>
			waitGroup<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>matcher<span class="token punctuation">,</span> feed<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><ul><li>조회한 모든 피드에 대해서 for 루프를 실행하는 부분</li> <li>range 키워드를 사용하면 for 문을 쉽게 돌릴 수 있음</li> <li>_는 빈 식별자로 실제로 필요하지 않은 인덱스값을 적기 위해 사용</li> <li>map도 쓰는데, exists 로 bool값을 받아 값의 유무를 알 수 있다.</li> <li>waitGroup.Done()은 고루틴이 완료될때마다 값을 하나씩 감소되어, 다 끝나는걸 보장해준다.</li> <li>waitGroup은 실제로 go 루틴 익명함수 내부에서 선언된 적이 없는데, 가져다 쓰고있다. -&gt; 클로저 지원</li> <li>익명함수에서 matcher, feed 변수는 매개변수로 넘겨주는데, 이렇게 안하고 클로저로 쓰면 값이 변경돼 문제가 발생 할 수 있다</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 모든 작업이 완료되었는지를 모니터링할 고루틴을 실행</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 모든 자업이 처리될 때까지 기다린다</span>
		waitGroup<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// Display 함수에게 프로그램을 종료할 수 있음을 알리기 위해 채널을 닫는다.</span>
		<span class="token function">close</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>위와 같이 모든 고루틴이 완료 될때까지 메인함수가 종료되지 말라고 Wait함수를 걸어준다</li></ul> <h3 id="_3-2-feed-go"><a href="#_3-2-feed-go" class="header-anchor">#</a> 3-2. feed.go</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> search

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;encoding/json&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> dataFile <span class="token operator">=</span> <span class="token string">&quot;data/data.json&quot;</span>

<span class="token keyword">type</span> Feed <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span> <span class="token string">`json:&quot;site&quot;`</span>
	URI <span class="token builtin">string</span> <span class="token string">`json:&quot;link&quot;`</span>
	Type <span class="token builtin">string</span> <span class="token string">`json:&quot;type&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">RetrieveFeeds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Feed<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 파일을 연다</span>
	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dataFile<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token comment">// defer 함수를 이용해 이 함수가 리턴딜 때 앞서 열어둔 파일이 꼭 닫히도록 해준다</span>
	<span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 파일을 읽어 Feed 구조체의 포인터의 슬라이스로 변환</span>
	<span class="token keyword">var</span> feeds <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Feed
	<span class="token comment">//feeds2 := new([]*Feed)</span>
	err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>feeds<span class="token punctuation">)</span>

	<span class="token keyword">return</span> feeds<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre></div><ul><li>encoding/json 의 json 표준 라이브러리를 사용한다. -&gt; 인코딩, 디코딩 가능</li> <li>가져올 json을 쓰기 위해선, 디코딩을 통해 구조체의 슬라이스로 변환해야 한다.</li> <li>파일을 디코딩할 구조체로 Feed 구조체를 생성해준다.</li> <li>RetrieveFeeds 함수는 데이터의 파일을 읽어 각각의 JSON 문서를 디코딩해 Feed 구조체 타입값의 슬라이스를 리턴해 준다.</li> <li>리턴값이 두개인경우, 즉 원하는값, error 형태로 많이 던져준다.</li> <li>defer는 어떠한 로직에서 panic이 발생했을 때, 무조건 실행되는 문구이다. 여기선 file.Close()</li> <li>Feed의 슬라이스 변수를 선언해 Decode에다가 넣어준다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>dec <span class="token operator">*</span>Decoder<span class="token punctuation">)</span> <span class="token function">Decode</span><span class="token punctuation">(</span>v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> dec<span class="token punctuation">.</span>err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> dec<span class="token punctuation">.</span>err
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
</code></pre></div><ul><li>Decode는 인터페이스형을 받는 구조라, 아무거나 넣어도 된다. 위의 형태는 리시버 형태</li></ul> <h3 id="_3-3-match-go-default-go"><a href="#_3-3-match-go-default-go" class="header-anchor">#</a> 3-3. match.go/default.go</h3> <ul><li>match.go 파일에는 search 패키지의 Run 함수가 사용할 여러 종류의 검색기를 생성하기 위한 코드가 작성되어있다</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> search

<span class="token comment">// 검색 결과를 저장할 Result 구조체</span>
<span class="token keyword">type</span> Result <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Field <span class="token builtin">string</span>
	Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// Matcher 인터페이스는 새로운 검색 타입을 구현할 때 필요한 동작을 정의</span>
<span class="token keyword">type</span> Matcher <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Search</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>인터페이스의 동작은 인터페이스 타입 내부에 선언된 메소드에 의해 정의된다. -&gt; 덕타이핑</li> <li>Go의 이름 규칙으로, 메소드가 하나면 er로 끝나는 이름으로 짓는게 좋다.</li> <li>인터페이스를 구현하는 사용자 정의 타입의 경우, 이 타입은 인터페이스 타입에 선언된 모든 메소드를 구현해야 한다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> search

<span class="token comment">// 기본 검색기를 구현할 defaultMatcher 타입</span>
<span class="token keyword">type</span> defaultMatcher <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// init 함수에서는 기본 검색기를 프로그램에 등록한다</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">var</span> matcher defaultMatcher
	<span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> matcher<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Search 함수는 기본 검색기의 동작을 구현한다</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m defaultMatcher<span class="token punctuation">)</span> <span class="token function">Search</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>defaultMatcher는 빈 구조체인데, 이 타입의 값이 생성될 때 0바이트가 할당된다.</li> <li>빈 구조체는 타입은 필요하지만 타입의 상태를 관리할 필요가 없는 경우에 유용하다</li> <li>기본 검색기의 경우 그 어떤 상태도 관리할 필요가 없이 오직 인터페이스만 구현하면 됨</li> <li>Search 메소드는 defaultMatcher 타입에 대한 값 수신기 (value receiver)를 선언한다.</li> <li>func (m defaultMatcher) Search(..) 이런식으로 선언하면, DefaultMatcher(타입).Search 이런식으로 사용이 가능해진다.</li> <li>리시버에는 포인터 참조를 넣건, 일반 값을 넣건 컴파일러가 알아서 수행한다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code>dm <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>defaultMatcher<span class="token punctuation">)</span>
dm<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>feed<span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>이런식으로 객체지향적으로 리시버를 활요하면 좋다</li> <li>리시버에서 만약 값 리시버가 아닌 포인터 리시버로 할 경우, 인터페이스 타입에서 메소드 호출을 할 때, 포인터 일때만 적용이 된다</li> <li>즉 가능한 리시버 설정시에는 값 리시버로 설정하는게 좋다</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// defaultMatcher 타입의 포인터 수신기를 이용해 메소드 선언</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>defaultMatcher<span class="token punctuation">)</span> <span class="token function">Search</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span>

<span class="token comment">// 인터페이스 타입값을 통해 메소드 호출</span>
<span class="token keyword">var</span> dm defaultMatcher
<span class="token keyword">var</span> matcher Matcher <span class="token operator">=</span> dm <span class="token comment">// 인터페이스 타입의 값을 대입</span>
matcher<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>feed<span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 포인터 리시버에다가 값을 넣으면 에러 발생</span>
<span class="token operator">--</span> <span class="token operator">&gt;</span> 에러 발생

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

<span class="token comment">// defaultMatcher 타입의 값 수신기를 이용해 메소드 선언</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m defaultMatcher<span class="token punctuation">)</span> <span class="token function">Search</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span>

<span class="token comment">// 인터페이스 타입 값을 통해 메소드 호출</span>
<span class="token keyword">var</span> dm defaultMatcher
<span class="token keyword">var</span> matcher matcher <span class="token operator">=</span> <span class="token operator">&amp;</span>dm <span class="token comment">// 인터페이스 타입의 포인터를 대입 </span>
matcher<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>feed<span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 포인터에 의한 인터페이스 메소드 호출 </span>
<span class="token operator">--</span><span class="token operator">&gt;</span> 에러 미발생
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> search

<span class="token keyword">import</span> <span class="token string">&quot;log&quot;</span>

<span class="token comment">// 검색 결과를 저장할 Result 구조체</span>
<span class="token keyword">type</span> Result <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Field <span class="token builtin">string</span>
	Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// Matcher 인터페이스는 새로운 검색 타입을 구현할 때 필요한 동작을 정의</span>
<span class="token keyword">type</span> Matcher <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Search</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Match 함수는 고루틴으로서 호출되며</span>
<span class="token comment">// 개별 피드 타입에 대한 검색을 동시에 수행한다</span>
<span class="token keyword">func</span> <span class="token function">Match</span><span class="token punctuation">(</span>matcher Matcher<span class="token punctuation">,</span> feed <span class="token operator">*</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">,</span> results <span class="token keyword">chan</span> <span class="token operator">&lt;-</span> <span class="token operator">*</span>Result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 지정된 검색기를 이용해 검색을 수행</span>
	searchResults<span class="token punctuation">,</span> err <span class="token operator">:=</span> matcher<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>feed<span class="token punctuation">,</span> searchTerm<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 검색 결과를 채널에 기록한다</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> result <span class="token operator">:=</span> <span class="token keyword">range</span> searchResults <span class="token punctuation">{</span>
		results <span class="token operator">&lt;-</span> result
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Display 함수는 개별 고루틴이 전달한 검색결과를 콘솔창에 출력</span>
<span class="token keyword">func</span> <span class="token function">Display</span><span class="token punctuation">(</span>results <span class="token keyword">chan</span> <span class="token operator">*</span>Result<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 채널은 검색 결과가 기록될 때까지 접근이 차단된다.</span>
	<span class="token comment">// 채널이 닫히면 for 루프가 종료된다</span>
	<span class="token keyword">for</span> result <span class="token operator">:=</span> <span class="token keyword">range</span> results <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: \n %s\n\n&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Field<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Content<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Register</span><span class="token punctuation">(</span>feedType <span class="token builtin">string</span><span class="token punctuation">,</span> matcher Matcher<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> exists <span class="token operator">:=</span> matchers<span class="token punctuation">[</span>feedType<span class="token punctuation">]</span><span class="token punctuation">;</span> exists <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>feedType<span class="token punctuation">,</span> <span class="token string">&quot;검색기가 이미 등록되었습니다&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;등록 완료 : &quot;</span><span class="token punctuation">,</span> feedType<span class="token punctuation">,</span> <span class="token string">&quot; 검색기&quot;</span><span class="token punctuation">)</span>
	matchers<span class="token punctuation">[</span>feedType<span class="token punctuation">]</span> <span class="token operator">=</span> matcher
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Match 함수는 Matcher 인터페이스를 구현하는 값이나 포인터에 의해 실제 검색을 수행하는 함수</li> <li>정상적으로 매치 서칭이 완료되면, 채널에다가 값을 넘겨버린다.</li> <li>이후에 Display에서 채널을 받게 되는데, 채널 결과가 전부 기록될 때까지 포문이 돌게 된다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> result <span class="token operator">:=</span> <span class="token keyword">range</span> searchResults <span class="token punctuation">{</span>
		results <span class="token operator">&lt;-</span> result
	<span class="token punctuation">}</span>
</code></pre></div><ul><li>해당 for문은 무한루프처럼 보이지만, 실제로 search.go파일에서</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 모든 자업이 처리될 때까지 기다린다</span>
		waitGroup<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// Display 함수에게 프로그램을 종류할 수 있음을 알리기 위해 채널을 닫는다.</span>
		<span class="token function">close</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>close(results)를 해줘서, 해당 채널이 닫히면, for 문이 끝나게 된다.</li> <li>Register 함수는 default.go 에서 init함수에서 쓰이는데, 특정 Matcher 타입을 등록하는 것이다.</li></ul> <h2 id="_4-rss-검색기"><a href="#_4-rss-검색기" class="header-anchor">#</a> 4. RSS 검색기</h2> <ul><li>RSS 는 기본검색기와는 다르게 인터페이스 메소드인 Search 메소드 구현 과정이 다르다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> matchers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;encoding/xml&quot;</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;regexp&quot;</span>

	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter2/sample/search&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> <span class="token punctuation">(</span>
	<span class="token comment">// item 구조체는 RSS 문서 내의 item 태그에</span>
	<span class="token comment">// 정의된 필드들에 대응하는 필드들을 선언한다.</span>
	item <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		XMLName     xml<span class="token punctuation">.</span>Name <span class="token string">`xml:&quot;item&quot;`</span>
		PubDate     <span class="token builtin">string</span>   <span class="token string">`xml:&quot;pubDate&quot;`</span>
		Title       <span class="token builtin">string</span>   <span class="token string">`xml:&quot;title&quot;`</span>
		Description <span class="token builtin">string</span>   <span class="token string">`xml:&quot;description&quot;`</span>
		Link        <span class="token builtin">string</span>   <span class="token string">`xml:&quot;link&quot;`</span>
		GUID        <span class="token builtin">string</span>   <span class="token string">`xml:&quot;guid&quot;`</span>
		GeoRssPoint <span class="token builtin">string</span>   <span class="token string">`xml:&quot;georss:point&quot;`</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// image 구조체는 RSS 문서 내의 image 태그에</span>
	<span class="token comment">// 정의된 필드들에 대응하는 필드들을 선언한다.</span>
	image <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		XMLName xml<span class="token punctuation">.</span>Name <span class="token string">`xml:&quot;image&quot;`</span>
		URL     <span class="token builtin">string</span>   <span class="token string">`xml:&quot;url&quot;`</span>
		Title   <span class="token builtin">string</span>   <span class="token string">`xml:&quot;title&quot;`</span>
		Link    <span class="token builtin">string</span>   <span class="token string">`xml:&quot;link&quot;`</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// channel 구조체는 RSS 문서 내의 channel 태그에</span>
	<span class="token comment">// 정의된 필드들에 대응하는 필드들을 선언한다.</span>
	channel <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		XMLName        xml<span class="token punctuation">.</span>Name <span class="token string">`xml:&quot;channel&quot;`</span>
		Title          <span class="token builtin">string</span>   <span class="token string">`xml:&quot;title&quot;`</span>
		Description    <span class="token builtin">string</span>   <span class="token string">`xml:&quot;description&quot;`</span>
		Link           <span class="token builtin">string</span>   <span class="token string">`xml:&quot;link&quot;`</span>
		PubDate        <span class="token builtin">string</span>   <span class="token string">`xml:&quot;pubDate&quot;`</span>
		LastBuildDate  <span class="token builtin">string</span>   <span class="token string">`xml:&quot;lastBuildDate&quot;`</span>
		TTL            <span class="token builtin">string</span>   <span class="token string">`xml:&quot;ttl&quot;`</span>
		Language       <span class="token builtin">string</span>   <span class="token string">`xml:&quot;language&quot;`</span>
		ManagingEditor <span class="token builtin">string</span>   <span class="token string">`xml:&quot;managingEditor&quot;`</span>
		WebMaster      <span class="token builtin">string</span>   <span class="token string">`xml:&quot;webMaster&quot;`</span>
		Image          image    <span class="token string">`xml:&quot;image&quot;`</span>
		Item           <span class="token punctuation">[</span><span class="token punctuation">]</span>item   <span class="token string">`xml:&quot;item&quot;`</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// rssDocument 구조체는 RSS 문서에 정의된 필드들에 대응하는 필드들을 정의한다.</span>
	rssDocument <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		XMLName xml<span class="token punctuation">.</span>Name <span class="token string">`xml:&quot;rss&quot;`</span>
		Channel channel  <span class="token string">`xml:&quot;channel&quot;`</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// Matcher 인터페이스를 구현하는 rssMatcher 타입을 선언한다.</span>
<span class="token keyword">type</span> rssMatcher <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// init 함수를 통해 프로그램에 검색기를 등록한다.</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> matcher rssMatcher
	search<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;rss&quot;</span><span class="token punctuation">,</span> matcher<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Search 함수는 지정된 문서에서 검색어를 검색한다.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m rssMatcher<span class="token punctuation">)</span> <span class="token function">Search</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>search<span class="token punctuation">.</span>Feed<span class="token punctuation">,</span> searchTerm <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>search<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>search<span class="token punctuation">.</span>Result

	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;피드 종류[%s] 사이트[%s] 주소[%s]에서 검색을 수행합니다.\n&quot;</span><span class="token punctuation">,</span> feed<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> feed<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> feed<span class="token punctuation">.</span>URI<span class="token punctuation">)</span>

	<span class="token comment">// 검색할 데이터를 조회한다.</span>
	document<span class="token punctuation">,</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span>feed<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> channelItem <span class="token operator">:=</span> <span class="token keyword">range</span> document<span class="token punctuation">.</span>Channel<span class="token punctuation">.</span>Item <span class="token punctuation">{</span>
		<span class="token comment">// 제목에서 검색어를 검색한다.</span>
		matched<span class="token punctuation">,</span> err <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span>searchTerm<span class="token punctuation">,</span> channelItem<span class="token punctuation">.</span>Title<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
		<span class="token punctuation">}</span>

		<span class="token comment">// 검색어가 발견되면 결과에 저장한다.</span>
		<span class="token keyword">if</span> matched <span class="token punctuation">{</span>
			results <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token operator">&amp;</span>search<span class="token punctuation">.</span>Result<span class="token punctuation">{</span>
				Field<span class="token punctuation">:</span>   <span class="token string">&quot;Title&quot;</span><span class="token punctuation">,</span>
				Content<span class="token punctuation">:</span> channelItem<span class="token punctuation">.</span>Title<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 상세 내용에서 검색어를 검색한다.</span>
		matched<span class="token punctuation">,</span> err <span class="token operator">=</span> regexp<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span>searchTerm<span class="token punctuation">,</span> channelItem<span class="token punctuation">.</span>Description<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
		<span class="token punctuation">}</span>

		<span class="token comment">// 검색어가 발견되면 결과에 저장한다.</span>
		<span class="token keyword">if</span> matched <span class="token punctuation">{</span>
			results <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token operator">&amp;</span>search<span class="token punctuation">.</span>Result<span class="token punctuation">{</span>
				Field<span class="token punctuation">:</span>   <span class="token string">&quot;Description&quot;</span><span class="token punctuation">,</span>
				Content<span class="token punctuation">:</span> channelItem<span class="token punctuation">.</span>Description<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> results<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// HTTP Get 요청을 수행해서 RSS 피드를 요청한 후 결과를 디코딩한다.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m rssMatcher<span class="token punctuation">)</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>feed <span class="token operator">*</span>search<span class="token punctuation">.</span>Feed<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>rssDocument<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> feed<span class="token punctuation">.</span>URI <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;검색할 RSS 피드가 정의되지 않았습니다.&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 웹에서 RSS 문서를 조회한다.</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>feed<span class="token punctuation">.</span>URI<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token comment">// 함수가 리턴될 때 응답 스트림을 닫는다.</span>
	<span class="token keyword">defer</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 상태 코드가 200인지를 검사해서</span>
	<span class="token comment">// 올바른 응답을 수신했는지를 확인한다.</span>
	<span class="token keyword">if</span> resp<span class="token punctuation">.</span>StatusCode <span class="token operator">!=</span> <span class="token number">200</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP 응답 오류: %d\n&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// RSS 피드 문서를 구조체 타입으로 디코드한다.</span>
	<span class="token comment">// 호출 함수가 에러를 판단할 것이기 때문에 이 함수에서는 에러를 처리하지 않는다.</span>
	<span class="token keyword">var</span> document rssDocument
	err <span class="token operator">=</span> xml<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>document<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>document<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre></div><ul><li>JSON 과 마찬가지로 RSS 문서를 디코딩하여 데이터 처리를 하기위한 구조체가 필요하다.</li> <li>rssMatcher 구조체를 선언한다 (Matcher 인터페이스 덕타이핑으로 구현)</li> <li>리시버 형태의 Search 함수와 retrieve 구현. 기타 확인건은 소스 확인을 통해 확인</li></ul> <h2 id="_5-요약"><a href="#_5-요약" class="header-anchor">#</a> 5. 요약</h2> <ul><li>모든 코드 파일은 패키지에 속해야 하며, 패키지 이름은 코드 파일이 존재하는 폴더의 이름과 동일해야 한다</li> <li>Go는 변수를 선언하고 초기화하기 위한 여러 방법 제공. 변수의 값이 명시적으로 초기화가 안되면 기본값으로 세팅한다</li> <li>포인터는 함수와 고루틴 간에 데이터를 공유하기 위한 방법을 제공</li> <li>채널을 이용하여 고루틴을 실행함으로써 동시성과 동기화를 처리할 수 있다</li> <li>Go는 Go의 내장 데이터 구조체를 지원하기 위한 내장 함수를 제공</li> <li>표준 라이브러리는 강력한 기능을 수행하는 여러 패키지를 제공</li> <li>Go의 인터페이스를 이용하면 범용 코드와 프레임워크 작성 가능</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/go-in-action/01.html" class="prev">1장 Go와의 첫 만남</a></span> <span class="next"><a href="/study-collection/book/go-in-action/03.html">3장 패키징과 내장 도구들</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.e4aeeab3.js" defer></script><script src="/study-collection/assets/js/2.5c09ce41.js" defer></script><script src="/study-collection/assets/js/58.93d46332.js" defer></script>
  </body>
</html>
