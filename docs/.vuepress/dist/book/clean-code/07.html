<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.48760978.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.2866634b.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.207401d1.js" as="script"><link rel="preload" href="/study-collection/assets/js/46.396e670b.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.7c8d4b19.js"><link rel="prefetch" href="/study-collection/assets/js/11.6fac3177.js"><link rel="prefetch" href="/study-collection/assets/js/12.d0547077.js"><link rel="prefetch" href="/study-collection/assets/js/13.64274134.js"><link rel="prefetch" href="/study-collection/assets/js/14.0ca4b171.js"><link rel="prefetch" href="/study-collection/assets/js/15.d18dddba.js"><link rel="prefetch" href="/study-collection/assets/js/16.d7f136f1.js"><link rel="prefetch" href="/study-collection/assets/js/17.77edb6ac.js"><link rel="prefetch" href="/study-collection/assets/js/18.cd330677.js"><link rel="prefetch" href="/study-collection/assets/js/19.f4e6c482.js"><link rel="prefetch" href="/study-collection/assets/js/20.2b413eb4.js"><link rel="prefetch" href="/study-collection/assets/js/21.84a533a3.js"><link rel="prefetch" href="/study-collection/assets/js/22.20346cf4.js"><link rel="prefetch" href="/study-collection/assets/js/23.aa97a967.js"><link rel="prefetch" href="/study-collection/assets/js/24.195cbd0a.js"><link rel="prefetch" href="/study-collection/assets/js/25.1543e45a.js"><link rel="prefetch" href="/study-collection/assets/js/26.b0992a6b.js"><link rel="prefetch" href="/study-collection/assets/js/27.e60e4c60.js"><link rel="prefetch" href="/study-collection/assets/js/28.5bc44c94.js"><link rel="prefetch" href="/study-collection/assets/js/29.1d78a1d7.js"><link rel="prefetch" href="/study-collection/assets/js/3.49188f51.js"><link rel="prefetch" href="/study-collection/assets/js/30.b8ca61a2.js"><link rel="prefetch" href="/study-collection/assets/js/31.4aa3a617.js"><link rel="prefetch" href="/study-collection/assets/js/32.1a57f4fe.js"><link rel="prefetch" href="/study-collection/assets/js/33.f4130382.js"><link rel="prefetch" href="/study-collection/assets/js/34.419beee9.js"><link rel="prefetch" href="/study-collection/assets/js/35.4e01430e.js"><link rel="prefetch" href="/study-collection/assets/js/36.96cc4253.js"><link rel="prefetch" href="/study-collection/assets/js/37.0dceff57.js"><link rel="prefetch" href="/study-collection/assets/js/38.34dff668.js"><link rel="prefetch" href="/study-collection/assets/js/39.4778de1a.js"><link rel="prefetch" href="/study-collection/assets/js/4.3a696dc4.js"><link rel="prefetch" href="/study-collection/assets/js/40.caa24d02.js"><link rel="prefetch" href="/study-collection/assets/js/41.9beae76b.js"><link rel="prefetch" href="/study-collection/assets/js/42.3c186cf0.js"><link rel="prefetch" href="/study-collection/assets/js/43.344c1164.js"><link rel="prefetch" href="/study-collection/assets/js/44.f6d351e6.js"><link rel="prefetch" href="/study-collection/assets/js/45.5fc1b2a8.js"><link rel="prefetch" href="/study-collection/assets/js/47.10e4b071.js"><link rel="prefetch" href="/study-collection/assets/js/48.7e89d54e.js"><link rel="prefetch" href="/study-collection/assets/js/49.74244218.js"><link rel="prefetch" href="/study-collection/assets/js/5.1d0b4fed.js"><link rel="prefetch" href="/study-collection/assets/js/50.4eff5ba8.js"><link rel="prefetch" href="/study-collection/assets/js/51.950960c8.js"><link rel="prefetch" href="/study-collection/assets/js/52.177826e2.js"><link rel="prefetch" href="/study-collection/assets/js/53.91e646fe.js"><link rel="prefetch" href="/study-collection/assets/js/54.c7d3398a.js"><link rel="prefetch" href="/study-collection/assets/js/55.9f96b113.js"><link rel="prefetch" href="/study-collection/assets/js/56.e3550236.js"><link rel="prefetch" href="/study-collection/assets/js/57.98ce2d1c.js"><link rel="prefetch" href="/study-collection/assets/js/58.46e7d189.js"><link rel="prefetch" href="/study-collection/assets/js/59.9336575f.js"><link rel="prefetch" href="/study-collection/assets/js/6.a2e4c693.js"><link rel="prefetch" href="/study-collection/assets/js/60.9d9df296.js"><link rel="prefetch" href="/study-collection/assets/js/61.d35e309e.js"><link rel="prefetch" href="/study-collection/assets/js/62.1ee3b1f5.js"><link rel="prefetch" href="/study-collection/assets/js/63.1c7f6af7.js"><link rel="prefetch" href="/study-collection/assets/js/64.9a42a0af.js"><link rel="prefetch" href="/study-collection/assets/js/65.ea838179.js"><link rel="prefetch" href="/study-collection/assets/js/66.c2ec34a8.js"><link rel="prefetch" href="/study-collection/assets/js/7.47ebc16c.js"><link rel="prefetch" href="/study-collection/assets/js/8.dc7c4f49.js"><link rel="prefetch" href="/study-collection/assets/js/9.37cad34d.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.48760978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>클린코드</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/clean-code/00.html" class="sidebar-link">0장 들어가면서</a></li><li><a href="/study-collection/book/clean-code/01.html" class="sidebar-link">1장 깨끗한 코드</a></li><li><a href="/study-collection/book/clean-code/02.html" class="sidebar-link">2장 의미있는 이름</a></li><li><a href="/study-collection/book/clean-code/03.html" class="sidebar-link">3장 함수</a></li><li><a href="/study-collection/book/clean-code/04.html" class="sidebar-link">4장 주석</a></li><li><a href="/study-collection/book/clean-code/05.html" class="sidebar-link">5장 포맷팅</a></li><li><a href="/study-collection/book/clean-code/06.html" class="sidebar-link">6장 객체와 자료구조</a></li><li><a href="/study-collection/book/clean-code/07.html" class="active sidebar-link">7장 오류처리</a></li><li><a href="/study-collection/book/clean-code/08.html" class="sidebar-link">8장 경계</a></li><li><a href="/study-collection/book/clean-code/09.html" class="sidebar-link">9장 단위테스트</a></li><li><a href="/study-collection/book/clean-code/10.html" class="sidebar-link">10장 클래스</a></li><li><a href="/study-collection/book/clean-code/11.html" class="sidebar-link">11장 시스템</a></li><li><a href="/study-collection/book/clean-code/12.html" class="sidebar-link">12장 창발성</a></li><li><a href="/study-collection/book/clean-code/13.html" class="sidebar-link">13장 동시성</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링 인 액션</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_7강"><a href="#_7강" class="header-anchor">#</a> 7강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#오류코드보다-예외를-사용하라">오류코드보다 예외를 사용하라</a></li><li><a href="#try-catch-finally-문부터-작성하라">Try-Catch-Finally 문부터 작성하라</a></li><li><a href="#미확인-unchecked-예외를-사용하라">미확인 (unchecked) 예외를 사용하라</a></li><li><a href="#예외에-의미를-제공하라">예외에 의미를 제공하라</a></li><li><a href="#호출자를-고려해-예외-클래스를-정의">호출자를 고려해 예외 클래스를 정의</a></li><li><a href="#정상-흐름을-정의하라">정상 흐름을 정의하라</a></li><li><a href="#null-을-반환하지-말자">null 을 반환하지 말자</a></li><li><a href="#null-을-전달하지-말자">null 을 전달하지 말자</a></li></ul></div><p></p> <h3 id="오류코드보다-예외를-사용하라"><a href="#오류코드보다-예외를-사용하라" class="header-anchor">#</a> 오류코드보다 예외를 사용하라</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeviceController</span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendShutDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DeviceHandle</span> handle <span class="token operator">=</span> <span class="token function">getHandle</span><span class="token punctuation">(</span>DEV1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Check the state of the device</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handle <span class="token operator">!=</span> <span class="token class-name">DeviceHandle</span><span class="token punctuation">.</span>INVALID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Save the device status to the record field</span>
      <span class="token function">retrieveDeviceRecord</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// If not suspended, shut down</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> DEVICE_SUSPENDED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">pauseDevice</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearDeviceWorkQueue</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">closeDevice</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Device suspended. Unable to shut down&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid handle for: &quot;</span> <span class="token operator">+</span> DEV1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위와 같은 코드는 호출자 코드가 매우 복잡해진다.</li> <li>함수를 호출한 즉시 오류를 확인해야 되고, 보통 이 과정은 까먹게 된다.</li> <li>차라리 예외를 던지는 편이 더 깔끔하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeviceController</span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendShutDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">tryToShutDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DeviceShutDownError</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">tryToShutDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">DeviceShutDownError</span> <span class="token punctuation">{</span>
    <span class="token class-name">DeviceHandle</span> handle <span class="token operator">=</span> <span class="token function">getHandle</span><span class="token punctuation">(</span>DEV1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DeviceRecord</span> record <span class="token operator">=</span> <span class="token function">retrieveDeviceRecord</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pauseDevice</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearDeviceWorkQueue</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">closeDevice</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token class-name">DeviceHandle</span> <span class="token function">getHandle</span><span class="token punctuation">(</span><span class="token class-name">DeviceID</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DeviceShutDownError</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid handle for: &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>보기도 깔끔하고, 셧다운과 에러처리가 분리되어 코드 품질도 올라갔다.</li></ul> <h3 id="try-catch-finally-문부터-작성하라"><a href="#try-catch-finally-문부터-작성하라" class="header-anchor">#</a> Try-Catch-Finally 문부터 작성하라</h3> <ul><li>어떠한 면에서 try 블록은 트랜잭션과 비슷하다.</li> <li>try 블록에서 뭔짓을 하던지 간에 catch 블록은 프로그램 상태를 일관성 있게 유지해야한다.</li> <li>그러므로 예외가 발생할 코들르 짤때는 try-catch-finally 문을 사용하자</li></ul> <h4 id="tdd-방식으로-메소드-구현"><a href="#tdd-방식으로-메소드-구현" class="header-anchor">#</a> TDD 방식으로 메소드 구현</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>expected <span class="token operator">=</span> <span class="token class-name">StorageException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">retrieveSectionShouldThrowOnInvalidFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sectionStore<span class="token punctuation">.</span><span class="token function">retrieveSection</span><span class="token punctuation">(</span><span class="token string">&quot;invalid - file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>파일이 없으면 예외를 던지는지 알아보는 단위테스트 예시</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RecordedGrip</span><span class="token punctuation">&gt;</span></span> <span class="token function">retrieveSection</span><span class="token punctuation">(</span><span class="token class-name">String</span> sectionName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">FileInputStream</span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>sectionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      stream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StorageException</span><span class="token punctuation">(</span><span class="token string">&quot;retrieval error&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RecordedGrip</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>요렇게 예외가 발생하면 잘 잡아준다.</li> <li>TDD 를 사용해 이제 필요한 나머지 논리를 추가하는 방식으로 코드를 짜보자</li> <li>나머지 논리는 FileInputStream을 생성하는 코드와 close 호출문 사이에 넣으면 오류나 예외가 전혀 발생하지 않는다고 가정한다.</li> <li>강제로 예외를 발생하는 케이스를 작성한 후 테스트를 통과하는 코드를 작성하는 방법으로 구현해보자.</li> <li>그렇게 되면 자연스럽게 try 블록의 트랜잭션 범위부터 구현하게 되므로 범위 내에서 트랜잭션 본질을 유지하기 쉽다.</li></ul> <h3 id="미확인-unchecked-예외를-사용하라"><a href="#미확인-unchecked-예외를-사용하라" class="header-anchor">#</a> 미확인 (unchecked) 예외를 사용하라</h3> <ul><li>checked 예외 는 컴파일 단계에서 확인되며 반드시 처리해야 하는 예외
<ul><li>IOException</li> <li>SQLException</li></ul></li> <li>Unchecked 예외 는 실행 단계에서 확인되며 명시적인 처리를 강제하지는 않는 예외
<ul><li>NullPointerException</li> <li>IllegalArgumentException</li> <li>IndexOutOfBoundException</li> <li>SystemException</li></ul></li> <li>확인된 예외는 OCP 법칙을 위반한다</li> <li>메소드에서 확인된 예외를 던졌는데 catch 블록이 세단계 위에 있다면, 그 사이 메소드 모두가 선언부에 해당 예외를 정의해야한다.</li> <li>즉 하위 단계에서 코드를 고치면 싹 다 메소드 선언부를 수정해야 한다는소리</li></ul> <h3 id="예외에-의미를-제공하라"><a href="#예외에-의미를-제공하라" class="header-anchor">#</a> 예외에 의미를 제공하라</h3> <ul><li>예외를 던질 땐, 전후 상황을 충분히 덧붙여야 한다</li> <li>오류가 발생한 원인과 위치를 더 찾기 쉬워지기 때문이다</li> <li>오류 메세지에 정보를 같이 던져주면 정보가 자세하게 나와 좀더 알아보기가 쉽다</li></ul> <h3 id="호출자를-고려해-예외-클래스를-정의"><a href="#호출자를-고려해-예외-클래스를-정의" class="header-anchor">#</a> 호출자를 고려해 예외 클래스를 정의</h3> <ul><li>어플리케이션에서 오류를 정의 할 때 프로그래머에게 가장 중요한 관심사는 <em>오류를 잡아내는 방법</em></li> <li>아래는 외부 라이브러리를 호출하는 try-catch-finally를 포함한 코드로, 라이브러리가 던질 예외를 모두 잡아낸다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ACMEPort</span> port <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ACMEPort</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
     port<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DeviceResponseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reportPortError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Device response exception&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ATM1212UnlockedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reportPortError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Unlock exception&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">GMXError</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reportPortError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Device response exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    …
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>보면 모든 에러가 잡아서 처리하는 방식이 다 똑같다.</li> <li>이걸 수정하려면 호출하는 라이브러리 API를 감싸면서 예외 유형을 하나더 만들면 된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">LocalPort</span> port <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalPort</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
     port<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PortDeviceFailure</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reportError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    …
    <span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalPort</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">ACMEPort</span> innerPort<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">LocalPort</span><span class="token punctuation">(</span><span class="token keyword">int</span> portNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    innerPort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ACMEPort</span><span class="token punctuation">(</span>portNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      innerPort<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DeviceResponseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PortDeviceFailure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ATM1212UnlockedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PortDeviceFailure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">GMXError</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PortDeviceFailure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
 …
<span class="token punctuation">}</span>
</code></pre></div><ul><li>여기서 LocalPort는 ACEMPort클래스가 던지는 예외를 잡아 변환하는 래퍼 클래스일 뿐이다.</li> <li>이렇게 외부 API를 사용할땐, 래퍼 클래스를 사용하는게 의존성도 줄어들고 제일 안정적인 방법</li> <li>나중에 다른 라이브러리로 바꾸더라도 위험이 덜하다. =&gt; 로컬포트만 수정하면 됨</li> <li>이런 래퍼 방식은 특정 업체가 API를 설계한 방식에 종속적으로 발목잡히지 않아도 되는 장점이 있다.</li></ul> <h3 id="정상-흐름을-정의하라"><a href="#정상-흐름을-정의하라" class="header-anchor">#</a> 정상 흐름을 정의하라</h3> <ul><li>특정 상황에선 위에서 했던거처럼 예외처리를 독자적으로 처리하고, 코드 위에 처리기를 정의해 중단된 계산을 처리하는 방식이 별로 일 수도 있다.</li> <li>클래스나 객체가 예외적인 상황을 캡슐화 해서 처리하는 경우이다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">MealExpenses</span> expenses<span class="token operator">=</span>expenseReportDAO<span class="token punctuation">.</span><span class="token function">getMeals</span><span class="token punctuation">(</span>employee<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_total<span class="token operator">+=</span>expenses<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">MealExpensesNotFound</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m_total<span class="token operator">+=</span><span class="token function">getMealPerDiem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위와 같은 코드는 예외 상황에 로직이 들어가서 좀더 헷갈리게 만든다</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MealExpenses</span> expenses <span class="token operator">=</span> expenseReportDAO<span class="token punctuation">.</span><span class="token function">getMeals</span><span class="token punctuation">(</span>employee<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m_total <span class="token operator">+=</span> expenses<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerDiemMealExpenses</span> <span class="token keyword">implements</span> <span class="token class-name">MealExpenses</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 기본값으로 일일 기본 식비를 반환한다.</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 클래스를 만들거나 객체를 조작해서 따로 예외 처리를 하지않도록 수정하는게 더 좋다.</li></ul> <h3 id="null-을-반환하지-말자"><a href="#null-을-반환하지-말자" class="header-anchor">#</a> null 을 반환하지 말자</h3> <ul><li>null 을 정신없이 확인하는 코드로 가득한 어플리케이션은 개후지다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerItem</span><span class="token punctuation">(</span><span class="token class-name">Item</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">ItemRegistry</span> registry <span class="token operator">=</span> peristentStore<span class="token punctuation">.</span><span class="token function">getItemRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>registry <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Item</span> existing <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>existing<span class="token punctuation">.</span><span class="token function">getBillingPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRetailOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          existing<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 호출자한테 null을 확인하라고 강제하는 코드는 아주 별로다</li> <li>null 체크를 하나라도 빼먹으면 통제 불능 상태가 올 수도 있다.</li> <li>위의 코드는 null 확인이 누락됐다기보단 확인이 너무많아서 문제이다.</li> <li>null을 쳐 던지는 대신에 예외를 잡아 던지거나, 특수 사례 객체를 반환하자.</li> <li>만약에 외부 API를 사용하는데 null을 던지고 있으면 한번 래핑해서 다른 객체를 반환하도록 바꿔주자.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> <span class="token function">getEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>employees <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e <span class="token operator">:</span> employees<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        totalPay <span class="token operator">+=</span> e<span class="token punctuation">.</span><span class="token function">getPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>이런코드는</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> <span class="token function">getEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e <span class="token operator">:</span> employees<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      totalPay <span class="token operator">+=</span> e<span class="token punctuation">.</span><span class="token function">getPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">getEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> there are no employees <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>getEmployees 에서 emptyList를 반환하도록 바꿔줘서 좀더 간결하게 코드를 바꿔주자</li></ul> <h3 id="null-을-전달하지-말자"><a href="#null-을-전달하지-말자" class="header-anchor">#</a> null 을 전달하지 말자</h3> <ul><li>null 반환은 별로지만, null 전달은 더 최악이다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MetricsCalculator</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">xProjection</span><span class="token punctuation">(</span><span class="token class-name">Point</span> p1<span class="token punctuation">,</span> <span class="token class-name">Point</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x – p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 …
<span class="token punctuation">}</span>
</code></pre></div><ul><li>여기서 null을 던지면?</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>caculator<span class="token punctuation">.</span><span class="token function">xProjection</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>당연히 nullPointException이 발생한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MetricsCalculator</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">xProjection</span><span class="token punctuation">(</span><span class="token class-name">Point</span> p1<span class="token punctuation">,</span> <span class="token class-name">Point</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p1 <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> p2 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token class-name">InvalidArgumentException</span><span class="token punctuation">(</span>
          <span class="token string">&quot;Invalid argument for MetricsCalculator.xProjection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x – p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 고치면 조금더 나아보이지만, InvalidArgumentException를 잡아내는 처리기가 또 필요하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MetricsCalculator</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">xProjection</span><span class="token punctuation">(</span><span class="token class-name">Point</span> p1<span class="token punctuation">,</span> <span class="token class-name">Point</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">assert</span> p1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token string">&quot;p1 should not be null&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">assert</span> p2 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token string">&quot;p2 should not be null&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x – p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이렇게 assert를 사용하면 조금더 깔끔해진다.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/clean-code/06.html" class="prev">6장 객체와 자료구조</a></span> <span class="next"><a href="/study-collection/book/clean-code/08.html">8장 경계</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.2866634b.js" defer></script><script src="/study-collection/assets/js/2.207401d1.js" defer></script><script src="/study-collection/assets/js/46.396e670b.js" defer></script>
  </body>
</html>
