<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>19강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.d9b30d9c.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.8d405e77.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.a40cbc6e.js" as="script"><link rel="preload" href="/study-collection/assets/js/29.1bb9f9bd.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.27df68d5.js"><link rel="prefetch" href="/study-collection/assets/js/100.e776014f.js"><link rel="prefetch" href="/study-collection/assets/js/101.740bef9e.js"><link rel="prefetch" href="/study-collection/assets/js/102.b2090372.js"><link rel="prefetch" href="/study-collection/assets/js/103.00e3cfec.js"><link rel="prefetch" href="/study-collection/assets/js/104.620c318a.js"><link rel="prefetch" href="/study-collection/assets/js/105.573c8b95.js"><link rel="prefetch" href="/study-collection/assets/js/106.32ccfe10.js"><link rel="prefetch" href="/study-collection/assets/js/107.07a5f4c3.js"><link rel="prefetch" href="/study-collection/assets/js/108.2e2e3512.js"><link rel="prefetch" href="/study-collection/assets/js/109.71f80959.js"><link rel="prefetch" href="/study-collection/assets/js/11.06e5bd22.js"><link rel="prefetch" href="/study-collection/assets/js/110.6dccd79d.js"><link rel="prefetch" href="/study-collection/assets/js/111.461e030a.js"><link rel="prefetch" href="/study-collection/assets/js/112.a4fd7d37.js"><link rel="prefetch" href="/study-collection/assets/js/113.e1603a8b.js"><link rel="prefetch" href="/study-collection/assets/js/114.04bbdf37.js"><link rel="prefetch" href="/study-collection/assets/js/115.5a73c4be.js"><link rel="prefetch" href="/study-collection/assets/js/116.91a1670e.js"><link rel="prefetch" href="/study-collection/assets/js/117.4f722379.js"><link rel="prefetch" href="/study-collection/assets/js/118.3401a8f3.js"><link rel="prefetch" href="/study-collection/assets/js/119.28249dbe.js"><link rel="prefetch" href="/study-collection/assets/js/12.048c7f19.js"><link rel="prefetch" href="/study-collection/assets/js/120.6af60c5d.js"><link rel="prefetch" href="/study-collection/assets/js/121.323b9e51.js"><link rel="prefetch" href="/study-collection/assets/js/122.a86ce2dc.js"><link rel="prefetch" href="/study-collection/assets/js/123.b4492445.js"><link rel="prefetch" href="/study-collection/assets/js/124.b8ea8706.js"><link rel="prefetch" href="/study-collection/assets/js/125.8c259e2d.js"><link rel="prefetch" href="/study-collection/assets/js/126.75d82ffd.js"><link rel="prefetch" href="/study-collection/assets/js/127.aec00273.js"><link rel="prefetch" href="/study-collection/assets/js/128.99a67fa4.js"><link rel="prefetch" href="/study-collection/assets/js/129.9e20030f.js"><link rel="prefetch" href="/study-collection/assets/js/13.0a8c9585.js"><link rel="prefetch" href="/study-collection/assets/js/130.c4f4ac8e.js"><link rel="prefetch" href="/study-collection/assets/js/131.91e8de3b.js"><link rel="prefetch" href="/study-collection/assets/js/132.24a24d54.js"><link rel="prefetch" href="/study-collection/assets/js/133.01034548.js"><link rel="prefetch" href="/study-collection/assets/js/134.41196219.js"><link rel="prefetch" href="/study-collection/assets/js/135.caff56fb.js"><link rel="prefetch" href="/study-collection/assets/js/136.36f941a0.js"><link rel="prefetch" href="/study-collection/assets/js/137.f5cb86da.js"><link rel="prefetch" href="/study-collection/assets/js/138.79b5e3af.js"><link rel="prefetch" href="/study-collection/assets/js/139.c382af30.js"><link rel="prefetch" href="/study-collection/assets/js/14.cbb6e7dd.js"><link rel="prefetch" href="/study-collection/assets/js/140.7ca6b7c3.js"><link rel="prefetch" href="/study-collection/assets/js/141.bd889e59.js"><link rel="prefetch" href="/study-collection/assets/js/142.85581735.js"><link rel="prefetch" href="/study-collection/assets/js/143.7c8b308d.js"><link rel="prefetch" href="/study-collection/assets/js/144.ec15d926.js"><link rel="prefetch" href="/study-collection/assets/js/145.7c26110a.js"><link rel="prefetch" href="/study-collection/assets/js/146.253ef0e1.js"><link rel="prefetch" href="/study-collection/assets/js/147.2d25fba5.js"><link rel="prefetch" href="/study-collection/assets/js/148.f7654d04.js"><link rel="prefetch" href="/study-collection/assets/js/149.2f0716d9.js"><link rel="prefetch" href="/study-collection/assets/js/15.d8e61629.js"><link rel="prefetch" href="/study-collection/assets/js/150.ae537993.js"><link rel="prefetch" href="/study-collection/assets/js/151.efbb955e.js"><link rel="prefetch" href="/study-collection/assets/js/152.604e6f9a.js"><link rel="prefetch" href="/study-collection/assets/js/153.ae3593d8.js"><link rel="prefetch" href="/study-collection/assets/js/154.c4de82cc.js"><link rel="prefetch" href="/study-collection/assets/js/155.c6c0633c.js"><link rel="prefetch" href="/study-collection/assets/js/156.00421175.js"><link rel="prefetch" href="/study-collection/assets/js/157.502f72d5.js"><link rel="prefetch" href="/study-collection/assets/js/158.31d83ba5.js"><link rel="prefetch" href="/study-collection/assets/js/159.91eee19d.js"><link rel="prefetch" href="/study-collection/assets/js/16.dcd5f18e.js"><link rel="prefetch" href="/study-collection/assets/js/160.e034610c.js"><link rel="prefetch" href="/study-collection/assets/js/161.06bb0f21.js"><link rel="prefetch" href="/study-collection/assets/js/162.75706571.js"><link rel="prefetch" href="/study-collection/assets/js/163.17cd3431.js"><link rel="prefetch" href="/study-collection/assets/js/164.ce9ed7d3.js"><link rel="prefetch" href="/study-collection/assets/js/165.478c2133.js"><link rel="prefetch" href="/study-collection/assets/js/166.9a9e4b3c.js"><link rel="prefetch" href="/study-collection/assets/js/167.43d0270f.js"><link rel="prefetch" href="/study-collection/assets/js/17.9a9b769f.js"><link rel="prefetch" href="/study-collection/assets/js/18.4e05ba5c.js"><link rel="prefetch" href="/study-collection/assets/js/19.6e9f62c7.js"><link rel="prefetch" href="/study-collection/assets/js/20.1ec34c93.js"><link rel="prefetch" href="/study-collection/assets/js/21.b8b55e77.js"><link rel="prefetch" href="/study-collection/assets/js/22.fd592f0a.js"><link rel="prefetch" href="/study-collection/assets/js/23.f131fa66.js"><link rel="prefetch" href="/study-collection/assets/js/24.50e54ddb.js"><link rel="prefetch" href="/study-collection/assets/js/25.4e07f363.js"><link rel="prefetch" href="/study-collection/assets/js/26.2b060f26.js"><link rel="prefetch" href="/study-collection/assets/js/27.866a93b3.js"><link rel="prefetch" href="/study-collection/assets/js/28.41d9af76.js"><link rel="prefetch" href="/study-collection/assets/js/3.31b89b2a.js"><link rel="prefetch" href="/study-collection/assets/js/30.0cbeba74.js"><link rel="prefetch" href="/study-collection/assets/js/31.9241e607.js"><link rel="prefetch" href="/study-collection/assets/js/32.70ebbe4e.js"><link rel="prefetch" href="/study-collection/assets/js/33.29a30bef.js"><link rel="prefetch" href="/study-collection/assets/js/34.ab93bc1c.js"><link rel="prefetch" href="/study-collection/assets/js/35.ccef9d9c.js"><link rel="prefetch" href="/study-collection/assets/js/36.0a3a7215.js"><link rel="prefetch" href="/study-collection/assets/js/37.f5efe6f3.js"><link rel="prefetch" href="/study-collection/assets/js/38.9420ef9d.js"><link rel="prefetch" href="/study-collection/assets/js/39.608b20cf.js"><link rel="prefetch" href="/study-collection/assets/js/4.cc08a0aa.js"><link rel="prefetch" href="/study-collection/assets/js/40.05b00d1a.js"><link rel="prefetch" href="/study-collection/assets/js/41.a61292fd.js"><link rel="prefetch" href="/study-collection/assets/js/42.4a34da77.js"><link rel="prefetch" href="/study-collection/assets/js/43.3ce51516.js"><link rel="prefetch" href="/study-collection/assets/js/44.5e108eaa.js"><link rel="prefetch" href="/study-collection/assets/js/45.26dab6c9.js"><link rel="prefetch" href="/study-collection/assets/js/46.46a8656a.js"><link rel="prefetch" href="/study-collection/assets/js/47.1404b118.js"><link rel="prefetch" href="/study-collection/assets/js/48.6423abf4.js"><link rel="prefetch" href="/study-collection/assets/js/49.f5c9468a.js"><link rel="prefetch" href="/study-collection/assets/js/5.432aaeec.js"><link rel="prefetch" href="/study-collection/assets/js/50.d927863e.js"><link rel="prefetch" href="/study-collection/assets/js/51.7bba4635.js"><link rel="prefetch" href="/study-collection/assets/js/52.2c083569.js"><link rel="prefetch" href="/study-collection/assets/js/53.37f17974.js"><link rel="prefetch" href="/study-collection/assets/js/54.08379cd2.js"><link rel="prefetch" href="/study-collection/assets/js/55.4a80a5c0.js"><link rel="prefetch" href="/study-collection/assets/js/56.16ab7bc1.js"><link rel="prefetch" href="/study-collection/assets/js/57.32775736.js"><link rel="prefetch" href="/study-collection/assets/js/58.e6e75c82.js"><link rel="prefetch" href="/study-collection/assets/js/59.3cd571c6.js"><link rel="prefetch" href="/study-collection/assets/js/6.a228315d.js"><link rel="prefetch" href="/study-collection/assets/js/60.37fa076d.js"><link rel="prefetch" href="/study-collection/assets/js/61.a284cbbf.js"><link rel="prefetch" href="/study-collection/assets/js/62.a02a154d.js"><link rel="prefetch" href="/study-collection/assets/js/63.8760a6d5.js"><link rel="prefetch" href="/study-collection/assets/js/64.d82b7104.js"><link rel="prefetch" href="/study-collection/assets/js/65.3d5dda84.js"><link rel="prefetch" href="/study-collection/assets/js/66.56301363.js"><link rel="prefetch" href="/study-collection/assets/js/67.7831fbe3.js"><link rel="prefetch" href="/study-collection/assets/js/68.d436e4e5.js"><link rel="prefetch" href="/study-collection/assets/js/69.ddf455a3.js"><link rel="prefetch" href="/study-collection/assets/js/7.58d873bc.js"><link rel="prefetch" href="/study-collection/assets/js/70.91ed8032.js"><link rel="prefetch" href="/study-collection/assets/js/71.920df52e.js"><link rel="prefetch" href="/study-collection/assets/js/72.92814c4b.js"><link rel="prefetch" href="/study-collection/assets/js/73.9e0e1856.js"><link rel="prefetch" href="/study-collection/assets/js/74.320191c7.js"><link rel="prefetch" href="/study-collection/assets/js/75.c645caf5.js"><link rel="prefetch" href="/study-collection/assets/js/76.4915cd1e.js"><link rel="prefetch" href="/study-collection/assets/js/77.cef8533f.js"><link rel="prefetch" href="/study-collection/assets/js/78.653c8ed7.js"><link rel="prefetch" href="/study-collection/assets/js/79.f0ebdd60.js"><link rel="prefetch" href="/study-collection/assets/js/8.29b8adde.js"><link rel="prefetch" href="/study-collection/assets/js/80.5709b582.js"><link rel="prefetch" href="/study-collection/assets/js/81.e59aebb6.js"><link rel="prefetch" href="/study-collection/assets/js/82.07a3ccaf.js"><link rel="prefetch" href="/study-collection/assets/js/83.e30d3e18.js"><link rel="prefetch" href="/study-collection/assets/js/84.bf4ad50a.js"><link rel="prefetch" href="/study-collection/assets/js/85.f87f0a23.js"><link rel="prefetch" href="/study-collection/assets/js/86.42acc7d2.js"><link rel="prefetch" href="/study-collection/assets/js/87.e07e3bf0.js"><link rel="prefetch" href="/study-collection/assets/js/88.9ce1c89e.js"><link rel="prefetch" href="/study-collection/assets/js/89.c28be8ea.js"><link rel="prefetch" href="/study-collection/assets/js/9.a63607fb.js"><link rel="prefetch" href="/study-collection/assets/js/90.d34d5ed3.js"><link rel="prefetch" href="/study-collection/assets/js/91.88d146ff.js"><link rel="prefetch" href="/study-collection/assets/js/92.ca628580.js"><link rel="prefetch" href="/study-collection/assets/js/93.472afc05.js"><link rel="prefetch" href="/study-collection/assets/js/94.0d7587a3.js"><link rel="prefetch" href="/study-collection/assets/js/95.db18925e.js"><link rel="prefetch" href="/study-collection/assets/js/96.d8e49ffa.js"><link rel="prefetch" href="/study-collection/assets/js/97.001fe5ee.js"><link rel="prefetch" href="/study-collection/assets/js/98.4601c157.js"><link rel="prefetch" href="/study-collection/assets/js/99.c495c217.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.d9b30d9c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>TDD By Example</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>고 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Go 언어를 활용한 마이크로서비스 개발</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>카프카 스트림즈 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>모던 자바 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/modern-java-in-action/01.html" class="sidebar-link">1장 자바 8, 9, 10, 11 : 무슨 일이 일어나고 있는가?</a></li><li><a href="/study-collection/book/modern-java-in-action/02.html" class="sidebar-link">2장 동작 파라미터화 코드 전달하기</a></li><li><a href="/study-collection/book/modern-java-in-action/03.html" class="sidebar-link">3장 람다 표현식</a></li><li><a href="/study-collection/book/modern-java-in-action/04.html" class="sidebar-link">4장 스트림 소개</a></li><li><a href="/study-collection/book/modern-java-in-action/05.html" class="sidebar-link">5장 스트림 활용</a></li><li><a href="/study-collection/book/modern-java-in-action/06.html" class="sidebar-link">6장 스트림으로 데이터 수집</a></li><li><a href="/study-collection/book/modern-java-in-action/07.html" class="sidebar-link">7장 병렬 데이터 처리와 성능</a></li><li><a href="/study-collection/book/modern-java-in-action/08.html" class="sidebar-link">8장 컬렉션 API 개선</a></li><li><a href="/study-collection/book/modern-java-in-action/09.html" class="sidebar-link">9장 리팩터링, 테스팅, 디버깅</a></li><li><a href="/study-collection/book/modern-java-in-action/10.html" class="sidebar-link">10장 람다를 이용한 도메인 전용 언어</a></li><li><a href="/study-collection/book/modern-java-in-action/11.html" class="sidebar-link">11장 null 대신 Optional 클래스</a></li><li><a href="/study-collection/book/modern-java-in-action/12.html" class="sidebar-link">12장 새로운 냘짜와 시간 API</a></li><li><a href="/study-collection/book/modern-java-in-action/13.html" class="sidebar-link">13장 디폴트 메소드</a></li><li><a href="/study-collection/book/modern-java-in-action/14.html" class="sidebar-link">14장 자바 모듈 시스템</a></li><li><a href="/study-collection/book/modern-java-in-action/15.html" class="sidebar-link">15장 CompletableFuture와 리액티브 프로그래밍 컨셉의 기초</a></li><li><a href="/study-collection/book/modern-java-in-action/16.html" class="sidebar-link">16장 안정적 비동기 프로그래밍</a></li><li><a href="/study-collection/book/modern-java-in-action/17.html" class="sidebar-link">17장 리액티브 프로그래밍</a></li><li><a href="/study-collection/book/modern-java-in-action/18.html" class="sidebar-link">18장 함수형 관점으로 생각하기</a></li><li><a href="/study-collection/book/modern-java-in-action/19.html" class="active sidebar-link">19장 함수형 프로그래밍 기법</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>객체지향의 사실과 오해</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>뇌를 자극하는 윈도우즈 시스템 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링5를 활용한 리액티브 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_19강"><a href="#_19강" class="header-anchor">#</a> 19강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-함수는-모든-곳에-존재한다">1. 함수는 모든 곳에 존재한다.</a><ul><li><a href="#_1-1-고차원-함수">1-1. 고차원 함수</a></li><li><a href="#_1-2-커링">1-2. 커링</a></li></ul></li><li><a href="#_2-영속-자료구조">2. 영속 자료구조</a><ul><li><a href="#_2-1-파괴적인-갱신과-함수형">2-1. 파괴적인 갱신과 함수형</a></li><li><a href="#_2-2-트리를-사용한-다른-예제">2-2. 트리를 사용한 다른 예제</a></li><li><a href="#_2-3-함수형-접근법-사용">2-3. 함수형 접근법 사용</a></li></ul></li><li><a href="#_3-스트림과-게으른-평가">3. 스트림과 게으른 평가</a><ul><li><a href="#_3-1-자기-정의-스트림">3-1. 자기 정의 스트림</a></li><li><a href="#_3-2-게으른-리스트-만들기">3-2. 게으른 리스트 만들기</a></li></ul></li><li><a href="#_4-패턴-매칭">4. 패턴 매칭</a><ul><li><a href="#_4-1-방문자-디자인-패턴">4-1. 방문자 디자인 패턴</a></li></ul></li></ul></div><p></p> <h2 id="_1-함수는-모든-곳에-존재한다"><a href="#_1-함수는-모든-곳에-존재한다" class="header-anchor">#</a> 1. 함수는 모든 곳에 존재한다.</h2> <ul><li>앞에서 본 것 처럼 함수는 부작용이 없이 동작하는 것을 의미한다.</li> <li>함수라는 용어를 좀더 폭넓게 사용해, 함수를 마치 일반값처럼 사용해서 인수로 전달하거나, 결과로 반환받거나 할 수있다.</li> <li>이렇게 일반값처럼 취급할 수 있는 함수를 <code>일급 함수</code>라고 한다.</li> <li>자바 8이 바뀐부분 중 하나가 이런 일급함수를 지원한다는 점이다.</li> <li>::처럼 메소드 참조를 만들거나, 람다식의 사용이 가능하다.</li></ul> <h3 id="_1-1-고차원-함수"><a href="#_1-1-고차원-함수" class="header-anchor">#</a> 1-1. 고차원 함수</h3> <ul><li>함숫값을 자바8 스트림처리나, 메소드 참조를 사용해 동적파라미터화를 하는 용도로만 썼다.</li> <li>아래 그림처럼 함수를 인수로 받아 다른 함수로 반환하는 정적메소드 Comparator.comparing같은 것도 있었다.</li></ul> <p><img src="/study-collection/assets/img/mj_19_1.f6f56b3b.jpg" alt="mj"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Apple</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">getWeight</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>3장에서는 함수를 조립해서 연산 파이프라인을 만들 때 위 코드와 비슷한 기능을 활용했다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> transformationPipeline
  <span class="token operator">=</span> addHeader<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">checkSpelling</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token class-name">Letter</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">addFooter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>Comparator.comapring처럼 다음 중 하나 이상의 동작을 수행하는 함수를 <code>고차원 함수</code>라 부른다.</p> <ul><li>하나 이상의 함수를 인수로 받음</li> <li>함수를 결과로 반환</li></ul></li> <li><p>자바 8은 함수를 인수로 받기도하고 결과로도 반환하고, 지역 변수로도 할당하거나, 구조체로 삽입할 수 있어서 자바8의 함수도 고차원 함수라고 할 수 있다.</p></li></ul> <h3 id="_1-2-커링"><a href="#_1-2-커링" class="header-anchor">#</a> 1-2. 커링</h3> <ul><li>대부분의 어플리케이션은 국제화를 지원해야 하는데, 이때 단위 변환 문제가 발생할 수 있다.</li> <li>보통 <code>변환 요소</code>와 <code>기준치 조정 요소</code>가 단위 변환 결과를 좌우한다.</li> <li>예를들어 CtoF(x) = x*9/5 + 32 처럼 섭씨 to 화씨</li> <li>다음과 같은 패턴으로 단위를 표현할 수 있다.
<ul><li>변환 요소를 곱함</li> <li>기준치 조정 요소를 적용</li></ul></li> <li>아래와 같이 메소드로 표현해보면</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">converter</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> f<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> f <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>x는 변환하려는 값, f는 변환 요소, b는 기준치 보정 요소이다.</li> <li>온도말고 km같은 거리 단위 변환이 필요할 수도 있으므로, 세 개의 인수를 받는 converter라는 메소드를 만들어 문제를 해결할 수 있다.</li> <li>하지만 이런 방법은 인수에 변환 요소와 기준치를 넣어주는 귀찮은 일이고, 오타가 발생할 수 있다.</li> <li>기존 로직을 활용해서 변환기를 특정 상호아에 적용할 수 있는 방법이 있는데, <code>커링</code>이라는 개념을 사용해 한 개의 인수를 갖는 변환 함수를 생산하는 팩토리를 정의하는거다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">DoubleUnaryOperator</span> <span class="token function">curriedConverter</span><span class="token punctuation">(</span><span class="token keyword">double</span> f<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">*</span> f <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>원래처럼 매번 새로운 값을 넣어 주는게 아닌, 위의 curriedConverter를 사용해 변환기 메소드를 정의해 주는 것이다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DoubleUnaryOperator</span> convertCtoF <span class="token operator">=</span> <span class="token function">curriedConverter</span><span class="token punctuation">(</span><span class="token number">9.0</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DoubleUnaryOperator</span> convertUSDtoGBP <span class="token operator">=</span> <span class="token function">curriedConverter</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DoubleUnaryOperator</span> convertKmtoMi <span class="token operator">=</span> <span class="token function">curriedConverter</span><span class="token punctuation">(</span><span class="token number">0.6214</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>DoubleUnaryOperator는 applyAsDouble이라는 메소드를 정의하므로, 이런식으로 사용이 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">double</span> gbp <span class="token operator">=</span> convertUSDtoGBP<span class="token punctuation">.</span><span class="token function">applyAsDouble</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>이런식으로 기존 변환 로직을 재활용하는 유연한 코드를 짤 수 있다.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>커링의 이론적 정의</p> <p>커링은 x와 y라는 두 인수를 받는 함수 f를 한 개의 인수를 받는 g라는 함수로 대체하는 기법. g라는 함수 역시 하나의 인수를 받는 함수를 반환한다. 함수 g와 원래 함수 f가 최정적으로 반환하는 값은 같다. 수학적으로 f(x,y) = (g(x))(y) 인셈</p></div> <h2 id="_2-영속-자료구조"><a href="#_2-영속-자료구조" class="header-anchor">#</a> 2. 영속 자료구조</h2> <ul><li>함수형 프로그램에서는 자료구조를 함수형 자료구조, 불변 자료구조 등의 용어로도 사용하긴 하지만 보통은 영속 자료구조라고 부른다.</li> <li>함수형 메소드에서는 전역 자료구조나 인수로 전달된 구조를 갱신할 수 없다. -&gt; 당연히 값이 바뀔테니까..</li></ul> <h3 id="_2-1-파괴적인-갱신과-함수형"><a href="#_2-1-파괴적인-갱신과-함수형" class="header-anchor">#</a> 2-1. 파괴적인 갱신과 함수형</h3> <ul><li>A에서 B까지 기차여행을 의미하는 가변 TrainJourney 클래스</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TrainJourney</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> price<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TrainJourney</span> onward<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TrainJourney</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token class-name">TrainJourney</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        price <span class="token operator">=</span> p<span class="token punctuation">;</span>
        onward <span class="token operator">=</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이때 X에서 Y까지, 그리고 Y에서 Z까지의 여행을 나타내는 별도의 TrainJourney 객체가 있다고 가정한다.</li> <li>이 두 개의 TrainJourney객체를 연결해 하나의 여행을 만들 수 있다.</li> <li>X -&gt; Y -&gt; Z</li> <li>단순 명령형 메소드면 이런식으로 이으면 된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">TrainJourney</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token class-name">TrainJourney</span> a<span class="token punctuation">,</span> <span class="token class-name">TrainJourney</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> b<span class="token punctuation">;</span>
    <span class="token class-name">TrainJourney</span> t <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>onward <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        t <span class="token operator">=</span> t<span class="token punctuation">.</span>onward<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    t<span class="token punctuation">.</span>onward <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 결합은, 문제가 link(first, second)를 하면, first를 변경시키게 돼서 X에서 Y로의 여정이 아닌 X에서 Z로의 여정을 의미하게 된다.</li> <li>이런걸 파괴적인 갱신 (first가 변경됨)이라고 한다.</li> <li>함수형에서는 이 같은 부작용을 수반하는 메소드를 제한하는 방식으로 문제를 해결한다.</li> <li>계산 결과를 표현할 자료구조가 필요하면 기존 자료구조를 쓰는게 아닌, 새로운 자료구조를 만들어 사용한다.</li> <li>이는 표준 객체지향 프로그래밍의 관점에서도 좋은 기법이다.</li> <li>함수형을 따르지 않는 프로그램은 주석 따윌 남겨서 덕지덕지 되므로 깔끔한 함수형 해결 방버을 사용하자.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">TrainJourney</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">TrainJourney</span> a<span class="token punctuation">,</span> <span class="token class-name">TrainJourney</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">==</span><span class="token keyword">null</span> <span class="token operator">?</span> b <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">TrainJourney</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>price<span class="token punctuation">,</span> <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>onward<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>기존 자료구조를 변경하지 않는다.</li></ul> <p><img src="/study-collection/assets/img/mj_19_2.0080aae4.jpg" alt="mj"></p> <p><img src="/study-collection/assets/img/mj_19_3.65bf91db.jpg" alt="mj"></p> <h3 id="_2-2-트리를-사용한-다른-예제"><a href="#_2-2-트리를-사용한-다른-예제" class="header-anchor">#</a> 2-2. 트리를 사용한 다른 예제</h3> <ul><li>HashMap 같은 인터페이스를 구현할 때는 이진 탐색 트리가 사용된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Tree</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">int</span> val<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">Tree</span> left<span class="token punctuation">,</span> right<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token class-name">String</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">Tree</span> l<span class="token punctuation">,</span> <span class="token class-name">Tree</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     key <span class="token operator">=</span> k<span class="token punctuation">;</span> val <span class="token operator">=</span> v<span class="token punctuation">;</span> left <span class="token operator">=</span> l<span class="token punctuation">;</span> right <span class="token operator">=</span> r<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TreeProcessor</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token class-name">String</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> defaultval<span class="token punctuation">,</span> <span class="token class-name">Tree</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> defaultval<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">lookup</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> defaultval<span class="token punctuation">,</span>
                         k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> t<span class="token punctuation">.</span>left <span class="token operator">:</span> t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// other methods processing a Tree</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이제 값갱신 코드</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> newval<span class="token punctuation">,</span> <span class="token class-name">Tree</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* should add a new node */</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> t<span class="token punctuation">.</span>val <span class="token operator">=</span> newval<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newval<span class="token punctuation">,</span> k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> t<span class="token punctuation">.</span>left <span class="token operator">:</span> t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>update의 가장 쉬운 방법은 메소드가 탐색한 트리를 그대로 반환하는 것이다.</li> <li>하지만 이렇게 되면 기존 트리가 변경될 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Tree</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> newval<span class="token punctuation">,</span> <span class="token class-name">Tree</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
       t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newval<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
       t<span class="token punctuation">.</span>val <span class="token operator">=</span> newval<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
       t<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newval<span class="token punctuation">,</span> t<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
       t<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newval<span class="token punctuation">,</span> t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-3-함수형-접근법-사용"><a href="#_2-3-함수형-접근법-사용" class="header-anchor">#</a> 2-3. 함수형 접근법 사용</h3> <ul><li>이 문제를 함수형으로 처리해 본다.</li> <li>매번 새로운 노드들을 만들어준다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Tree</span> <span class="token function">fupdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> newval<span class="token punctuation">,</span> <span class="token class-name">Tree</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span>
         <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newval<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">:</span>
          k<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">?</span>
            <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> newval<span class="token punctuation">,</span> t<span class="token punctuation">.</span>left<span class="token punctuation">,</span> t<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">:</span>
       k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span>
         <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">,</span> t<span class="token punctuation">.</span>val<span class="token punctuation">,</span> <span class="token function">fupdate</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>newval<span class="token punctuation">,</span> t<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">:</span>
         <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">,</span> t<span class="token punctuation">.</span>val<span class="token punctuation">,</span> t<span class="token punctuation">.</span>left<span class="token punctuation">,</span> <span class="token function">fupdate</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>newval<span class="token punctuation">,</span> t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>fupadte를 호출하면 매번 새로운 트리를 뱉어서 던져준다.</li> <li>이와 같은 함수형 자료구조를 <code>영속</code>(저장된 값이 다른 누군가에 의해 영향을 받지 않는 상태)라고 하며 따라서 프로그래머는 fupdate가 인수로 전달된 자료구조를 변화시키지 않는걸 알 수 있다.</li> <li>다만 여기서 주의할 점은, 결과 자료구조를 바꾸면 안된다는 것이다. (생까고 키에 값을 넣는거 말하는듯) 그럴 경우 의도치 않는 갱신이 발생할 수 있다.</li></ul> <p><img src="/study-collection/assets/img/mj_19_4.4fb77d77.jpg" alt="mj"></p> <h2 id="_3-스트림과-게으른-평가"><a href="#_3-스트림과-게으른-평가" class="header-anchor">#</a> 3. 스트림과 게으른 평가</h2> <ul><li>스트림은 단 한번만 소비할 수 있는 제약이 있어 스트림은 재귀적으로 정의할 수 없다.</li> <li>이런 제약으로 어떤 문제가 발생하는지 보자</li></ul> <h3 id="_3-1-자기-정의-스트림"><a href="#_3-1-자기-정의-스트림" class="header-anchor">#</a> 3-1. 자기 정의 스트림</h3> <ul><li>소수를 생성하는 예제로 스트림을 살펴본다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">primes</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i <span class="token operator">-&gt;</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">MyMathUtils</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">isPrime</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> candidateRoot <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> candidateRoot<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> candidate <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>매번 candidate 수로 정확히 나눠지는지 매번 모든 수를 반복 확인해 깔끔하진 않은 코드이다.</li> <li>이론적으로 소수로 나눌 수 있는 모든 수는 제외할 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">1.</span> 소수를 선택할 숫자 스트림이 필요하다<span class="token punctuation">.</span>
<span class="token number">2.</span> 스트림에서 첫 번째 수 <span class="token punctuation">(</span>스트림의 머리<span class="token punctuation">)</span>를 가져온다<span class="token punctuation">.</span> 이 숫자는 소수다<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">3.</span> 이제 스트림의 꼬리에서 가져온 수로 나누어 떨어지는 모든 수를 걸러 제외시킨다<span class="token punctuation">.</span>
<span class="token number">4.</span> 이렇게 남은 숫자만 포함하는 새로운 스트림에서 소수를 찾는다<span class="token punctuation">.</span> 이제 <span class="token number">1</span>번부터 다시 이과정 반복 따라서 재귀<span class="token punctuation">.</span>
</code></pre></div><ul><li>위의 알고리즘은 부족한 알고리즘이다.</li></ul> <h4 id="_1단계-스트림-숫자-얻기"><a href="#_1단계-스트림-숫자-얻기" class="header-anchor">#</a> 1단계: 스트림 숫자 얻기</h4> <ul><li>InputStream.iterate 메소드를 이용하면 2에서 시작하는 무한 숫자 스트림 생성이 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">Intstream</span> <span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n <span class="token operator">-&gt;</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2단계-헤드-획득"><a href="#_2단계-헤드-획득" class="header-anchor">#</a> 2단계: 헤드 획득</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token class-name">IntStream</span> numbers<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> numbers<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3단계-꼬리-필터링"><a href="#_3단계-꼬리-필터링" class="header-anchor">#</a> 3단계: 꼬리 필터링</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">IntStream</span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token class-name">IntStream</span> numbers<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> numbers<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IntStream</span> numbers <span class="token operator">=</span> <span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> head <span class="token operator">=</span> <span class="token function">head</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IntStream</span> filtered <span class="token operator">=</span> <span class="token function">tail</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> n <span class="token operator">%</span> head <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4단계-재귀적으로-소수-스트림-생성"><a href="#_4단계-재귀적으로-소수-스트림-생성" class="header-anchor">#</a> 4단계: 재귀적으로 소수 스트림 생성</h4> <ul><li>반복적으로 머리를 얻어 스트림을 필터링하려 할 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">IntStream</span> <span class="token function">primes</span><span class="token punctuation">(</span><span class="token class-name">IntStream</span> numbers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> head <span class="token operator">=</span> <span class="token function">head</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
             <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token function">primes</span><span class="token punctuation">(</span><span class="token function">tail</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> n <span class="token operator">%</span> head <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="나쁜-소식"><a href="#나쁜-소식" class="header-anchor">#</a> 나쁜 소식</h4> <ul><li>근데 이렇게 돌리면 &quot;stream has already been operatied upon or closed&quot; 에러가 발생한다.</li> <li>머리와 꼬리로 분리하는 두 개의 최종연산 findFirst와 skip을 사용해서 두번 소비를 하게 돼 에러가 발생하는 것</li></ul> <h4 id="게으른-평가"><a href="#게으른-평가" class="header-anchor">#</a> 게으른 평가</h4> <ul><li>더 심각한건 IntStream.concat은 두 개의 스트림 인스턴스를 인수로 받게되어, 두 번째 인수가 primes를 직접 재귀적으로 호출하면서 무한 재귀에 빠진다.</li> <li>이런걸 해결하기 위해 concat의 두 번째 인수에서 primes를 게으르게 평가하는 방식으로 해결이 가능하다.</li></ul> <h3 id="_3-2-게으른-리스트-만들기"><a href="#_3-2-게으른-리스트-만들기" class="header-anchor">#</a> 3-2. 게으른 리스트 만들기</h3> <ul><li>스트림은 스트림에 최정연산을 적용해서 실제 계산을 할 때 실제 연산이 이루어 진다.</li> <li>여기선 비슷한 개념인 게으른 리스트를 알아본다.</li> <li>게으른 리스트는 고차원 함수라는 개념도 지원한다.</li></ul> <p><img src="/study-collection/assets/img/mj_19_5.8b592e89.jpg" alt="mj"></p> <ul><li>LinkedList의 요소는 메모리에 존재하지만, LazyList의 요소는 Function이 요청해야 생성된다.</li></ul> <h4 id="기본적인-연결-리스트"><a href="#기본적인-연결-리스트" class="header-anchor">#</a> 기본적인 연결 리스트</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MyLinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">T</span> head<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> tail<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">MyLinkedList</span><span class="token punctuation">(</span><span class="token class-name">T</span> head<span class="token punctuation">,</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> tail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> head<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tail <span class="token operator">=</span> tail<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> head<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> tail<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Empty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>값을 만들 땐 다음과 같이 만든다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> l <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">MyLinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyLinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Empty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="기본적인-게으른-리스트"><a href="#기본적인-게으른-리스트" class="header-anchor">#</a> 기본적인 게으른 리스트</h4> <ul><li>Supplier<T>를 이용해 게으른 리스트를 만들면 꼬리가 모두 메모리에 존재하지 않게 할 수 있다.</T></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function</span><span class="token punctuation">.</span><span class="token class-name">Supplier</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">LazyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">T</span> head<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyList</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tail<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">LazyList</span><span class="token punctuation">(</span><span class="token class-name">T</span> head<span class="token punctuation">,</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyList</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> head<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tail <span class="token operator">=</span> tail<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> head<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> tail<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이제 Supplier의 get메소드를 호출하면 팩토리로 새로운 객체 만들듯이 LazyList의 노드가 만들어진다.</li> <li>연속적인 숫자의 다음 요소를 만드는 LazyList의 생성자에 tail 인수로 Supplier를 전달하는 방식으로 무한히 게으른 리스트 생성이 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LazyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">from</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="소수-생성으로-돌아와서"><a href="#소수-생성으로-돌아와서" class="header-anchor">#</a> 소수 생성으로 돌아와서</h4> <ul><li>기존 코드에서 LazyList를 적용해 준다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">primes</span><span class="token punctuation">(</span><span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LazyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                 numbers<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                 <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">primes</span><span class="token punctuation">(</span>
                         numbers<span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> n <span class="token operator">%</span> numbers<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                             <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="게으른-필터-구현"><a href="#게으른-필터-구현" class="header-anchor">#</a> 게으른 필터 구현</h4> <ul><li>LazyList는 당연히 filter메소드를 정의하지 않으므로, 컴파일 에러가 발생한다. 이걸 해결해본다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span>
           <span class="token keyword">this</span> <span class="token operator">:</span>
           p<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span>
               <span class="token keyword">new</span> <span class="token class-name">LazyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span>
               <span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>실제 사용 코드</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">LazyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers <span class="token operator">=</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> two <span class="token operator">=</span> <span class="token function">primes</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> three <span class="token operator">=</span> <span class="token function">primes</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> five <span class="token operator">=</span> <span class="token function">primes</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>two <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> three <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> five<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>이제 재귀적으로 문제 해결이 가능하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">printAll</span><span class="token punctuation">(</span><span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">printAll</span><span class="token punctuation">(</span><span class="token function">primes</span><span class="token punctuation">(</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>물론 무한히 실행되지 않고 스택오버플로우가 발생한다.</li></ul> <h2 id="_4-패턴-매칭"><a href="#_4-패턴-매칭" class="header-anchor">#</a> 4. 패턴 매칭</h2> <h3 id="_4-1-방문자-디자인-패턴"><a href="#_4-1-방문자-디자인-패턴" class="header-anchor">#</a> 4-1. 방문자 디자인 패턴</h3> <ul><li>특정 데이터 형식을 '방문'하는 알고리즘을 캡슐화하는 클래스를 따로 만들 수 있다.</li> <li>방무자 클래스는 지정된 데이터 형식의 인스턴스를 입력으로 받는다.</li> <li>그리고 인스턴스의 모든 멤버에 접근한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BinOp</span> <span class="token keyword">extends</span> <span class="token class-name">Expr</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token class-name">Expr</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">SimplifyExprVisitor</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>SimplifyExprVisitor는 BinOp 객체를 언랩할 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimplifyExprVisitor</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token class-name">Expr</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">BinOp</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>opname<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>right <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> e<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="자바의-패턴매칭-흉내내기"><a href="#자바의-패턴매칭-흉내내기" class="header-anchor">#</a> 자바의 패턴매칭 흉내내기</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">TriFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token class-name">R</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">S</span> s<span class="token punctuation">,</span> <span class="token class-name">T</span> t<span class="token punctuation">,</span> <span class="token class-name">U</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">patternMatchExpr</span><span class="token punctuation">(</span>
                       <span class="token class-name">Expr</span> e<span class="token punctuation">,</span>
                       <span class="token class-name">TriFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> binopcase<span class="token punctuation">,</span>
                       <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> numcase<span class="token punctuation">,</span>
                       <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> defaultcase<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
     <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">BinOp</span><span class="token punctuation">)</span> <span class="token operator">?</span>
        binopcase<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BinOp</span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span>opname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BinOp</span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span>left<span class="token punctuation">,</span>
                                           <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BinOp</span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">:</span>
     <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">Number</span><span class="token punctuation">)</span> <span class="token operator">?</span>
        numcase<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">)</span> <span class="token operator">:</span>
        defaultcase<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Expr</span> <span class="token function">simplify</span><span class="token punctuation">(</span><span class="token class-name">Expr</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TriFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">&gt;</span></span> binopcase <span class="token operator">=</span>
        <span class="token punctuation">(</span>opname<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>opname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> left<span class="token punctuation">)</span><span class="token punctuation">.</span>val <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> right<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> right<span class="token punctuation">)</span><span class="token punctuation">.</span>val <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> left<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>opname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> left<span class="token punctuation">)</span><span class="token punctuation">.</span>val <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> right<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">)</span> right<span class="token punctuation">)</span><span class="token punctuation">.</span>val <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> left<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BinOp</span><span class="token punctuation">(</span>opname<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">&gt;</span></span> numcase <span class="token operator">=</span> val <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Expr</span><span class="token punctuation">&gt;</span></span> defaultcase <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">patternMatchExpr</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> binopcase<span class="token punctuation">,</span> numcase<span class="token punctuation">,</span> defaultcase<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Expr</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinOp</span><span class="token punctuation">(</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Expr</span> match <span class="token operator">=</span> <span class="token function">simplify</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/modern-java-in-action/18.html" class="prev">18장 함수형 관점으로 생각하기</a></span> <span class="next"><a href="/study-collection/book/oop-true-false/01.html">1장 협력하는 객체들의 공동체</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.8d405e77.js" defer></script><script src="/study-collection/assets/js/2.a40cbc6e.js" defer></script><script src="/study-collection/assets/js/29.1bb9f9bd.js" defer></script>
  </body>
</html>
