<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.d9b30d9c.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.8d405e77.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.a40cbc6e.js" as="script"><link rel="preload" href="/study-collection/assets/js/116.91a1670e.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.27df68d5.js"><link rel="prefetch" href="/study-collection/assets/js/100.e776014f.js"><link rel="prefetch" href="/study-collection/assets/js/101.740bef9e.js"><link rel="prefetch" href="/study-collection/assets/js/102.b2090372.js"><link rel="prefetch" href="/study-collection/assets/js/103.00e3cfec.js"><link rel="prefetch" href="/study-collection/assets/js/104.620c318a.js"><link rel="prefetch" href="/study-collection/assets/js/105.573c8b95.js"><link rel="prefetch" href="/study-collection/assets/js/106.32ccfe10.js"><link rel="prefetch" href="/study-collection/assets/js/107.07a5f4c3.js"><link rel="prefetch" href="/study-collection/assets/js/108.2e2e3512.js"><link rel="prefetch" href="/study-collection/assets/js/109.71f80959.js"><link rel="prefetch" href="/study-collection/assets/js/11.06e5bd22.js"><link rel="prefetch" href="/study-collection/assets/js/110.6dccd79d.js"><link rel="prefetch" href="/study-collection/assets/js/111.461e030a.js"><link rel="prefetch" href="/study-collection/assets/js/112.a4fd7d37.js"><link rel="prefetch" href="/study-collection/assets/js/113.e1603a8b.js"><link rel="prefetch" href="/study-collection/assets/js/114.04bbdf37.js"><link rel="prefetch" href="/study-collection/assets/js/115.5a73c4be.js"><link rel="prefetch" href="/study-collection/assets/js/117.4f722379.js"><link rel="prefetch" href="/study-collection/assets/js/118.3401a8f3.js"><link rel="prefetch" href="/study-collection/assets/js/119.28249dbe.js"><link rel="prefetch" href="/study-collection/assets/js/12.048c7f19.js"><link rel="prefetch" href="/study-collection/assets/js/120.6af60c5d.js"><link rel="prefetch" href="/study-collection/assets/js/121.323b9e51.js"><link rel="prefetch" href="/study-collection/assets/js/122.a86ce2dc.js"><link rel="prefetch" href="/study-collection/assets/js/123.b4492445.js"><link rel="prefetch" href="/study-collection/assets/js/124.b8ea8706.js"><link rel="prefetch" href="/study-collection/assets/js/125.8c259e2d.js"><link rel="prefetch" href="/study-collection/assets/js/126.75d82ffd.js"><link rel="prefetch" href="/study-collection/assets/js/127.aec00273.js"><link rel="prefetch" href="/study-collection/assets/js/128.99a67fa4.js"><link rel="prefetch" href="/study-collection/assets/js/129.9e20030f.js"><link rel="prefetch" href="/study-collection/assets/js/13.0a8c9585.js"><link rel="prefetch" href="/study-collection/assets/js/130.c4f4ac8e.js"><link rel="prefetch" href="/study-collection/assets/js/131.91e8de3b.js"><link rel="prefetch" href="/study-collection/assets/js/132.24a24d54.js"><link rel="prefetch" href="/study-collection/assets/js/133.01034548.js"><link rel="prefetch" href="/study-collection/assets/js/134.41196219.js"><link rel="prefetch" href="/study-collection/assets/js/135.caff56fb.js"><link rel="prefetch" href="/study-collection/assets/js/136.36f941a0.js"><link rel="prefetch" href="/study-collection/assets/js/137.f5cb86da.js"><link rel="prefetch" href="/study-collection/assets/js/138.79b5e3af.js"><link rel="prefetch" href="/study-collection/assets/js/139.c382af30.js"><link rel="prefetch" href="/study-collection/assets/js/14.cbb6e7dd.js"><link rel="prefetch" href="/study-collection/assets/js/140.7ca6b7c3.js"><link rel="prefetch" href="/study-collection/assets/js/141.bd889e59.js"><link rel="prefetch" href="/study-collection/assets/js/142.85581735.js"><link rel="prefetch" href="/study-collection/assets/js/143.7c8b308d.js"><link rel="prefetch" href="/study-collection/assets/js/144.ec15d926.js"><link rel="prefetch" href="/study-collection/assets/js/145.7c26110a.js"><link rel="prefetch" href="/study-collection/assets/js/146.253ef0e1.js"><link rel="prefetch" href="/study-collection/assets/js/147.2d25fba5.js"><link rel="prefetch" href="/study-collection/assets/js/148.f7654d04.js"><link rel="prefetch" href="/study-collection/assets/js/149.2f0716d9.js"><link rel="prefetch" href="/study-collection/assets/js/15.d8e61629.js"><link rel="prefetch" href="/study-collection/assets/js/150.ae537993.js"><link rel="prefetch" href="/study-collection/assets/js/151.efbb955e.js"><link rel="prefetch" href="/study-collection/assets/js/152.604e6f9a.js"><link rel="prefetch" href="/study-collection/assets/js/153.ae3593d8.js"><link rel="prefetch" href="/study-collection/assets/js/154.c4de82cc.js"><link rel="prefetch" href="/study-collection/assets/js/155.c6c0633c.js"><link rel="prefetch" href="/study-collection/assets/js/156.00421175.js"><link rel="prefetch" href="/study-collection/assets/js/157.502f72d5.js"><link rel="prefetch" href="/study-collection/assets/js/158.31d83ba5.js"><link rel="prefetch" href="/study-collection/assets/js/159.91eee19d.js"><link rel="prefetch" href="/study-collection/assets/js/16.dcd5f18e.js"><link rel="prefetch" href="/study-collection/assets/js/160.e034610c.js"><link rel="prefetch" href="/study-collection/assets/js/161.06bb0f21.js"><link rel="prefetch" href="/study-collection/assets/js/162.75706571.js"><link rel="prefetch" href="/study-collection/assets/js/163.17cd3431.js"><link rel="prefetch" href="/study-collection/assets/js/164.ce9ed7d3.js"><link rel="prefetch" href="/study-collection/assets/js/165.478c2133.js"><link rel="prefetch" href="/study-collection/assets/js/166.9a9e4b3c.js"><link rel="prefetch" href="/study-collection/assets/js/167.43d0270f.js"><link rel="prefetch" href="/study-collection/assets/js/17.9a9b769f.js"><link rel="prefetch" href="/study-collection/assets/js/18.4e05ba5c.js"><link rel="prefetch" href="/study-collection/assets/js/19.6e9f62c7.js"><link rel="prefetch" href="/study-collection/assets/js/20.1ec34c93.js"><link rel="prefetch" href="/study-collection/assets/js/21.b8b55e77.js"><link rel="prefetch" href="/study-collection/assets/js/22.fd592f0a.js"><link rel="prefetch" href="/study-collection/assets/js/23.f131fa66.js"><link rel="prefetch" href="/study-collection/assets/js/24.50e54ddb.js"><link rel="prefetch" href="/study-collection/assets/js/25.4e07f363.js"><link rel="prefetch" href="/study-collection/assets/js/26.2b060f26.js"><link rel="prefetch" href="/study-collection/assets/js/27.866a93b3.js"><link rel="prefetch" href="/study-collection/assets/js/28.41d9af76.js"><link rel="prefetch" href="/study-collection/assets/js/29.1bb9f9bd.js"><link rel="prefetch" href="/study-collection/assets/js/3.31b89b2a.js"><link rel="prefetch" href="/study-collection/assets/js/30.0cbeba74.js"><link rel="prefetch" href="/study-collection/assets/js/31.9241e607.js"><link rel="prefetch" href="/study-collection/assets/js/32.70ebbe4e.js"><link rel="prefetch" href="/study-collection/assets/js/33.29a30bef.js"><link rel="prefetch" href="/study-collection/assets/js/34.ab93bc1c.js"><link rel="prefetch" href="/study-collection/assets/js/35.ccef9d9c.js"><link rel="prefetch" href="/study-collection/assets/js/36.0a3a7215.js"><link rel="prefetch" href="/study-collection/assets/js/37.f5efe6f3.js"><link rel="prefetch" href="/study-collection/assets/js/38.9420ef9d.js"><link rel="prefetch" href="/study-collection/assets/js/39.608b20cf.js"><link rel="prefetch" href="/study-collection/assets/js/4.cc08a0aa.js"><link rel="prefetch" href="/study-collection/assets/js/40.05b00d1a.js"><link rel="prefetch" href="/study-collection/assets/js/41.a61292fd.js"><link rel="prefetch" href="/study-collection/assets/js/42.4a34da77.js"><link rel="prefetch" href="/study-collection/assets/js/43.3ce51516.js"><link rel="prefetch" href="/study-collection/assets/js/44.5e108eaa.js"><link rel="prefetch" href="/study-collection/assets/js/45.26dab6c9.js"><link rel="prefetch" href="/study-collection/assets/js/46.46a8656a.js"><link rel="prefetch" href="/study-collection/assets/js/47.1404b118.js"><link rel="prefetch" href="/study-collection/assets/js/48.6423abf4.js"><link rel="prefetch" href="/study-collection/assets/js/49.f5c9468a.js"><link rel="prefetch" href="/study-collection/assets/js/5.432aaeec.js"><link rel="prefetch" href="/study-collection/assets/js/50.d927863e.js"><link rel="prefetch" href="/study-collection/assets/js/51.7bba4635.js"><link rel="prefetch" href="/study-collection/assets/js/52.2c083569.js"><link rel="prefetch" href="/study-collection/assets/js/53.37f17974.js"><link rel="prefetch" href="/study-collection/assets/js/54.08379cd2.js"><link rel="prefetch" href="/study-collection/assets/js/55.4a80a5c0.js"><link rel="prefetch" href="/study-collection/assets/js/56.16ab7bc1.js"><link rel="prefetch" href="/study-collection/assets/js/57.32775736.js"><link rel="prefetch" href="/study-collection/assets/js/58.e6e75c82.js"><link rel="prefetch" href="/study-collection/assets/js/59.3cd571c6.js"><link rel="prefetch" href="/study-collection/assets/js/6.a228315d.js"><link rel="prefetch" href="/study-collection/assets/js/60.37fa076d.js"><link rel="prefetch" href="/study-collection/assets/js/61.a284cbbf.js"><link rel="prefetch" href="/study-collection/assets/js/62.a02a154d.js"><link rel="prefetch" href="/study-collection/assets/js/63.8760a6d5.js"><link rel="prefetch" href="/study-collection/assets/js/64.d82b7104.js"><link rel="prefetch" href="/study-collection/assets/js/65.3d5dda84.js"><link rel="prefetch" href="/study-collection/assets/js/66.56301363.js"><link rel="prefetch" href="/study-collection/assets/js/67.7831fbe3.js"><link rel="prefetch" href="/study-collection/assets/js/68.d436e4e5.js"><link rel="prefetch" href="/study-collection/assets/js/69.ddf455a3.js"><link rel="prefetch" href="/study-collection/assets/js/7.58d873bc.js"><link rel="prefetch" href="/study-collection/assets/js/70.91ed8032.js"><link rel="prefetch" href="/study-collection/assets/js/71.920df52e.js"><link rel="prefetch" href="/study-collection/assets/js/72.92814c4b.js"><link rel="prefetch" href="/study-collection/assets/js/73.9e0e1856.js"><link rel="prefetch" href="/study-collection/assets/js/74.320191c7.js"><link rel="prefetch" href="/study-collection/assets/js/75.c645caf5.js"><link rel="prefetch" href="/study-collection/assets/js/76.4915cd1e.js"><link rel="prefetch" href="/study-collection/assets/js/77.cef8533f.js"><link rel="prefetch" href="/study-collection/assets/js/78.653c8ed7.js"><link rel="prefetch" href="/study-collection/assets/js/79.f0ebdd60.js"><link rel="prefetch" href="/study-collection/assets/js/8.29b8adde.js"><link rel="prefetch" href="/study-collection/assets/js/80.5709b582.js"><link rel="prefetch" href="/study-collection/assets/js/81.e59aebb6.js"><link rel="prefetch" href="/study-collection/assets/js/82.07a3ccaf.js"><link rel="prefetch" href="/study-collection/assets/js/83.e30d3e18.js"><link rel="prefetch" href="/study-collection/assets/js/84.bf4ad50a.js"><link rel="prefetch" href="/study-collection/assets/js/85.f87f0a23.js"><link rel="prefetch" href="/study-collection/assets/js/86.42acc7d2.js"><link rel="prefetch" href="/study-collection/assets/js/87.e07e3bf0.js"><link rel="prefetch" href="/study-collection/assets/js/88.9ce1c89e.js"><link rel="prefetch" href="/study-collection/assets/js/89.c28be8ea.js"><link rel="prefetch" href="/study-collection/assets/js/9.a63607fb.js"><link rel="prefetch" href="/study-collection/assets/js/90.d34d5ed3.js"><link rel="prefetch" href="/study-collection/assets/js/91.88d146ff.js"><link rel="prefetch" href="/study-collection/assets/js/92.ca628580.js"><link rel="prefetch" href="/study-collection/assets/js/93.472afc05.js"><link rel="prefetch" href="/study-collection/assets/js/94.0d7587a3.js"><link rel="prefetch" href="/study-collection/assets/js/95.db18925e.js"><link rel="prefetch" href="/study-collection/assets/js/96.d8e49ffa.js"><link rel="prefetch" href="/study-collection/assets/js/97.001fe5ee.js"><link rel="prefetch" href="/study-collection/assets/js/98.4601c157.js"><link rel="prefetch" href="/study-collection/assets/js/99.c495c217.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.d9b30d9c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>TDD By Example</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>고 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/go-in-action/01.html" class="sidebar-link">1장 Go와의 첫 만남</a></li><li><a href="/study-collection/book/go-in-action/02.html" class="sidebar-link">2장 Go 간단히 살펴보기</a></li><li><a href="/study-collection/book/go-in-action/03.html" class="sidebar-link">3장 패키징과 내장 도구들</a></li><li><a href="/study-collection/book/go-in-action/04.html" class="sidebar-link">4장 배열, 슬라이스, 맵</a></li><li><a href="/study-collection/book/go-in-action/05.html" class="sidebar-link">5장 Go의 타입 시스템</a></li><li><a href="/study-collection/book/go-in-action/06.html" class="sidebar-link">6장 동시성</a></li><li><a href="/study-collection/book/go-in-action/07.html" class="active sidebar-link">7장 동시성 패턴</a></li><li><a href="/study-collection/book/go-in-action/08.html" class="sidebar-link">8장 표준 라이브러리</a></li><li><a href="/study-collection/book/go-in-action/09.html" class="sidebar-link">9장 테스트와 벤치마킹</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Go 언어를 활용한 마이크로서비스 개발</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>카프카 스트림즈 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>모던 자바 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>객체지향의 사실과 오해</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>뇌를 자극하는 윈도우즈 시스템 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링5를 활용한 리액티브 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_7강"><a href="#_7강" class="header-anchor">#</a> 7강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-runner-패키지">1. Runner 패키지</a></li><li><a href="#_2-풀링">2. 풀링</a></li><li><a href="#_3-work-패키지">3. work 패키지</a></li><li><a href="#_4-요약">4. 요약</a></li></ul></div><p></p> <h2 id="_1-runner-패키지"><a href="#_1-runner-패키지" class="header-anchor">#</a> 1. Runner 패키지</h2> <ul><li>runner 패키지의 목적은 채널을 이용해 프로그램의 실행 시간을 관찰하고 프로그램이 너무 오래 실행되면 종료하는 것</li> <li>runner 패키지에 작성된 runnger.go 파일</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 가브리엘 애자로스(Gabriel Aszalos)가 도움을 준 예제</span>
<span class="token comment">// runner 패키지는 프로세스의 실행 및 수명주기를 관리한다.</span>
<span class="token keyword">package</span> runner

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;os/signal&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Runner 타입은 주어진 타임아웃 시간 동안 일련의 작업을 수행한다.</span>
<span class="token comment">// 그리고 운영체제 인터럽트에 의해 실행이 종료된다.</span>
<span class="token keyword">type</span> Runner <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// 운영체제로부터 전달되는 인터럽트 신호를</span>
	<span class="token comment">// 수신하기 위한 채널</span>
	interrupt <span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal

	<span class="token comment">// 처리가 종료되었음을 알리기 위한 채널</span>
	complete <span class="token keyword">chan</span> <span class="token builtin">error</span>

	<span class="token comment">// 지정된 시간이 초과했음을 알리기 위한 채널</span>
	timeout <span class="token operator">&lt;-</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time

	<span class="token comment">// 인덱스 순서로 처리될 작업의 목록을</span>
	<span class="token comment">// 저장하기 위한 슬라이스</span>
	tasks <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// timeout 채널에서 값을 수신하면 ErrTimeout을 리턴한다.</span>
<span class="token keyword">var</span> ErrTimeout <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;시간을 초과했습니다.&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 운영체제 이벤트를 수신하면 ErrInterrupt를 리턴한다.</span>
<span class="token keyword">var</span> ErrInterrupt <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;운영체제 인터럽트 신호를 수신했습니다.&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 실행할 Runner 타입 값을 리턴하는 함수</span>
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>Runner <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Runner<span class="token punctuation">{</span>
		interrupt<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		complete<span class="token punctuation">:</span>  <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		timeout<span class="token punctuation">:</span>   time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Runner 타입에 작업을 추가하는 메서드</span>
<span class="token comment">// 작업은 int형 ID를 매개변수로 전달받는 함수이다.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>tasks <span class="token operator">...</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r<span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>tasks<span class="token punctuation">,</span> tasks<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 저장된 모든 작업을 실행하고 채널 이벤트를 관찰한다.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token comment">// 모든 종류의 인터럽트 신호를 수신한다.</span>
	signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>interrupt<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Interrupt<span class="token punctuation">)</span>

	<span class="token comment">// 각각의 작업을 각기 다른 고루틴을 통해 실행한다.</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		r<span class="token punctuation">.</span>complete <span class="token operator">&lt;-</span> r<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 작업 완료 신호를 수신한 경우</span>
	<span class="token keyword">case</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>r<span class="token punctuation">.</span>complete<span class="token punctuation">:</span>
		<span class="token keyword">return</span> err

	<span class="token comment">// 작업 시간 초과 신호를 수신한 경우</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>r<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
		<span class="token keyword">return</span> ErrTimeout
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 개별 작업을 실행하는 메서드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> id<span class="token punctuation">,</span> task <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>tasks <span class="token punctuation">{</span>
		<span class="token comment">// OS로부터 인터럽트 신호를 수신했는지 확인한다.</span>
		<span class="token keyword">if</span> r<span class="token punctuation">.</span><span class="token function">gotInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> ErrInterrupt
		<span class="token punctuation">}</span>

		<span class="token comment">// 작업을 실행한다.</span>
		<span class="token function">task</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// 인터럽트 신호가 수신되었는지 확인하는 메서드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">gotInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 인터럽트 이벤트가 발생한 경우</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>r<span class="token punctuation">.</span>interrupt<span class="token punctuation">:</span>
		<span class="token comment">// 이후에 발생하는 인터럽트 신호를 더 이상 수신하지 않도록 한다.</span>
		signal<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>interrupt<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>

	<span class="token comment">// 작업을 계속해서 실행하게 한다.</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 예제는 예약 설정에 따라 실행되는 작업 위주의 프로그램을 작성한 코드</li> <li>위 프로그램이 종료되는 경우는 다음과 같다
<ul><li>지정된 시간 동안 작업을 모두 처리하면 자연스럽게 종료</li> <li>프로그램이 제 시간에 작업을 완료하지 못하면 종료</li> <li>운영체제로부터 인터럽트 신호가 발생하면 종료하기 위해 시도</li></ul></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter7/runner&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> timeout  <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;작업을 시작합니다&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// 실행 시간을 이용해 새로운 작업 실행기 생성</span>
	r <span class="token operator">:=</span> runner<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>

	<span class="token comment">// 수행할 작업 등록</span>
	r<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// 작업을 실행하고 결과를 처리</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">switch</span> err <span class="token punctuation">{</span>
		<span class="token keyword">case</span> runner<span class="token punctuation">.</span>ErrTimeout<span class="token punctuation">:</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;지정된 작업 시간 초과&quot;</span><span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> runner<span class="token punctuation">.</span>ErrInterrupt<span class="token punctuation">:</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;운영체제 인터럽트 발생&quot;</span><span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;프로그램 종료&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 지정된 시간동안 암것도 안하는 예제를 위한 생성함수</span>
<span class="token keyword">func</span> <span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;프로세서 - 작업 #%d&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">30</span> 작업을 시작합니다
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">30</span> 프로세서 <span class="token operator">-</span> 작업 #<span class="token number">0</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">30</span> 프로세서 <span class="token operator">-</span> 작업 #<span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">31</span> 프로세서 <span class="token operator">-</span> 작업 #<span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">33</span> 지정된 작업 시간 초과
</code></pre></div><ul><li>runner.New 로 새로운 타임아웃을 설정해주고, Runner 포인터 함수를 리턴받는다.</li> <li>생성된 r에 타임아웃을 발생시킬 테스크를 3개 넣어준다.</li> <li>이후에 돌려서 에러 타입에 따라 os 를 멈추게 한다.</li></ul> <h2 id="_2-풀링"><a href="#_2-풀링" class="header-anchor">#</a> 2. 풀링</h2> <ul><li>pool 패키지는 버퍼가 있는 채널을 이용하여 공유가 가능한 리소스의 풀을 생성하고, 이 리소스들을 원하는 개수만큼의 고루틴에서 개별적으로 활용할 수 있는 기능이 있다.</li> <li>이 패턴은 데이터베이스 연결이나 메모리 버퍼 등 공유되는 리소스의 정적인 집합을 관리할 때 유용하다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> pool

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Pool 구조체는 여러 개의 고루틴에서 안전하게 공유하기 위한 리소스 집합 관리</span>
<span class="token comment">// 이 풀에서 관리하기 위한 리소스는 io.Closer 인터페이스를 반드시 구현해야한다.</span>
<span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	m sync<span class="token punctuation">.</span>Mutex
	resources <span class="token keyword">chan</span> io<span class="token punctuation">.</span>Closer
	factory <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	closed <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token comment">// ErrPoolClosed 에러는 리소스를 획득하려 할 때 풀이 닫혀 있는 경우에 발생</span>
<span class="token keyword">var</span> ErrPoolClosed <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;풀이 닫혔습니다.&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// New 함수는 리소스 관리 풀 생성</span>
<span class="token comment">// 풀은 새로운 리소스를 할당하기 위한 함수와 풀의 크기를 매개변수로 정의</span>
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Pool<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">if</span> size <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;풀의 크기가 너무 작습니다.&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Pool<span class="token punctuation">{</span>
		factory<span class="token punctuation">:</span> fn<span class="token punctuation">,</span>
		resources<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// 풀에서 리소스를 획득하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 사용 가능한 리소스가 있는지 확인</span>
	<span class="token keyword">case</span> r<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> p<span class="token punctuation">.</span>resources<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 획득:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;공유된 리소스&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> ErrPoolClosed
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> r<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token comment">// 사용 가능한 리소스가 없으면 새로운 리소스 생성</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 획득:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;새로운 리소스&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 풀에 리소스를 반환하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Release</span><span class="token punctuation">(</span>r io<span class="token punctuation">.</span>Closer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 안전한 작업을 위해 잠금 설정</span>
	p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 풀이 닫혔으면 리소스 해제</span>
	<span class="token keyword">if</span> p<span class="token punctuation">.</span>closed <span class="token punctuation">{</span>
		r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 새로운 리소스를 큐에 추가</span>
	<span class="token keyword">case</span> p<span class="token punctuation">.</span>resources <span class="token operator">&lt;-</span> r<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 반환:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;리소스 큐에 반환&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// 리소스 큐가 가득 찬 경우 리소스를 해제</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 반환:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;리소스 해제&quot;</span><span class="token punctuation">)</span>
		r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 풀을 종료하고 생섣ㅇ된 모든 리소스를 해제하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 안전한 작업을 위해 잠금 설정</span>
	p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 풀이 이미 닫혔으면 암것도 안함</span>
	<span class="token keyword">if</span> p<span class="token punctuation">.</span>closed <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 풀을 닫힌 상태로 전환</span>
	p<span class="token punctuation">.</span>closed <span class="token operator">=</span> <span class="token boolean">true</span>

	<span class="token comment">// 리소스 해제 전에 채널을 닫는다.</span>
	<span class="token comment">// 데드락 걸릴 가능성이 있으므로</span>
	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>resources<span class="token punctuation">)</span>

	<span class="token comment">// 리소스 해지</span>
	<span class="token keyword">for</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>resources <span class="token punctuation">{</span>
		r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>구조체를 잘 살펴봐야 한다.</li> <li>뮤텍스를 쓰기위한 필드와 io.Closer 타입의 채널, 새로운 리소스를 생성하는 함수형 factory와 closed유무형 bool값이 있다.</li> <li>기본적으로 이 패키지가 무엇을 하는지 구조체로 대부분 파악이 가능하다.</li> <li>소스레벨에서 주석을 보고 전체적인 파악이 필요. 크게 별거없긴하다.</li> <li>(io.Closer, error) 이 형태의 반환값을 잘 파악할 필요가 있음</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter7/pool&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;sync/atomic&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	maxGroutines <span class="token operator">=</span> <span class="token number">25</span>
	pooledResources <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment">// 공유 자원을 표현한 구조체</span>
<span class="token keyword">type</span> dbConnection <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID <span class="token builtin">int32</span>
<span class="token punctuation">}</span>

<span class="token comment">// dbConnection이 Pool에 의해 관리될 수 있도록 io.Closer 인터페이스 구현</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>dbConn <span class="token operator">*</span>dbConnection<span class="token punctuation">)</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;닫힘 : 데이터베이스 연결&quot;</span><span class="token punctuation">,</span> dbConn<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// 각 데이터베이스에 유일한 id를 할당하기 위한 변수</span>
<span class="token keyword">var</span> idCounter <span class="token builtin">int32</span>

<span class="token comment">// 풀이 새로운 리소스가 필요할 때 호출할 팩토리 메소드</span>
<span class="token keyword">func</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	id <span class="token operator">:=</span> atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>idCounter<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;생성 : 새 데이터베이스 연결&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>dbConnection<span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>maxGroutines<span class="token punctuation">)</span>

	<span class="token comment">// 데이터베이스 연결을 관리할 풀을 생성</span>
	p<span class="token punctuation">,</span> err <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>createConnection<span class="token punctuation">,</span> pooledResources<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 풀에서 데이터베이스 연결을 가져와 쿼리 실행</span>
	<span class="token keyword">for</span> query <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> query <span class="token operator">&lt;</span> maxGroutines<span class="token punctuation">;</span> query<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// 각 고루틴에는 질의 값의 복사본을 전달</span>
		<span class="token comment">// 그렇지 않으면 고루틴들이 동일한 쿼리값을 공유</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>q <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">performQueries</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 풀을 닫는다.</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;프로그램 종료&quot;</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">performQueries</span><span class="token punctuation">(</span>query <span class="token builtin">int</span><span class="token punctuation">,</span> p <span class="token operator">*</span>pool<span class="token punctuation">.</span>Pool<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 풀에서 데이터베이스 연결 리소스 획득</span>
	conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">Acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 데이터베이스 연결 리소스를 다시 풀로 되돌린다.</span>
	<span class="token keyword">defer</span> p<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>

	<span class="token comment">// 질의문이 실행되는 것처럼 얼마 동안 대기한다.</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;질의: QID[%d] CID[%d]\n&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> conn<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>dbConnection<span class="token punctuation">)</span><span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

결과 <span class="token punctuation">:</span> 
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">3</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">4</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">5</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">6</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">7</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">8</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">9</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">10</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">11</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">12</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">13</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">14</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">15</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">16</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">17</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">18</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">19</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">20</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">21</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">22</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">23</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">24</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">25</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 큐에 반환
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 큐에 반환
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">6</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">15</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">21</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">14</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">18</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">20</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">17</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">11</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">7</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">8</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">19</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">10</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">23</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">22</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">13</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">24</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">9</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">12</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">16</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">4</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">3</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 프로그램 종료
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">25</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">5</span>
</code></pre></div><ul><li>dbConnection 구조체를 선언하고, io.Closer 인터페이스를 구현했다.</li> <li>dbConnection 타입은 데이터베이스 연결을 관리하는 구조체를 흉내낸 것이고, ID값 할당만 가능하다.</li> <li>Close 메소드는 단순히 닫힌걸 ID번호를 매겨서 보여준다.</li> <li>createConnection을 통해 ID 값을 올려주고, dbConnection 주소값을 리턴한다</li> <li>이후에 새로운 풀을 만들고, 고루틴 수만큼 쿼리를 돌린다</li> <li>쿼리 실행 함수는 Acquire과 Release를 통해 리소스를 관리해준다.</li> <li>DB Connection Pool에 관한 기초 지식 필요할듯 보인다..</li></ul> <h2 id="_3-work-패키지"><a href="#_3-work-패키지" class="header-anchor">#</a> 3. work 패키지</h2> <ul><li>work 패키지의 목적은 버퍼가 없는 채널을 이용하여 원하는 개수만큼의 작업을 동시적으로 실행할 수 있는 고루틴 풀을 생성하는 것</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> work

<span class="token keyword">import</span> <span class="token string">&quot;sync&quot;</span>

<span class="token comment">// 작업 풀을 사용하려는 타입은 Worker 인터페이스를 구현해야 한다.</span>
<span class="token keyword">type</span> Worker <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Worker인터페이스를 실행하는 고루틴의 풀을 제공하기 위한 Pool 구조체</span>
<span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	work <span class="token keyword">chan</span> Worker
	wg sync<span class="token punctuation">.</span>WaitGroup
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>maxGoroutines <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Pool  <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> Pool<span class="token punctuation">{</span>
		work <span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Worker<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>maxGoroutines<span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxGoroutines<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> w <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>work <span class="token punctuation">{</span>
				w<span class="token punctuation">.</span><span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token operator">&amp;</span>p
<span class="token punctuation">}</span>

<span class="token comment">// 풀에 새로운 작업을 추가하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>w Worker<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	p<span class="token punctuation">.</span>work <span class="token operator">&lt;-</span> w
<span class="token punctuation">}</span>

<span class="token comment">// 모든 고루틴이 종료할 때까지 대기하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>work<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Work 인터페이스는 Task라는 하나의 메소드를 정의한다.</li> <li>Pool 구조체는 Worker 인터페이스 타입 채널을 필드로 정의한다.</li> <li>팩토리 함수인 New 함수는 파라미터로 받은 고루틴최대수만큼 고루틴을 생성하고 작업을 진행한다.</li> <li>Worker 채널을 만들 때, 버퍼가 없는 채널 형태로 만들어준다.</li> <li>work 채널이 닫힐 때까지 for loop을 돌면서, 작업을 진행한다. -&gt; work채널에서 Worker 인터페이스를 계속 받으면 계속 Task를 호출한다.</li> <li>Run / Shutdown 으로 워커 추가 및 풀 중단을 진행한다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter7/work&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;time&quot;</span>
	<span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 화면에 출력할 이름들을 슬라이스로 선언</span>
<span class="token keyword">var</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
	<span class="token string">&quot;ted&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;sunny&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;cindy&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;jade&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;liam&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> namePrinter <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>namePrinter<span class="token punctuation">)</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> work<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token function">len</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// 이름 슬라이스르 반복</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> name <span class="token operator">:=</span> <span class="token keyword">range</span> names <span class="token punctuation">{</span>
			<span class="token comment">// namePrinter 변수를 선언하고 이름을 지정</span>
			np <span class="token operator">:=</span> namePrinter<span class="token punctuation">{</span>
				name <span class="token punctuation">:</span> name<span class="token punctuation">,</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 실행할 작업 등록</span>
				<span class="token comment">// Run 메소드가 리턴되면 해당 작업이 처리된 걸로 간주</span>
				p<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>np<span class="token punctuation">)</span>

				wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 작업 풀을 종료하고 이미 등록된 작업들이 종료될 때까지 대기</span>
	p<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 소스로 보면, 결국 work 패키지에서 Run 함수에서 p.work &lt;- w 을 통해, 일을 줄 때부터 for loop 안의 Task가 실행된다.</li> <li>wg.Add 100 을 해줘서, names 슬라이스에 저장된 각 이름을 출력할 고루틴 100개의 경쟁상태를 모의로 만든다.</li> <li>p.Run을 통해 namePrinter 값을 풀에 등록한다.</li> <li>메인 함수에서 그 짓을 100번을 돌려서 총 500개의 고루틴이 실행된다.</li></ul> <h2 id="_4-요약"><a href="#_4-요약" class="header-anchor">#</a> 4. 요약</h2> <ul><li>채널을 이용해 어플리케이션의 수명주기를 관리할 수 있다.</li> <li>default 구문이 선언된 select 구무은 채널에 논블로킹 형식으로 값을 보내거나 받을 수 있다.</li> <li>버퍼가 있는 채널은 재사용 가능한 리소스 풀을 관리하는데 사용할 수 있다.</li> <li>채널의 동기화는 런타임에 의해 자동으로 관리된다.</li> <li>고루틴의 풀이 필요할 때는 버퍼가 없는 채널을 활용하는편이 더 낫다.</li> <li>두 개의 고루틴 간에 데이터를 교환할 때 버퍼가 없는 채널을 이용하면 데이터 교환이 반드시 이루어지는 것을 보장할 수 있다.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/go-in-action/06.html" class="prev">6장 동시성</a></span> <span class="next"><a href="/study-collection/book/go-in-action/08.html">8장 표준 라이브러리</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.8d405e77.js" defer></script><script src="/study-collection/assets/js/2.a40cbc6e.js" defer></script><script src="/study-collection/assets/js/116.91a1670e.js" defer></script>
  </body>
</html>
