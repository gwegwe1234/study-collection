<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.69cdfe8d.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.37c06816.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.afa7b4ef.js" as="script"><link rel="preload" href="/study-collection/assets/js/117.6dceea18.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.6c549232.js"><link rel="prefetch" href="/study-collection/assets/js/100.8cbc3f0a.js"><link rel="prefetch" href="/study-collection/assets/js/101.b3cd5a6e.js"><link rel="prefetch" href="/study-collection/assets/js/102.82085b77.js"><link rel="prefetch" href="/study-collection/assets/js/103.5927747a.js"><link rel="prefetch" href="/study-collection/assets/js/104.2a133723.js"><link rel="prefetch" href="/study-collection/assets/js/105.17214439.js"><link rel="prefetch" href="/study-collection/assets/js/106.78e2d039.js"><link rel="prefetch" href="/study-collection/assets/js/107.515a3df1.js"><link rel="prefetch" href="/study-collection/assets/js/108.d2cb104c.js"><link rel="prefetch" href="/study-collection/assets/js/109.574d42a1.js"><link rel="prefetch" href="/study-collection/assets/js/11.148b5053.js"><link rel="prefetch" href="/study-collection/assets/js/110.8a9b7ab0.js"><link rel="prefetch" href="/study-collection/assets/js/111.b6226e46.js"><link rel="prefetch" href="/study-collection/assets/js/112.1dbd3a2b.js"><link rel="prefetch" href="/study-collection/assets/js/113.c32ce187.js"><link rel="prefetch" href="/study-collection/assets/js/114.c28ac65f.js"><link rel="prefetch" href="/study-collection/assets/js/115.20e8ba55.js"><link rel="prefetch" href="/study-collection/assets/js/116.64d5f953.js"><link rel="prefetch" href="/study-collection/assets/js/118.e83deda2.js"><link rel="prefetch" href="/study-collection/assets/js/119.a6d7e7a2.js"><link rel="prefetch" href="/study-collection/assets/js/12.024d5d7f.js"><link rel="prefetch" href="/study-collection/assets/js/120.d3cdee82.js"><link rel="prefetch" href="/study-collection/assets/js/121.aafefa2b.js"><link rel="prefetch" href="/study-collection/assets/js/122.5ab5d96f.js"><link rel="prefetch" href="/study-collection/assets/js/123.463584f0.js"><link rel="prefetch" href="/study-collection/assets/js/124.0cfd9970.js"><link rel="prefetch" href="/study-collection/assets/js/125.f4ed90dc.js"><link rel="prefetch" href="/study-collection/assets/js/126.3b5c3889.js"><link rel="prefetch" href="/study-collection/assets/js/127.5421580b.js"><link rel="prefetch" href="/study-collection/assets/js/128.081e284d.js"><link rel="prefetch" href="/study-collection/assets/js/129.cdff2f83.js"><link rel="prefetch" href="/study-collection/assets/js/13.2fec634e.js"><link rel="prefetch" href="/study-collection/assets/js/130.7fb3acd4.js"><link rel="prefetch" href="/study-collection/assets/js/131.9a14807e.js"><link rel="prefetch" href="/study-collection/assets/js/132.d54319ec.js"><link rel="prefetch" href="/study-collection/assets/js/133.3d7096be.js"><link rel="prefetch" href="/study-collection/assets/js/134.d5ddd4a4.js"><link rel="prefetch" href="/study-collection/assets/js/135.f8c88094.js"><link rel="prefetch" href="/study-collection/assets/js/136.a9ae3673.js"><link rel="prefetch" href="/study-collection/assets/js/137.49779f7f.js"><link rel="prefetch" href="/study-collection/assets/js/138.ae75cb73.js"><link rel="prefetch" href="/study-collection/assets/js/139.a6befbdb.js"><link rel="prefetch" href="/study-collection/assets/js/14.d200675f.js"><link rel="prefetch" href="/study-collection/assets/js/140.773afdfc.js"><link rel="prefetch" href="/study-collection/assets/js/141.3f02357d.js"><link rel="prefetch" href="/study-collection/assets/js/142.456d5beb.js"><link rel="prefetch" href="/study-collection/assets/js/143.5ff99544.js"><link rel="prefetch" href="/study-collection/assets/js/144.546f2f4a.js"><link rel="prefetch" href="/study-collection/assets/js/145.786936d7.js"><link rel="prefetch" href="/study-collection/assets/js/146.94812190.js"><link rel="prefetch" href="/study-collection/assets/js/147.fbced3d0.js"><link rel="prefetch" href="/study-collection/assets/js/148.a1019209.js"><link rel="prefetch" href="/study-collection/assets/js/149.8c7e9116.js"><link rel="prefetch" href="/study-collection/assets/js/15.1b60e24c.js"><link rel="prefetch" href="/study-collection/assets/js/150.0b33cc01.js"><link rel="prefetch" href="/study-collection/assets/js/151.9c40f54d.js"><link rel="prefetch" href="/study-collection/assets/js/152.4f3bb2ea.js"><link rel="prefetch" href="/study-collection/assets/js/153.1bf0639e.js"><link rel="prefetch" href="/study-collection/assets/js/154.a95a7364.js"><link rel="prefetch" href="/study-collection/assets/js/155.60511153.js"><link rel="prefetch" href="/study-collection/assets/js/156.22dbea8d.js"><link rel="prefetch" href="/study-collection/assets/js/157.1870ba28.js"><link rel="prefetch" href="/study-collection/assets/js/158.b45d2083.js"><link rel="prefetch" href="/study-collection/assets/js/159.2fccf961.js"><link rel="prefetch" href="/study-collection/assets/js/16.0c2734f3.js"><link rel="prefetch" href="/study-collection/assets/js/160.7637f5fd.js"><link rel="prefetch" href="/study-collection/assets/js/161.14f9c4e9.js"><link rel="prefetch" href="/study-collection/assets/js/162.6eceef24.js"><link rel="prefetch" href="/study-collection/assets/js/163.78db5bc6.js"><link rel="prefetch" href="/study-collection/assets/js/164.ff3867b0.js"><link rel="prefetch" href="/study-collection/assets/js/165.112c0273.js"><link rel="prefetch" href="/study-collection/assets/js/166.14e0a867.js"><link rel="prefetch" href="/study-collection/assets/js/167.4399d7a2.js"><link rel="prefetch" href="/study-collection/assets/js/168.be7c5ca0.js"><link rel="prefetch" href="/study-collection/assets/js/169.450d9b27.js"><link rel="prefetch" href="/study-collection/assets/js/17.66cb5932.js"><link rel="prefetch" href="/study-collection/assets/js/170.a66c9e60.js"><link rel="prefetch" href="/study-collection/assets/js/18.4574d197.js"><link rel="prefetch" href="/study-collection/assets/js/19.b7707108.js"><link rel="prefetch" href="/study-collection/assets/js/20.13e831d4.js"><link rel="prefetch" href="/study-collection/assets/js/21.7431d6af.js"><link rel="prefetch" href="/study-collection/assets/js/22.40fa5045.js"><link rel="prefetch" href="/study-collection/assets/js/23.85ef1532.js"><link rel="prefetch" href="/study-collection/assets/js/24.454fdb14.js"><link rel="prefetch" href="/study-collection/assets/js/25.e95d89d4.js"><link rel="prefetch" href="/study-collection/assets/js/26.0bd526d5.js"><link rel="prefetch" href="/study-collection/assets/js/27.eb97134b.js"><link rel="prefetch" href="/study-collection/assets/js/28.0e82b779.js"><link rel="prefetch" href="/study-collection/assets/js/29.1dfffb79.js"><link rel="prefetch" href="/study-collection/assets/js/3.584700a6.js"><link rel="prefetch" href="/study-collection/assets/js/30.cea58b2e.js"><link rel="prefetch" href="/study-collection/assets/js/31.15ad379f.js"><link rel="prefetch" href="/study-collection/assets/js/32.63aa356f.js"><link rel="prefetch" href="/study-collection/assets/js/33.282d1d9a.js"><link rel="prefetch" href="/study-collection/assets/js/34.e7051812.js"><link rel="prefetch" href="/study-collection/assets/js/35.0dda515e.js"><link rel="prefetch" href="/study-collection/assets/js/36.b9d45043.js"><link rel="prefetch" href="/study-collection/assets/js/37.f43ddc42.js"><link rel="prefetch" href="/study-collection/assets/js/38.b1095e07.js"><link rel="prefetch" href="/study-collection/assets/js/39.67a8470b.js"><link rel="prefetch" href="/study-collection/assets/js/4.be5497f9.js"><link rel="prefetch" href="/study-collection/assets/js/40.12724e8a.js"><link rel="prefetch" href="/study-collection/assets/js/41.9689db66.js"><link rel="prefetch" href="/study-collection/assets/js/42.a6176edf.js"><link rel="prefetch" href="/study-collection/assets/js/43.3533b4fb.js"><link rel="prefetch" href="/study-collection/assets/js/44.92fa00a0.js"><link rel="prefetch" href="/study-collection/assets/js/45.0d99d7ab.js"><link rel="prefetch" href="/study-collection/assets/js/46.882cfaef.js"><link rel="prefetch" href="/study-collection/assets/js/47.b4ccb5e8.js"><link rel="prefetch" href="/study-collection/assets/js/48.8322cd7b.js"><link rel="prefetch" href="/study-collection/assets/js/49.26b9f5cd.js"><link rel="prefetch" href="/study-collection/assets/js/5.837221ea.js"><link rel="prefetch" href="/study-collection/assets/js/50.98f469e2.js"><link rel="prefetch" href="/study-collection/assets/js/51.aab567ca.js"><link rel="prefetch" href="/study-collection/assets/js/52.a8f04ca7.js"><link rel="prefetch" href="/study-collection/assets/js/53.282593fc.js"><link rel="prefetch" href="/study-collection/assets/js/54.92d45c54.js"><link rel="prefetch" href="/study-collection/assets/js/55.eb6df0bb.js"><link rel="prefetch" href="/study-collection/assets/js/56.804b4fdc.js"><link rel="prefetch" href="/study-collection/assets/js/57.85b71dcb.js"><link rel="prefetch" href="/study-collection/assets/js/58.fdef9ba1.js"><link rel="prefetch" href="/study-collection/assets/js/59.56d703c8.js"><link rel="prefetch" href="/study-collection/assets/js/6.298f803b.js"><link rel="prefetch" href="/study-collection/assets/js/60.fa5b4f5f.js"><link rel="prefetch" href="/study-collection/assets/js/61.1a75f470.js"><link rel="prefetch" href="/study-collection/assets/js/62.d78c44c8.js"><link rel="prefetch" href="/study-collection/assets/js/63.d2c5892c.js"><link rel="prefetch" href="/study-collection/assets/js/64.4e4f0046.js"><link rel="prefetch" href="/study-collection/assets/js/65.60aa88db.js"><link rel="prefetch" href="/study-collection/assets/js/66.6f39bcf3.js"><link rel="prefetch" href="/study-collection/assets/js/67.4d8f9991.js"><link rel="prefetch" href="/study-collection/assets/js/68.35708962.js"><link rel="prefetch" href="/study-collection/assets/js/69.e4bc0963.js"><link rel="prefetch" href="/study-collection/assets/js/7.cc164300.js"><link rel="prefetch" href="/study-collection/assets/js/70.7c714082.js"><link rel="prefetch" href="/study-collection/assets/js/71.9724501d.js"><link rel="prefetch" href="/study-collection/assets/js/72.b29d6477.js"><link rel="prefetch" href="/study-collection/assets/js/73.ded9c32e.js"><link rel="prefetch" href="/study-collection/assets/js/74.f5b65a09.js"><link rel="prefetch" href="/study-collection/assets/js/75.fa8fcc58.js"><link rel="prefetch" href="/study-collection/assets/js/76.e5ca98bb.js"><link rel="prefetch" href="/study-collection/assets/js/77.77234a27.js"><link rel="prefetch" href="/study-collection/assets/js/78.4bb8b5af.js"><link rel="prefetch" href="/study-collection/assets/js/79.338b7bf0.js"><link rel="prefetch" href="/study-collection/assets/js/8.1aff3fd6.js"><link rel="prefetch" href="/study-collection/assets/js/80.c6597cb9.js"><link rel="prefetch" href="/study-collection/assets/js/81.a215c63f.js"><link rel="prefetch" href="/study-collection/assets/js/82.f49ca59c.js"><link rel="prefetch" href="/study-collection/assets/js/83.f2c06af8.js"><link rel="prefetch" href="/study-collection/assets/js/84.d93f5335.js"><link rel="prefetch" href="/study-collection/assets/js/85.c0d1c3ed.js"><link rel="prefetch" href="/study-collection/assets/js/86.d8ee38f3.js"><link rel="prefetch" href="/study-collection/assets/js/87.72df363e.js"><link rel="prefetch" href="/study-collection/assets/js/88.17f1ebef.js"><link rel="prefetch" href="/study-collection/assets/js/89.a66d9cab.js"><link rel="prefetch" href="/study-collection/assets/js/9.55bb1db3.js"><link rel="prefetch" href="/study-collection/assets/js/90.c1c076f4.js"><link rel="prefetch" href="/study-collection/assets/js/91.c4243ab1.js"><link rel="prefetch" href="/study-collection/assets/js/92.d8a63f2e.js"><link rel="prefetch" href="/study-collection/assets/js/93.79133e29.js"><link rel="prefetch" href="/study-collection/assets/js/94.d4e3c077.js"><link rel="prefetch" href="/study-collection/assets/js/95.cc98c099.js"><link rel="prefetch" href="/study-collection/assets/js/96.74ac8ce4.js"><link rel="prefetch" href="/study-collection/assets/js/97.5e211715.js"><link rel="prefetch" href="/study-collection/assets/js/98.de97098f.js"><link rel="prefetch" href="/study-collection/assets/js/99.3c3b3f30.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.69cdfe8d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>TDD By Example</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>고 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/go-in-action/01.html" class="sidebar-link">1장 Go와의 첫 만남</a></li><li><a href="/study-collection/book/go-in-action/02.html" class="sidebar-link">2장 Go 간단히 살펴보기</a></li><li><a href="/study-collection/book/go-in-action/03.html" class="sidebar-link">3장 패키징과 내장 도구들</a></li><li><a href="/study-collection/book/go-in-action/04.html" class="sidebar-link">4장 배열, 슬라이스, 맵</a></li><li><a href="/study-collection/book/go-in-action/05.html" class="sidebar-link">5장 Go의 타입 시스템</a></li><li><a href="/study-collection/book/go-in-action/06.html" class="sidebar-link">6장 동시성</a></li><li><a href="/study-collection/book/go-in-action/07.html" class="active sidebar-link">7장 동시성 패턴</a></li><li><a href="/study-collection/book/go-in-action/08.html" class="sidebar-link">8장 표준 라이브러리</a></li><li><a href="/study-collection/book/go-in-action/09.html" class="sidebar-link">9장 테스트와 벤치마킹</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Go 언어를 활용한 마이크로서비스 개발</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>카프카 스트림즈 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>모던 자바 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>객체지향의 사실과 오해</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>뇌를 자극하는 윈도우즈 시스템 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>스프링5를 활용한 리액티브 프로그래밍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>코틀린 완벽 가드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>코틀린 완벽 가드</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>끄적끄적</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_7강"><a href="#_7강" class="header-anchor">#</a> 7강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-runner-패키지">1. Runner 패키지</a></li><li><a href="#_2-풀링">2. 풀링</a></li><li><a href="#_3-work-패키지">3. work 패키지</a></li><li><a href="#_4-요약">4. 요약</a></li></ul></div><p></p> <h2 id="_1-runner-패키지"><a href="#_1-runner-패키지" class="header-anchor">#</a> 1. Runner 패키지</h2> <ul><li>runner 패키지의 목적은 채널을 이용해 프로그램의 실행 시간을 관찰하고 프로그램이 너무 오래 실행되면 종료하는 것</li> <li>runner 패키지에 작성된 runnger.go 파일</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 가브리엘 애자로스(Gabriel Aszalos)가 도움을 준 예제</span>
<span class="token comment">// runner 패키지는 프로세스의 실행 및 수명주기를 관리한다.</span>
<span class="token keyword">package</span> runner

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;os/signal&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Runner 타입은 주어진 타임아웃 시간 동안 일련의 작업을 수행한다.</span>
<span class="token comment">// 그리고 운영체제 인터럽트에 의해 실행이 종료된다.</span>
<span class="token keyword">type</span> Runner <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// 운영체제로부터 전달되는 인터럽트 신호를</span>
	<span class="token comment">// 수신하기 위한 채널</span>
	interrupt <span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal

	<span class="token comment">// 처리가 종료되었음을 알리기 위한 채널</span>
	complete <span class="token keyword">chan</span> <span class="token builtin">error</span>

	<span class="token comment">// 지정된 시간이 초과했음을 알리기 위한 채널</span>
	timeout <span class="token operator">&lt;-</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time

	<span class="token comment">// 인덱스 순서로 처리될 작업의 목록을</span>
	<span class="token comment">// 저장하기 위한 슬라이스</span>
	tasks <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// timeout 채널에서 값을 수신하면 ErrTimeout을 리턴한다.</span>
<span class="token keyword">var</span> ErrTimeout <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;시간을 초과했습니다.&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 운영체제 이벤트를 수신하면 ErrInterrupt를 리턴한다.</span>
<span class="token keyword">var</span> ErrInterrupt <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;운영체제 인터럽트 신호를 수신했습니다.&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 실행할 Runner 타입 값을 리턴하는 함수</span>
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">*</span>Runner <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Runner<span class="token punctuation">{</span>
		interrupt<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		complete<span class="token punctuation">:</span>  <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		timeout<span class="token punctuation">:</span>   time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Runner 타입에 작업을 추가하는 메서드</span>
<span class="token comment">// 작업은 int형 ID를 매개변수로 전달받는 함수이다.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>tasks <span class="token operator">...</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r<span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>tasks<span class="token punctuation">,</span> tasks<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 저장된 모든 작업을 실행하고 채널 이벤트를 관찰한다.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token comment">// 모든 종류의 인터럽트 신호를 수신한다.</span>
	signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>interrupt<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Interrupt<span class="token punctuation">)</span>

	<span class="token comment">// 각각의 작업을 각기 다른 고루틴을 통해 실행한다.</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		r<span class="token punctuation">.</span>complete <span class="token operator">&lt;-</span> r<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 작업 완료 신호를 수신한 경우</span>
	<span class="token keyword">case</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>r<span class="token punctuation">.</span>complete<span class="token punctuation">:</span>
		<span class="token keyword">return</span> err

	<span class="token comment">// 작업 시간 초과 신호를 수신한 경우</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>r<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
		<span class="token keyword">return</span> ErrTimeout
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 개별 작업을 실행하는 메서드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> id<span class="token punctuation">,</span> task <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>tasks <span class="token punctuation">{</span>
		<span class="token comment">// OS로부터 인터럽트 신호를 수신했는지 확인한다.</span>
		<span class="token keyword">if</span> r<span class="token punctuation">.</span><span class="token function">gotInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> ErrInterrupt
		<span class="token punctuation">}</span>

		<span class="token comment">// 작업을 실행한다.</span>
		<span class="token function">task</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// 인터럽트 신호가 수신되었는지 확인하는 메서드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Runner<span class="token punctuation">)</span> <span class="token function">gotInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 인터럽트 이벤트가 발생한 경우</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>r<span class="token punctuation">.</span>interrupt<span class="token punctuation">:</span>
		<span class="token comment">// 이후에 발생하는 인터럽트 신호를 더 이상 수신하지 않도록 한다.</span>
		signal<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>interrupt<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>

	<span class="token comment">// 작업을 계속해서 실행하게 한다.</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 예제는 예약 설정에 따라 실행되는 작업 위주의 프로그램을 작성한 코드</li> <li>위 프로그램이 종료되는 경우는 다음과 같다
<ul><li>지정된 시간 동안 작업을 모두 처리하면 자연스럽게 종료</li> <li>프로그램이 제 시간에 작업을 완료하지 못하면 종료</li> <li>운영체제로부터 인터럽트 신호가 발생하면 종료하기 위해 시도</li></ul></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter7/runner&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> timeout  <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;작업을 시작합니다&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// 실행 시간을 이용해 새로운 작업 실행기 생성</span>
	r <span class="token operator">:=</span> runner<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>

	<span class="token comment">// 수행할 작업 등록</span>
	r<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// 작업을 실행하고 결과를 처리</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">switch</span> err <span class="token punctuation">{</span>
		<span class="token keyword">case</span> runner<span class="token punctuation">.</span>ErrTimeout<span class="token punctuation">:</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;지정된 작업 시간 초과&quot;</span><span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> runner<span class="token punctuation">.</span>ErrInterrupt<span class="token punctuation">:</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;운영체제 인터럽트 발생&quot;</span><span class="token punctuation">)</span>
			os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;프로그램 종료&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 지정된 시간동안 암것도 안하는 예제를 위한 생성함수</span>
<span class="token keyword">func</span> <span class="token function">createTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;프로세서 - 작업 #%d&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">30</span> 작업을 시작합니다
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">30</span> 프로세서 <span class="token operator">-</span> 작업 #<span class="token number">0</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">30</span> 프로세서 <span class="token operator">-</span> 작업 #<span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">31</span> 프로세서 <span class="token operator">-</span> 작업 #<span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">19</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">33</span> 지정된 작업 시간 초과
</code></pre></div><ul><li>runner.New 로 새로운 타임아웃을 설정해주고, Runner 포인터 함수를 리턴받는다.</li> <li>생성된 r에 타임아웃을 발생시킬 테스크를 3개 넣어준다.</li> <li>이후에 돌려서 에러 타입에 따라 os 를 멈추게 한다.</li></ul> <h2 id="_2-풀링"><a href="#_2-풀링" class="header-anchor">#</a> 2. 풀링</h2> <ul><li>pool 패키지는 버퍼가 있는 채널을 이용하여 공유가 가능한 리소스의 풀을 생성하고, 이 리소스들을 원하는 개수만큼의 고루틴에서 개별적으로 활용할 수 있는 기능이 있다.</li> <li>이 패턴은 데이터베이스 연결이나 메모리 버퍼 등 공유되는 리소스의 정적인 집합을 관리할 때 유용하다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> pool

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Pool 구조체는 여러 개의 고루틴에서 안전하게 공유하기 위한 리소스 집합 관리</span>
<span class="token comment">// 이 풀에서 관리하기 위한 리소스는 io.Closer 인터페이스를 반드시 구현해야한다.</span>
<span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	m sync<span class="token punctuation">.</span>Mutex
	resources <span class="token keyword">chan</span> io<span class="token punctuation">.</span>Closer
	factory <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	closed <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token comment">// ErrPoolClosed 에러는 리소스를 획득하려 할 때 풀이 닫혀 있는 경우에 발생</span>
<span class="token keyword">var</span> ErrPoolClosed <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;풀이 닫혔습니다.&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// New 함수는 리소스 관리 풀 생성</span>
<span class="token comment">// 풀은 새로운 리소스를 할당하기 위한 함수와 풀의 크기를 매개변수로 정의</span>
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Pool<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">if</span> size <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;풀의 크기가 너무 작습니다.&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Pool<span class="token punctuation">{</span>
		factory<span class="token punctuation">:</span> fn<span class="token punctuation">,</span>
		resources<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// 풀에서 리소스를 획득하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 사용 가능한 리소스가 있는지 확인</span>
	<span class="token keyword">case</span> r<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> p<span class="token punctuation">.</span>resources<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 획득:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;공유된 리소스&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> ErrPoolClosed
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> r<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token comment">// 사용 가능한 리소스가 없으면 새로운 리소스 생성</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 획득:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;새로운 리소스&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 풀에 리소스를 반환하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Release</span><span class="token punctuation">(</span>r io<span class="token punctuation">.</span>Closer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 안전한 작업을 위해 잠금 설정</span>
	p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 풀이 닫혔으면 리소스 해제</span>
	<span class="token keyword">if</span> p<span class="token punctuation">.</span>closed <span class="token punctuation">{</span>
		r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token comment">// 새로운 리소스를 큐에 추가</span>
	<span class="token keyword">case</span> p<span class="token punctuation">.</span>resources <span class="token operator">&lt;-</span> r<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 반환:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;리소스 큐에 반환&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// 리소스 큐가 가득 찬 경우 리소스를 해제</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;리소스 반환:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;리소스 해제&quot;</span><span class="token punctuation">)</span>
		r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 풀을 종료하고 생섣ㅇ된 모든 리소스를 해제하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 안전한 작업을 위해 잠금 설정</span>
	p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> p<span class="token punctuation">.</span>m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 풀이 이미 닫혔으면 암것도 안함</span>
	<span class="token keyword">if</span> p<span class="token punctuation">.</span>closed <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 풀을 닫힌 상태로 전환</span>
	p<span class="token punctuation">.</span>closed <span class="token operator">=</span> <span class="token boolean">true</span>

	<span class="token comment">// 리소스 해제 전에 채널을 닫는다.</span>
	<span class="token comment">// 데드락 걸릴 가능성이 있으므로</span>
	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>resources<span class="token punctuation">)</span>

	<span class="token comment">// 리소스 해지</span>
	<span class="token keyword">for</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>resources <span class="token punctuation">{</span>
		r<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>구조체를 잘 살펴봐야 한다.</li> <li>뮤텍스를 쓰기위한 필드와 io.Closer 타입의 채널, 새로운 리소스를 생성하는 함수형 factory와 closed유무형 bool값이 있다.</li> <li>기본적으로 이 패키지가 무엇을 하는지 구조체로 대부분 파악이 가능하다.</li> <li>소스레벨에서 주석을 보고 전체적인 파악이 필요. 크게 별거없긴하다.</li> <li>(io.Closer, error) 이 형태의 반환값을 잘 파악할 필요가 있음</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter7/pool&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;sync/atomic&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	maxGroutines <span class="token operator">=</span> <span class="token number">25</span>
	pooledResources <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment">// 공유 자원을 표현한 구조체</span>
<span class="token keyword">type</span> dbConnection <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID <span class="token builtin">int32</span>
<span class="token punctuation">}</span>

<span class="token comment">// dbConnection이 Pool에 의해 관리될 수 있도록 io.Closer 인터페이스 구현</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>dbConn <span class="token operator">*</span>dbConnection<span class="token punctuation">)</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;닫힘 : 데이터베이스 연결&quot;</span><span class="token punctuation">,</span> dbConn<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// 각 데이터베이스에 유일한 id를 할당하기 위한 변수</span>
<span class="token keyword">var</span> idCounter <span class="token builtin">int32</span>

<span class="token comment">// 풀이 새로운 리소스가 필요할 때 호출할 팩토리 메소드</span>
<span class="token keyword">func</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>io<span class="token punctuation">.</span>Closer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	id <span class="token operator">:=</span> atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>idCounter<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;생성 : 새 데이터베이스 연결&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>dbConnection<span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>maxGroutines<span class="token punctuation">)</span>

	<span class="token comment">// 데이터베이스 연결을 관리할 풀을 생성</span>
	p<span class="token punctuation">,</span> err <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>createConnection<span class="token punctuation">,</span> pooledResources<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 풀에서 데이터베이스 연결을 가져와 쿼리 실행</span>
	<span class="token keyword">for</span> query <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> query <span class="token operator">&lt;</span> maxGroutines<span class="token punctuation">;</span> query<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// 각 고루틴에는 질의 값의 복사본을 전달</span>
		<span class="token comment">// 그렇지 않으면 고루틴들이 동일한 쿼리값을 공유</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>q <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">performQueries</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
			wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 풀을 닫는다.</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;프로그램 종료&quot;</span><span class="token punctuation">)</span>
	p<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">performQueries</span><span class="token punctuation">(</span>query <span class="token builtin">int</span><span class="token punctuation">,</span> p <span class="token operator">*</span>pool<span class="token punctuation">.</span>Pool<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token comment">// 풀에서 데이터베이스 연결 리소스 획득</span>
	conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span><span class="token function">Acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 데이터베이스 연결 리소스를 다시 풀로 되돌린다.</span>
	<span class="token keyword">defer</span> p<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>

	<span class="token comment">// 질의문이 실행되는 것처럼 얼마 동안 대기한다.</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;질의: QID[%d] CID[%d]\n&quot;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> conn<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>dbConnection<span class="token punctuation">)</span><span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

결과 <span class="token punctuation">:</span> 
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">3</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">4</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">5</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">6</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">7</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">8</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">9</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">10</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">11</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">12</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">13</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">14</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">15</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">16</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">17</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">18</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">19</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">20</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">21</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">22</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">23</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">24</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 획득<span class="token punctuation">:</span> 새로운 리소스
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 생성 <span class="token punctuation">:</span> 새 데이터베이스 연결 <span class="token number">25</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 큐에 반환
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 큐에 반환
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">6</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">2</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">15</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">21</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">14</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">18</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">20</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">1</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">17</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">11</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">7</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">8</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">19</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">10</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">23</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">22</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">13</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">24</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">9</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">12</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">16</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">4</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 질의<span class="token punctuation">:</span> QID<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> CID<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 리소스 반환<span class="token punctuation">:</span> 리소스 해제
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">3</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 프로그램 종료
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">25</span>
<span class="token number">2019</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">27</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">03</span> 닫힘 <span class="token punctuation">:</span> 데이터베이스 연결 <span class="token number">5</span>
</code></pre></div><ul><li>dbConnection 구조체를 선언하고, io.Closer 인터페이스를 구현했다.</li> <li>dbConnection 타입은 데이터베이스 연결을 관리하는 구조체를 흉내낸 것이고, ID값 할당만 가능하다.</li> <li>Close 메소드는 단순히 닫힌걸 ID번호를 매겨서 보여준다.</li> <li>createConnection을 통해 ID 값을 올려주고, dbConnection 주소값을 리턴한다</li> <li>이후에 새로운 풀을 만들고, 고루틴 수만큼 쿼리를 돌린다</li> <li>쿼리 실행 함수는 Acquire과 Release를 통해 리소스를 관리해준다.</li> <li>DB Connection Pool에 관한 기초 지식 필요할듯 보인다..</li></ul> <h2 id="_3-work-패키지"><a href="#_3-work-패키지" class="header-anchor">#</a> 3. work 패키지</h2> <ul><li>work 패키지의 목적은 버퍼가 없는 채널을 이용하여 원하는 개수만큼의 작업을 동시적으로 실행할 수 있는 고루틴 풀을 생성하는 것</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> work

<span class="token keyword">import</span> <span class="token string">&quot;sync&quot;</span>

<span class="token comment">// 작업 풀을 사용하려는 타입은 Worker 인터페이스를 구현해야 한다.</span>
<span class="token keyword">type</span> Worker <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Worker인터페이스를 실행하는 고루틴의 풀을 제공하기 위한 Pool 구조체</span>
<span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	work <span class="token keyword">chan</span> Worker
	wg sync<span class="token punctuation">.</span>WaitGroup
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>maxGoroutines <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Pool  <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> Pool<span class="token punctuation">{</span>
		work <span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Worker<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>maxGoroutines<span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxGoroutines<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> w <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>work <span class="token punctuation">{</span>
				w<span class="token punctuation">.</span><span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token operator">&amp;</span>p
<span class="token punctuation">}</span>

<span class="token comment">// 풀에 새로운 작업을 추가하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>w Worker<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	p<span class="token punctuation">.</span>work <span class="token operator">&lt;-</span> w
<span class="token punctuation">}</span>

<span class="token comment">// 모든 고루틴이 종료할 때까지 대기하는 메소드</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>work<span class="token punctuation">)</span>
	p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Work 인터페이스는 Task라는 하나의 메소드를 정의한다.</li> <li>Pool 구조체는 Worker 인터페이스 타입 채널을 필드로 정의한다.</li> <li>팩토리 함수인 New 함수는 파라미터로 받은 고루틴최대수만큼 고루틴을 생성하고 작업을 진행한다.</li> <li>Worker 채널을 만들 때, 버퍼가 없는 채널 형태로 만들어준다.</li> <li>work 채널이 닫힐 때까지 for loop을 돌면서, 작업을 진행한다. -&gt; work채널에서 Worker 인터페이스를 계속 받으면 계속 Task를 호출한다.</li> <li>Run / Shutdown 으로 워커 추가 및 풀 중단을 진행한다.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/gwegwe1234/go-in-action/chapter7/work&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;time&quot;</span>
	<span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 화면에 출력할 이름들을 슬라이스로 선언</span>
<span class="token keyword">var</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
	<span class="token string">&quot;ted&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;sunny&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;cindy&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;jade&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;liam&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> namePrinter <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>namePrinter<span class="token punctuation">)</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> work<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token function">len</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// 이름 슬라이스르 반복</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> name <span class="token operator">:=</span> <span class="token keyword">range</span> names <span class="token punctuation">{</span>
			<span class="token comment">// namePrinter 변수를 선언하고 이름을 지정</span>
			np <span class="token operator">:=</span> namePrinter<span class="token punctuation">{</span>
				name <span class="token punctuation">:</span> name<span class="token punctuation">,</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 실행할 작업 등록</span>
				<span class="token comment">// Run 메소드가 리턴되면 해당 작업이 처리된 걸로 간주</span>
				p<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>np<span class="token punctuation">)</span>

				wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 작업 풀을 종료하고 이미 등록된 작업들이 종료될 때까지 대기</span>
	p<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위의 소스로 보면, 결국 work 패키지에서 Run 함수에서 p.work &lt;- w 을 통해, 일을 줄 때부터 for loop 안의 Task가 실행된다.</li> <li>wg.Add 100 을 해줘서, names 슬라이스에 저장된 각 이름을 출력할 고루틴 100개의 경쟁상태를 모의로 만든다.</li> <li>p.Run을 통해 namePrinter 값을 풀에 등록한다.</li> <li>메인 함수에서 그 짓을 100번을 돌려서 총 500개의 고루틴이 실행된다.</li></ul> <h2 id="_4-요약"><a href="#_4-요약" class="header-anchor">#</a> 4. 요약</h2> <ul><li>채널을 이용해 어플리케이션의 수명주기를 관리할 수 있다.</li> <li>default 구문이 선언된 select 구무은 채널에 논블로킹 형식으로 값을 보내거나 받을 수 있다.</li> <li>버퍼가 있는 채널은 재사용 가능한 리소스 풀을 관리하는데 사용할 수 있다.</li> <li>채널의 동기화는 런타임에 의해 자동으로 관리된다.</li> <li>고루틴의 풀이 필요할 때는 버퍼가 없는 채널을 활용하는편이 더 낫다.</li> <li>두 개의 고루틴 간에 데이터를 교환할 때 버퍼가 없는 채널을 이용하면 데이터 교환이 반드시 이루어지는 것을 보장할 수 있다.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/go-in-action/06.html" class="prev">6장 동시성</a></span> <span class="next"><a href="/study-collection/book/go-in-action/08.html">8장 표준 라이브러리</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.37c06816.js" defer></script><script src="/study-collection/assets/js/2.afa7b4ef.js" defer></script><script src="/study-collection/assets/js/117.6dceea18.js" defer></script>
  </body>
</html>
