<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10강 | 끄적끄적 블로그</title>
    <meta name="description" content="개발 관련 블로그">
    <link rel="icon" href="/study-collection/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/study-collection/assets/css/0.styles.48760978.css" as="style"><link rel="preload" href="/study-collection/assets/js/app.b3530f0b.js" as="script"><link rel="preload" href="/study-collection/assets/js/2.e4157d4c.js" as="script"><link rel="preload" href="/study-collection/assets/js/18.35ff77b3.js" as="script"><link rel="prefetch" href="/study-collection/assets/js/10.770e6dc7.js"><link rel="prefetch" href="/study-collection/assets/js/11.90980686.js"><link rel="prefetch" href="/study-collection/assets/js/12.42472462.js"><link rel="prefetch" href="/study-collection/assets/js/13.e00551c2.js"><link rel="prefetch" href="/study-collection/assets/js/14.81dd6bd5.js"><link rel="prefetch" href="/study-collection/assets/js/15.2fcf93a1.js"><link rel="prefetch" href="/study-collection/assets/js/16.63100517.js"><link rel="prefetch" href="/study-collection/assets/js/17.b3bd5db5.js"><link rel="prefetch" href="/study-collection/assets/js/19.665b9ff6.js"><link rel="prefetch" href="/study-collection/assets/js/20.b0b14418.js"><link rel="prefetch" href="/study-collection/assets/js/21.cab92dd5.js"><link rel="prefetch" href="/study-collection/assets/js/22.a470a7c3.js"><link rel="prefetch" href="/study-collection/assets/js/23.67733718.js"><link rel="prefetch" href="/study-collection/assets/js/24.775a7852.js"><link rel="prefetch" href="/study-collection/assets/js/25.1c4df0ee.js"><link rel="prefetch" href="/study-collection/assets/js/26.bf8ed84b.js"><link rel="prefetch" href="/study-collection/assets/js/27.c3ebd8c0.js"><link rel="prefetch" href="/study-collection/assets/js/28.ddd5f027.js"><link rel="prefetch" href="/study-collection/assets/js/29.6de3c336.js"><link rel="prefetch" href="/study-collection/assets/js/3.66b13c9c.js"><link rel="prefetch" href="/study-collection/assets/js/30.f2d538e9.js"><link rel="prefetch" href="/study-collection/assets/js/31.71fbc5e2.js"><link rel="prefetch" href="/study-collection/assets/js/32.27dcebc6.js"><link rel="prefetch" href="/study-collection/assets/js/33.c38d6b06.js"><link rel="prefetch" href="/study-collection/assets/js/34.8f420f31.js"><link rel="prefetch" href="/study-collection/assets/js/35.4ee86b2f.js"><link rel="prefetch" href="/study-collection/assets/js/36.2aba140e.js"><link rel="prefetch" href="/study-collection/assets/js/37.5328ccbe.js"><link rel="prefetch" href="/study-collection/assets/js/38.09dea42d.js"><link rel="prefetch" href="/study-collection/assets/js/39.83940677.js"><link rel="prefetch" href="/study-collection/assets/js/4.3f133511.js"><link rel="prefetch" href="/study-collection/assets/js/40.8d62f2dc.js"><link rel="prefetch" href="/study-collection/assets/js/41.3d65ea4f.js"><link rel="prefetch" href="/study-collection/assets/js/42.8960818e.js"><link rel="prefetch" href="/study-collection/assets/js/43.38f4706e.js"><link rel="prefetch" href="/study-collection/assets/js/44.6c8ec7b3.js"><link rel="prefetch" href="/study-collection/assets/js/45.043c6295.js"><link rel="prefetch" href="/study-collection/assets/js/46.2689a337.js"><link rel="prefetch" href="/study-collection/assets/js/47.1c37f469.js"><link rel="prefetch" href="/study-collection/assets/js/48.da0206e6.js"><link rel="prefetch" href="/study-collection/assets/js/49.5056e44f.js"><link rel="prefetch" href="/study-collection/assets/js/5.be446564.js"><link rel="prefetch" href="/study-collection/assets/js/50.aa8d5f67.js"><link rel="prefetch" href="/study-collection/assets/js/51.16947dfe.js"><link rel="prefetch" href="/study-collection/assets/js/52.ec458d49.js"><link rel="prefetch" href="/study-collection/assets/js/53.99ee2d40.js"><link rel="prefetch" href="/study-collection/assets/js/54.e48d1e5f.js"><link rel="prefetch" href="/study-collection/assets/js/55.85dfb845.js"><link rel="prefetch" href="/study-collection/assets/js/56.18b07e0e.js"><link rel="prefetch" href="/study-collection/assets/js/57.b01641c8.js"><link rel="prefetch" href="/study-collection/assets/js/58.e3527678.js"><link rel="prefetch" href="/study-collection/assets/js/59.e94191d4.js"><link rel="prefetch" href="/study-collection/assets/js/6.8582afd2.js"><link rel="prefetch" href="/study-collection/assets/js/60.424065e0.js"><link rel="prefetch" href="/study-collection/assets/js/61.2bfbdde8.js"><link rel="prefetch" href="/study-collection/assets/js/62.fa029d26.js"><link rel="prefetch" href="/study-collection/assets/js/63.28e6e307.js"><link rel="prefetch" href="/study-collection/assets/js/64.28c1c69c.js"><link rel="prefetch" href="/study-collection/assets/js/65.2d2df1da.js"><link rel="prefetch" href="/study-collection/assets/js/66.1238e888.js"><link rel="prefetch" href="/study-collection/assets/js/67.a704c605.js"><link rel="prefetch" href="/study-collection/assets/js/68.aebdd7f6.js"><link rel="prefetch" href="/study-collection/assets/js/69.a6e1cc48.js"><link rel="prefetch" href="/study-collection/assets/js/7.f6417f9c.js"><link rel="prefetch" href="/study-collection/assets/js/70.5f9b0d07.js"><link rel="prefetch" href="/study-collection/assets/js/71.58c0300c.js"><link rel="prefetch" href="/study-collection/assets/js/8.02a3db0c.js"><link rel="prefetch" href="/study-collection/assets/js/9.280b3ad6.js">
    <link rel="stylesheet" href="/study-collection/assets/css/0.styles.48760978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-collection/" class="home-link router-link-active"><!----> <span class="site-name">끄적끄적 블로그</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study-collection/guide.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://github.com/gwegwe1234/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/study-collection/guide.html" class="sidebar-link">Intro</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Book summary</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>자바 프로그래밍 면접 이렇게 준비한다</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>클린코드</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>스프링 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-collection/book/spring-in-action/001.html" class="sidebar-link">1장 스프링 속으로</a></li><li><a href="/study-collection/book/spring-in-action/002.html" class="sidebar-link">2장 빈 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/003.html" class="sidebar-link">3장 고급 와이어링</a></li><li><a href="/study-collection/book/spring-in-action/004.html" class="sidebar-link">4장 애스펙트 지향 스프링</a></li><li><a href="/study-collection/book/spring-in-action/005.html" class="sidebar-link">5장 스프링 웹 어플리케이션 만들기</a></li><li><a href="/study-collection/book/spring-in-action/006.html" class="sidebar-link">6장 웹 뷰 렌더링</a></li><li><a href="/study-collection/book/spring-in-action/007.html" class="sidebar-link">7장 고급 스프링MVC</a></li><li><a href="/study-collection/book/spring-in-action/008.html" class="sidebar-link">8장 스프링 웹플로로 작업하기</a></li><li><a href="/study-collection/book/spring-in-action/009.html" class="sidebar-link">9장 웹 어플리케이션 보안</a></li><li><a href="/study-collection/book/spring-in-action/010.html" class="active sidebar-link">10장 스프링과 JDBC를 사용하여 데이터베이스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/011.html" class="sidebar-link">11장 객체 관계형 매핑을 통한 데이터 퍼시스팅</a></li><li><a href="/study-collection/book/spring-in-action/012.html" class="sidebar-link">12장 NoSQL 데이터베이스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/013.html" class="sidebar-link">13장 데이터 캐싱하기</a></li><li><a href="/study-collection/book/spring-in-action/014.html" class="sidebar-link">14장 시큐리티 메소드</a></li><li><a href="/study-collection/book/spring-in-action/015.html" class="sidebar-link">15장 원격 서비스 사용하기</a></li><li><a href="/study-collection/book/spring-in-action/016.html" class="sidebar-link">16장 스프링 MVC로 REST API 사용하기</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>고 인 액션</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>마이크로서비스 구축과 운영</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tech</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_10강"><a href="#_10강" class="header-anchor">#</a> 10강</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-스프링의-데이터-액세스-철학">1. 스프링의 데이터 액세스 철학</a><ul><li><a href="#_1-1-스프링의-데이터-액세스-예외-계층-구조">1-1. 스프링의 데이터 액세스 예외 계층 구조</a></li><li><a href="#_1-2-데이터-액세스-템플릿화">1-2. 데이터 액세스 템플릿화</a></li></ul></li><li><a href="#_2-데이터-소스-설정">2. 데이터 소스 설정</a><ul><li><a href="#_2-1-jndi-데이터-소스">2-1. JNDI 데이터 소스</a></li><li><a href="#_2-2-풀링-기능이-있는-데이터-소스-사용하기">2-2. 풀링 기능이 있는 데이터 소스 사용하기</a></li><li><a href="#_2-3-jdbc-드라이버-기반-데이터-소스">2-3. JDBC 드라이버 기반 데이터 소스</a></li><li><a href="#_2-4-임베디드-데이터-소스-사용">2-4. 임베디드 데이터 소스 사용</a></li><li><a href="#_2-5-데이터-소스-선택을-위한-프로파일링하기">2-5. 데이터 소스 선택을 위한 프로파일링하기</a></li></ul></li><li><a href="#_3-스프링과-jdbc">3. 스프링과 JDBC</a><ul><li><a href="#_3-1-지저분한-jdbc-코드-해결">3-1. 지저분한 JDBC 코드 해결</a></li><li><a href="#_3-2-jdbc-template">3-2 JDBC Template</a></li></ul></li></ul></div><p></p> <h2 id="_1-스프링의-데이터-액세스-철학"><a href="#_1-스프링의-데이터-액세스-철학" class="header-anchor">#</a> 1. 스프링의 데이터 액세스 철학</h2> <ul><li>어플리케이션 내 모든 컴포넌트에 걸쳐 퍼시스턴트 로직이 산란되는 것을 피하기 위해, 데이터 액세스는 해당 태스크에 집중된 하나 이상의 컴포넌트로 이루어진다. 보통 DAO라고 부른다.</li></ul> <p><img src="/study-collection/assets/img/data1.002e0d9c.jpg" alt="Alt text"></p> <ul><li>서비스 객체는 자신의 데이터 액세스를 처리하지 않고, 데이터 액세스를 저장소에 위임한다.</li> <li>저장소의 인터페이스는 서비스 객체에 루즈 커필링 한다.</li> <li>스프링은 데이터 액세스 계층을 모든 퍼시스턴스 옵션을 가지는 일관적인 예외 계층 구조를 사용하여 어플리케이션의 나머지와 격리시킨다.</li></ul> <h3 id="_1-1-스프링의-데이터-액세스-예외-계층-구조"><a href="#_1-1-스프링의-데이터-액세스-예외-계층-구조" class="header-anchor">#</a> 1-1. 스프링의 데이터 액세스 예외 계층 구조</h3> <ul><li>SQLException은 데이터 접근시 문제가 있다는 것은 알려주지만, 어떻게 해결하는지는 안알려준다.</li> <li>SQLException을 발생시키는 대표적인 문제들</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">1.</span> 어플리케이션이 데이터베이스에 연결될 수 없다<span class="token punctuation">.</span>
<span class="token number">2.</span> 수행할 쿼리 문장에 문법적인 오류가 있다<span class="token punctuation">.</span>
<span class="token number">3.</span> 쿼리 문장에서 참조하는 테이블이나 컬럼이 존재하지 않는다<span class="token punctuation">.</span>
<span class="token number">4.</span> 레코드 삽입이나 업데이트 시도가 데이터베이스 제약 사항을 위배한다<span class="token punctuation">.</span>
</code></pre></div><ul><li><p>이런식으로 뭐가 잘못됐는지는 알려주긴 하지만, catch에서 해결 된다던가 할 수가 없다.</p></li> <li><p>하이버네이트의 경우 20개 이상의 다양한 예외를 제공하고, catch에서 처리할 수 있지만, 그건 하이버네이트에만 특화된 예외 처리이다.
</p><hr><p></p></li> <li><p>이러한 문제들을 해결해 주는게 스프링에서 제공해주는 퍼시스턴트 플랫폼이다.</p></li> <li><p>스프링 JDBC는 앞에서 언급한 두가지 문제점을 해결하는 데이터 액세스 예외 계층을 제공한다.</p></li></ul> <p><img src="/study-collection/assets/img/data2.1b69cdf8.png" alt="Alt text"></p> <ul><li>이런식으로 엄청나게 많은 예외를 제고한다.</li></ul> <hr> <ul><li>위의 예외들은 모두 DataAccessException을 확장한다.</li> <li>이 예외들은 전부다 비검사형 예외라, 모두다 캐치를 안해도 상관없다.</li> <li>스프링의 철학 같은 건데, 대부분의 예외들은 catch내에서 해결을 못하는 부분에서 나온다고 보고, 예외처리의 유무는 개발자에게 위임한다.</li></ul> <div class="custom-block tip"><p class="custom-block-title">검사형 예외가 throws 된다고 선언된 메소드는 호출 시 반드시 try-catch로 묶어줘야 한다.</p> <p>SQL Exception이나 IOException 같은 경우가 대표적인 검사형 예외이다.
RuntimeException , NullPointException은 비검사형 예외이다.
보통 검사형 예외보단 비검사형 예외가 더 좋다는게 대세.
스프링이 좋은 이유중에 하나</p></div> <h3 id="_1-2-데이터-액세스-템플릿화"><a href="#_1-2-데이터-액세스-템플릿화" class="header-anchor">#</a> 1-2. 데이터 액세스 템플릿화</h3> <ul><li>비행기 수하물 예시</li> <li><a href="https://zetawiki.com/wiki/Template_Method_%ED%8C%A8%ED%84%B4" target="_blank" rel="noopener noreferrer">템플릿 메소드 패턴<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 이용한다.</li> <li>템플릿 메소드는 어떤 알고리즘의 골격을 정의한다.</li> <li>이 알고리즘 구조는 절대 변하지 않는다. 하지만 그 세부사항이 변경됨.</li> <li>특정 메인 기능이 있으면, 그 기능에 대한 실제 세부 정의는 하위 클래스에 맡겨버린다.</li> <li>스프링 데이터 액세스에 적용한 것이 바로 이 패턴</li></ul> <hr> <ul><li>어떤 기술이나 디비를 사용하던지 간에 특정 데이터베이스 액세스 단계는 필수적이다. (메인 알고리즘)</li> <li>하지만 작성할 데이터 액세스 메소드는 다르게 구현이 되어야 한다. (세부사항)</li> <li>스프링은 데이터 액세스 절차상에서 고정된 단계와 가변적인 단계를 <em>템플릿</em> 과 <em>콜백</em> 이라는 별도 클래스로 분리한다.</li> <li>템플릿은 고정된 부분을 처리하고, 콜백은 맞춤 데이터 액세스 코드를 처리한다.</li></ul> <p><img src="/study-collection/assets/img/data3.f386a897.jpg" alt="Alt text"></p> <ul><li>위의 그림을 보면, 트랜잭션 제어나 리소스 관리, 예외처리같은 부분은 템플릿에서 처리해주고, 어플리케이션단에서는 쿼리생성이나, 결과 추출같은 부분을 담당한다.</li> <li>이런 템플릿들을 스프링에선 여러가지를 제공해 준다.</li></ul> <table><thead><tr><th>템플릿 클래스</th> <th>용도</th></tr></thead> <tbody><tr><td>CciTemplate</td> <td>JCA CCI 연결</td></tr> <tr><td>JdbcTemplate</td> <td>JDBC 연결</td></tr> <tr><td>NamedParameterJdbcTemplate</td> <td>명명된 파라미터가 지원되는 JDBC 연결</td></tr> <tr><td>SimpleJdbcTemplate</td> <td>스프링 3.1 이후부터 미제공</td></tr> <tr><td>HibernateTemplate</td> <td>Hibernate 3.x 세션</td></tr> <tr><td>SqlMapClientTemplate</td> <td>iBATIS SqlMap 클라이언트</td></tr> <tr><td>JdoTemplate</td> <td>Java Data Object 구현체</td></tr> <tr><td>JpaTemplate</td> <td>JPA 엔티티 관리자</td></tr></tbody></table> <h2 id="_2-데이터-소스-설정"><a href="#_2-데이터-소스-설정" class="header-anchor">#</a> 2. 데이터 소스 설정</h2> <ul><li>스프링 어플리케이션에 데이터 소스 빈 설정 방법</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">1.</span> JDBC 드라이버
<span class="token number">2.</span> JNDI
<span class="token number">3.</span> 커넥션을 풀링하는 데이터 소스
</code></pre></div><h3 id="_2-1-jndi-데이터-소스"><a href="#_2-1-jndi-데이터-소스" class="header-anchor">#</a> 2-1. JNDI 데이터 소스</h3> <ul><li>데이터 소스가 어플리케이션 외부에서 관리 되는 장점이 있다. (톰캣, JBoss..)</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">JndiObjectFactoryBean</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">JndiObjectFactoryBean</span> jndiObjectFB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JndiObjectFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jndiObjectFB<span class="token punctuation">.</span><span class="token function">setJndiName</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc/SpittrDS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jndiObjectFB<span class="token punctuation">.</span><span class="token function">setResourceRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jndiObjectFB<span class="token punctuation">.</span><span class="token function">setProxyInterface</span><span class="token punctuation">(</span>javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> jndiObjectFB<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>스프링에선 이런식으로 자바빈으로 설정이 가능하다</li></ul> <h3 id="_2-2-풀링-기능이-있는-데이터-소스-사용하기"><a href="#_2-2-풀링-기능이-있는-데이터-소스-사용하기" class="header-anchor">#</a> 2-2. 풀링 기능이 있는 데이터 소스 사용하기</h3> <ul><li>스프링은 풀링 긴으을 가진 데이터 소스를 제공하진 않고, 다른 라이브러리를 사용해야 한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">1.</span> <span class="token class-name">Apache</span> 공통 DBCP
<span class="token number">2.</span> c3p0
<span class="token number">3.</span> <span class="token class-name">BoneCP</span>
</code></pre></div><ul><li>아래는 DBCP의 BasicDataSource 설정 방법이다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">BasicDataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">BasicDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;org.h2.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;sa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setInitialSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setMaxActive</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 BasicDataSource를 사용하여 풀링이 가능하다.</li></ul> <table><thead><tr><th>풀 설정 프로퍼티</th> <th>설명</th></tr></thead> <tbody><tr><td>initialSize</td> <td>해당 풀이 시작될 때 생성할 커넥션 수</td></tr> <tr><td>maxActive</td> <td>해당 풀에서 동시에 제공할 수 있는 최대 커넥션 수</td></tr> <tr><td>maxIdle</td> <td>해당 풀에서 동시에 휴면 상태로 유지될 수 있는 최대 커넥션 수</td></tr> <tr><td>maxOpenPreparedStatements</td> <td>질의객체 풀에서 동시에 제공할 수 있는 최대 PreparedStatement 수</td></tr> <tr><td>maxWait</td> <td>해당 풀에 커넥션을 요청 했을때 대기가능한 최대 시간</td></tr> <tr><td>minEvictableIdleTimeMillis</td> <td>해당 풀에서 커넥션을 제거하기 전에 휴면 상태로 남아 있을 수 있는 시간</td></tr> <tr><td>minIdel</td> <td>해당 풀에서 동시에 휴면 상태로 유지될 수 있는 최소 커넥션 수</td></tr> <tr><td>poolPreparedStatements</td> <td>PreparedStatement의 풀링 여부를 나타내는 boolean값</td></tr></tbody></table> <h3 id="_2-3-jdbc-드라이버-기반-데이터-소스"><a href="#_2-3-jdbc-드라이버-기반-데이터-소스" class="header-anchor">#</a> 2-3. JDBC 드라이버 기반 데이터 소스</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">1.</span> <span class="token class-name">DriverManagerDataSource</span> <span class="token operator">:</span> 어플리케이션이 커넥션을 요청할 때마다 새로운 커넥션 반환<span class="token punctuation">.</span> 풀링은 안된다<span class="token punctuation">.</span>
<span class="token number">2.</span> <span class="token class-name">SimpleDriverDataSource</span> <span class="token operator">:</span> <span class="token class-name">OSGi</span> 컨테이너같은 특정 환경에서 발생하는 클래스 로딩문제를 극복하기 위한 데이터 소스
<span class="token number">3.</span> <span class="token class-name">SingleConnectionDataSource</span> <span class="token operator">:</span> 항상 동일한 커넥션 반환
</code></pre></div><ul><li>빈생성 방법은 BasicDataSource와 비슷하다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">DriverManagerDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DriverManagerDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;org.h2.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;sa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>상용에서 쓰긴 별로이다.</li></ul> <h3 id="_2-4-임베디드-데이터-소스-사용"><a href="#_2-4-임베디드-데이터-소스-사용" class="header-anchor">#</a> 2-4. 임베디드 데이터 소스 사용</h3> <ul><li>개발이나 테스트할때 쓰기엔 좋음</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EmbeddedDatabaseBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedDatabaseType</span><span class="token punctuation">.</span>H2<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:schema.sql&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:test-data.sql&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-5-데이터-소스-선택을-위한-프로파일링하기"><a href="#_2-5-데이터-소스-선택을-위한-프로파일링하기" class="header-anchor">#</a> 2-5. 데이터 소스 선택을 위한 프로파일링하기</h3> <ul><li>개발 환경에 따라 여러종류의 데이터소스들 중 적절한 것을 선택해주면 좋다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfiguration</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span>	
  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">embeddedDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EmbeddedDatabaseBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedDatabaseType</span><span class="token punctuation">.</span>H2<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:schema.sql&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:test-data.sql&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;qa&quot;</span><span class="token punctuation">)</span>	
  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BasicDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;org.h2.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;sa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">setInitialSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">setMaxActive</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span>	
  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JndiObjectFactoryBean</span> jndiObjectFactoryBean
                                          <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JndiObjectFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setJndiName</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc/SpittrDS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setResourceRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setProxyInterface</span><span class="token punctuation">(</span>javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">)</span> jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-스프링과-jdbc"><a href="#_3-스프링과-jdbc" class="header-anchor">#</a> 3. 스프링과 JDBC</h2> <h3 id="_3-1-지저분한-jdbc-코드-해결"><a href="#_3-1-지저분한-jdbc-코드-해결" class="header-anchor">#</a> 3-1. 지저분한 JDBC 코드 해결</h3> <ul><li>JDBC가 데이터베이스와 밀접하게 동작하는 API를 제공하지만, 액세스 처리는 전부 개발자가 해야한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SQL_INSERT_SPITTER <span class="token operator">=</span>
 <span class="token string">&quot;insert into spitter (username, password, fullname) values (?, ?, ?)&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token class-name">PreparedStatement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>SQL_INSERT_SPITTER<span class="token punctuation">)</span><span class="token punctuation">;</span>	
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something...not sure what, though	</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
        stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// I'm even less sure about what to do here</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>굉장히 너저분하다.</li> <li>실제 필요한 로직은 얼마 안되는데, 기타 잡다한 부분에 대한 처리가 넘처난다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SQL_UPDATE_SPITTER <span class="token operator">=</span>
      <span class="token string">&quot;update spitter set username = ?, password = ?, fullname = ?&quot;</span>
      <span class="token operator">+</span> <span class="token string">&quot;where id = ?&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token class-name">PreparedStatement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    conn <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>SQL_UPDATE_SPITTER<span class="token punctuation">)</span>	
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Still not sure what I'm supposed to do here	</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stmt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
        stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// or here</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이건 비슷한 쿼리인데, 일부분을 제외하고 그전과 다를바가 없다.</li> <li>단순반복적인 코드가 너무 많다</li></ul> <h3 id="_3-2-jdbc-template"><a href="#_3-2-jdbc-template" class="header-anchor">#</a> 3-2 JDBC Template</h3> <ul><li>위와 같은 더러운 문제를 해결하기 위해 JDBC Template을 사용해 보자</li> <li>모든 JdbcTemplate은 DataSource가 있어야 작동한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">jdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTempalte</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcSpitterRepository</span> <span class="token keyword">implements</span> <span class="token class-name">SpitterRepository</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcOperations</span> jdbcOperations<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Inject</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcSpitterRepository</span><span class="token punctuation">(</span><span class="token class-name">JdbcOperations</span> jdbcOperations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcOperations <span class="token operator">=</span> jdbcOperations<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

or

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SpitterRepository</span> <span class="token function">spitterRepository</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcSpitterRepository</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>이런식으로 JdbcTemplate을 사용할 수 있도록 설정을 해준다.</li></ul> <hr> <ul><li>이제 add 하는 메소드를 작성해보면</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jdbcOperations<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>INSERT_SPITTER<span class="token punctuation">,</span>	
        spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        spitter<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        spitter<span class="token punctuation">.</span><span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        spitter<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        spitter<span class="token punctuation">.</span><span class="token function">isUpdateByEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>커넥션, 질의객체 생성같은 삽질을 안해도 된다.</li></ul> <hr> <ul><li>데이터 읽기 역시 간단해 진다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> jdbcOperations<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>	<span class="token comment">// Spitter에 대한 쿼리</span>
            SELECT_SPITTER_BY_ID<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SpitterRowMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id	 <span class="token comment">// 객체로 매핑</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SpitterRowMapper</span> <span class="token keyword">implements</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Spitter</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">mapRow</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Spitter</span><span class="token punctuation">(</span>	
        rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;fullName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;updateByEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ul><li>자바 8 람다와 사용해 보자</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> jdbcOperations<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>
    SELECT_SPITTER_BY_ID<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>rs<span class="token punctuation">,</span> rowNum<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Spitter</span><span class="token punctuation">(</span>
        rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;fullName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rs<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;updateByEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Spitter</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> jdbcOperations<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>
    SELECT_SPITTER_BY_ID<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">mapSpitter</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">Spitter</span> <span class="token function">mapSpitter</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Spitter</span><span class="token punctuation">(</span>
      rs<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;fullName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      rs<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;updateByEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <ul><li>명명된 파라미터를 사용할 수도 있다.</li> <li>명명된 파라미터를 사용하면, SQL읭 각 파라미터에 명시적인 이름을 부여하게 되어, 질의객체 파라미터로 던저준다.</li> <li>이름에 맞춰 넣어주니까 순서도 물론 필요가 없다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">NamedParameterJdbcTemplate</span> <span class="token function">jdbcTemplate</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NamedParameterJdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> INSERT_SPITTER <span class="token operator">=</span>
        <span class="token string">&quot;insert into Spitter &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; (username, password, fullname, email, updateByEmail) &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;values &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; (:username, :password, :fullname, :email, :updateByEmail)&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSpitter</span><span class="token punctuation">(</span><span class="token class-name">Spitter</span> spitter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> paramMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    paramMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    paramMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    paramMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;fullname&quot;</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    paramMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    paramMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;updateByEmail&quot;</span><span class="token punctuation">,</span> spitter<span class="token punctuation">.</span><span class="token function">isUpdateByEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    jdbcOperations<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>INSERT_SPITTER<span class="token punctuation">,</span> paramMap<span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-collection/book/spring-in-action/009.html" class="prev">9장 웹 어플리케이션 보안</a></span> <span class="next"><a href="/study-collection/book/spring-in-action/011.html">11장 객체 관계형 매핑을 통한 데이터 퍼시스팅</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-collection/assets/js/app.b3530f0b.js" defer></script><script src="/study-collection/assets/js/2.e4157d4c.js" defer></script><script src="/study-collection/assets/js/18.35ff77b3.js" defer></script>
  </body>
</html>
