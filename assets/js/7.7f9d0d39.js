(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{328:function(t,s,a){t.exports=a.p+"assets/img/ks_5_1.564c224e.jpg"},329:function(t,s,a){t.exports=a.p+"assets/img/ks_5_2.f0b6f40e.jpg"},330:function(t,s,a){t.exports=a.p+"assets/img/ks_5_3.4c3c5afa.jpg"},331:function(t,s,a){t.exports=a.p+"assets/img/ks_5_4.1dfcc3bb.jpg"},332:function(t,s,a){t.exports=a.p+"assets/img/ks_5_5.ef03598b.jpg"},333:function(t,s,a){t.exports=a.p+"assets/img/ks_5_6.4c776691.jpg"},334:function(t,s,a){t.exports=a.p+"assets/img/ks_5_7.26b2fd5d.jpg"},335:function(t,s,a){t.exports=a.p+"assets/img/ks_5_8.9b76709e.jpg"},336:function(t,s,a){t.exports=a.p+"assets/img/ks_5_9.dbbf8cdc.jpg"},337:function(t,s,a){t.exports=a.p+"assets/img/ks_5_10.6af8ea29.jpg"},338:function(t,s,a){t.exports=a.p+"assets/img/ks_5_11.deada5c0.jpg"},339:function(t,s,a){t.exports=a.p+"assets/img/ks_5_12.d3434af0.jpg"},340:function(t,s,a){t.exports=a.p+"assets/img/ks_5_13.730db07c.jpg"},341:function(t,s,a){t.exports=a.p+"assets/img/ks_5_14.68309696.jpg"},342:function(t,s,a){t.exports=a.p+"assets/img/ks_5_15.562830ae.jpg"},621:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_5강"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5강"}},[t._v("#")]),t._v(" 5강")]),t._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#_1-스트림과-테이블의-관계"}},[t._v("1. 스트림과 테이블의 관계")]),n("ul",[n("li",[n("a",{attrs:{href:"#_1-1-레코드스트림"}},[t._v("1-1. 레코드스트림")])]),n("li",[n("a",{attrs:{href:"#_1-2-레코드-및-변경로그-업데이트"}},[t._v("1-2. 레코드 및 변경로그 업데이트")])]),n("li",[n("a",{attrs:{href:"#_1-3-이벤트-스트림과-업데이트-스트림-비교"}},[t._v("1-3. 이벤트 스트림과 업데이트 스트림 비교")])])])]),n("li",[n("a",{attrs:{href:"#_2-레코드-업데이트와-ktable-구성"}},[t._v("2. 레코드 업데이트와 KTable 구성")]),n("ul",[n("li",[n("a",{attrs:{href:"#_2-1-캐시-버퍼-크기-설정하기"}},[t._v("2-1. 캐시 버퍼 크기 설정하기")])]),n("li",[n("a",{attrs:{href:"#_2-2-커밋-주기-설정하기"}},[t._v("2-2. 커밋 주기 설정하기")])])])]),n("li",[n("a",{attrs:{href:"#_3-집계와-윈도-작업"}},[t._v("3. 집계와 윈도 작업")]),n("ul",[n("li",[n("a",{attrs:{href:"#_3-1-업계별-거래량-집계"}},[t._v("3-1. 업계별 거래량 집계")])]),n("li",[n("a",{attrs:{href:"#_3-2-윈도-연산"}},[t._v("3-2. 윈도 연산")])]),n("li",[n("a",{attrs:{href:"#_3-3-kstream과-ktable-조인하기"}},[t._v("3-3. KStream과 KTable 조인하기")])]),n("li",[n("a",{attrs:{href:"#_3-4-globalktable"}},[t._v("3-4. GlobalKTable")])]),n("li",[n("a",{attrs:{href:"#_3-5-쿼리-가능-상태"}},[t._v("3-5. 쿼리 가능 상태")])])])]),n("li",[n("a",{attrs:{href:"#요약"}},[t._v("요약")])])])]),n("p"),t._v(" "),n("h2",{attrs:{id:"_1-스트림과-테이블의-관계"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-스트림과-테이블의-관계"}},[t._v("#")]),t._v(" 1. 스트림과 테이블의 관계")]),t._v(" "),n("h3",{attrs:{id:"_1-1-레코드스트림"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-레코드스트림"}},[t._v("#")]),t._v(" 1-1. 레코드스트림")]),t._v(" "),n("ul",[n("li",[t._v("일련의 주가 업데이트를 본다고 가정하자.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(328),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("각각의 주가 시세는 개별 이벤트이고 서로 관련이 없다.")]),t._v(" "),n("li",[t._v("같은 회사의 시세 정보가 다수 차지하더라도, 한 번에 하나씩만 보고 있다.")]),t._v(" "),n("li",[t._v("이 이벤트 뷰는 KStream이 작동하는 방식인 레코드의 스트림이다.")]),t._v(" "),n("li",[t._v("이제 이 개념이 데이터베이스 테이블과 관련지어보면 아래와 같이 나온다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(329),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("표에서 행은 키/값 쌍으로 재구성 할 수 있다.")]),t._v(" "),n("li",[t._v("이제 이 레코드 스트림과 표를 같이 표현해보자.")]),t._v(" "),n("li",[t._v("각 레코드는 독립적으로 있기 때문에 테이블에 삽입하는 것으로 스트림을 표현해 준다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(330),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("테이블 삽입과 이벤트 스트림을 같은 색상으로 함께 볼 수 있다는 것인데, 이벤트를 처리하는 스트림 사용에 대해 더 깊이 이해할 수 있다.")])]),t._v(" "),n("h3",{attrs:{id:"_1-2-레코드-및-변경로그-업데이트"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-레코드-및-변경로그-업데이트"}},[t._v("#")]),t._v(" 1-2. 레코드 및 변경로그 업데이트")]),t._v(" "),n("ul",[n("li",[t._v("여기에 동일한 고객 거래 스트림을 가져와 보자.")]),t._v(" "),n("li",[t._v("다만, 이제는 시간 흐름에 따른 활동을 추적한다.")]),t._v(" "),n("li",[t._v("고객 ID 키를 추가한다면 구매 이벤트는 각기 다른 이벤트와 연관시킬 수 있고, 이벤트 스트림과는 다른 업데이트 스트림을 갖게 된다.")]),t._v(" "),n("li",[t._v("이 스트림을 로그처럼 간주한다면, 이 이벤트 스트림은 변경로그 같은 업데이트 스트림으로 취급할 수 있다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(331),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("Stock_ID를 프라이머리 키로 사용한다면, 이후 이벤트는 같은 키로 변경로그를 업데이트한다.")]),t._v(" "),n("li",[t._v("이러한 경우, 한 회사마다 1개, 즉 레코드 2개만 남게 된다.")]),t._v(" "),n("li",[t._v("같은 회사에서 더 많은 레코드가 유입될 수 잇지만, 레코드에 누적되지는 않는다.")]),t._v(" "),n("li",[t._v("즉 이벤트는 4번 발생했지만, 변경 로그는 2개만 남게 된다.")])]),t._v(" "),n("hr"),t._v(" "),n("ul",[n("li",[t._v("여기서 업데이트 스트림과 데이터베이스 테이블 사이의 관계를 알 수 있다.")]),t._v(" "),n("li",[t._v("로그와 변경로그 둘 다 파일의 긑에 추가된 유입 레코드를 의미한다.")]),t._v(" "),n("li",[t._v("로그의 경우 모든 레코드를 볼 수 있지만, 변경로그의 경우 주어진 어던 키에 대한 최신 레코드만 유지한다.")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("로그와 변경로그에서 레코드는 입력되는 파일의 끝에 추가된다. 로그에서는 모든 로그가 필요하고, 변경로그에서는 각 키에 대한 최신 레코드만 필요하다는 점이 다르다.")])]),t._v(" "),n("ul",[n("li",[t._v("키별로 최신 레코드를 유지하는 동안 로그를 줄이기 위해 로그 압축을 사용하면 된다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(332),alt:"ks"}})]),t._v(" "),n("h3",{attrs:{id:"_1-3-이벤트-스트림과-업데이트-스트림-비교"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-이벤트-스트림과-업데이트-스트림-비교"}},[t._v("#")]),t._v(" 1-3. 이벤트 스트림과 업데이트 스트림 비교")]),t._v(" "),n("p",[n("img",{attrs:{src:a(333),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("위의 예시를 보면, KStream은 총 9번의 레코드를 출력하지만, KTable은 이전 레코드를 덮어써서 3건의 레코드만 출력한다.")]),t._v(" "),n("li",[t._v("당연히 마지막 업데이트 값은 KStream이나 KTable이나 동일하다.")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("위의 예시를 보면, KTable 에서 업데이트가 작동하는 방식을 보여준다. 암묵적으로 추정했던 방식이 명로해 졌다. KTable을 사용하면 키/값 쌍에 있는 키를 레코드에 넣어야한다. KTable이 작동하기 위해서는 이 키가 필수이다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 주식 알림 프로그램 소스")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTickerData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" stockTickerTable "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TICKER_TABLE_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KTable 인스턴스 생성")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTickerData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" stockTickerStream "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TICKER_STREAM_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KStream 인스턴스 생성")]),t._v("\n\nstockTickerTable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Printed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTickerData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toSysOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withLable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Stocks-KTable"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KTable이 콘솔에 결과출력")]),t._v("\n\nstockTickerStream\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Printed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTickerData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toSysOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withLable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Stocks-KStream"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KStream이 콘솔에 결과 출력")]),t._v("\n")])])]),n("h2",{attrs:{id:"_2-레코드-업데이트와-ktable-구성"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-레코드-업데이트와-ktable-구성"}},[t._v("#")]),t._v(" 2. 레코드 업데이트와 KTable 구성")]),t._v(" "),n("ul",[n("li",[t._v("KTable의 기능을 이해하기 위해 두 가지 질문을 해보자\n"),n("ul",[n("li",[t._v("레코드를 어디에 저장하는가?")]),t._v(" "),n("li",[t._v("KTable은 레코드를 내보내는 결정을 어떻게 하는가?")])])]),t._v(" "),n("li",[t._v("위 질문에 대한 답은 aggregation과 reducing 작업을 할 때 필요하다.")]),t._v(" "),n("li",[t._v("첫 질문에 대한 답을 위해 KTable을 생성하는 다음 줄을 봐보자")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TICKER_TABLE_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("이 단순한 한줄에서 StreamBuilder는 KTable 인스턴스를 만들고 동시에 그 내부에 스트림 상태를 추적하는 상태 저장소를 만들어 업데이트 스트림을 만든다.")]),t._v(" "),n("li",[t._v("이 방식으로 생성된 상태 저장소는 내부적인 이름을 갖기 때문에 대화형 쿼리에서는 사용할 수 없다.")]),t._v(" "),n("li",[t._v("첫 질문에 대한 답은 KTable은 카프카 스트림즈와 통합된 로컬 상태 저장소를 저장 공간으로 사용한다는 것이다.(Rocks DB)")])]),t._v(" "),n("hr"),t._v(" "),n("ul",[n("li",[t._v("두 번째 질문인 KTable이 업데이트를 다운스트림 프로세서로 내보내는 시점에 관한 질문을 봐보자.")]),t._v(" "),n("li",[t._v("이 질문을 해결하기 위해선 다음과 같은 부분이 고려되어야 한다.\n"),n("ul",[n("li",[t._v("어플리케이션에 유입되는 레코드 수, 높은 데이터 유입률은 업데이트된 레코드를 내보내는 비율을 높일 수 있다.")]),t._v(" "),n("li",[t._v("데이터에 구별되는 키가 얼마나 많은가? 구별되는 키 개수가 많다면 다운스트림에 더 많은 업데이트를 보내게 된다.")]),t._v(" "),n("li",[t._v("cache.max.bytes.buffering과 commit.interval.ms 구성 매개변수")])])])]),t._v(" "),n("h3",{attrs:{id:"_2-1-캐시-버퍼-크기-설정하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-캐시-버퍼-크기-설정하기"}},[t._v("#")]),t._v(" 2-1. 캐시 버퍼 크기 설정하기")]),t._v(" "),n("ul",[n("li",[t._v("KTable 캐시는 같은 키가 있는 레코드의 중복을 의미한다.")]),t._v(" "),n("li",[t._v("이러한 중복 제거는 처리할 데이터의 총량을 줄이기 위해 모든 업데이트 대신 가장 최근 업데이트만 자식 노드에 제공한다.")]),t._v(" "),n("li",[t._v("이렇게 가장 최신 데이터만 저장히기 때믄에, 영구 상태 저장소를 사용할 때 성능이 매우 좋아진다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(334),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("KTable 캐시는 같은 키가 있는 레코드 업데이트의 중복을 제거해, 토폴로지에 있는 KTable의 자식 노드에 연속적인 업데이트가 흐르는걸 방지한다.")])]),t._v(" "),n("h3",{attrs:{id:"_2-2-커밋-주기-설정하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-커밋-주기-설정하기"}},[t._v("#")]),t._v(" 2-2. 커밋 주기 설정하기")]),t._v(" "),n("ul",[n("li",[t._v("commit.interval.ms 매개변수를 통해 프로세서의 상태를 얼마나 자주 저장할지 결정한다.")]),t._v(" "),n("li",[t._v("프로세서 상태를 커밋할 때, 캐시를 강제로 비우고 중복 제거된 마지막 업데이트 레코드를 다운스트림에 전송한다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(335),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("레코드를 다운스트림으로 보내는 방법은 2가지가 있다.")]),t._v(" "),n("li",[t._v("커밋하거나 캐시가 최대 크기가 도달하면 레코드를 다운스트림으로 전달한다.")]),t._v(" "),n("li",[t._v("캐시를 비활성화하면 중복된 키를 포함한 모든 레코드를 다운스트림에 전송한다.")]),t._v(" "),n("li",[t._v("KTable을 쓸거면 캐시를 활성화 하는게 좋다.")])]),t._v(" "),n("h2",{attrs:{id:"_3-집계와-윈도-작업"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-집계와-윈도-작업"}},[t._v("#")]),t._v(" 3. 집계와 윈도 작업")]),t._v(" "),n("h3",{attrs:{id:"_3-1-업계별-거래량-집계"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-업계별-거래량-집계"}},[t._v("#")]),t._v(" 3-1. 업계별 거래량 집계")]),t._v(" "),n("ul",[n("li",[t._v("스트리밍 데이터를 다루다 보면 집계와 그룹화는 필수")]),t._v(" "),n("li",[t._v("예제는 데이 트레이더 역할을 맡아서 선택한 산업 목록 전체에 걸쳐 회사의 거래량을 추적한다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 원시 주식 거래 정보가 입력된 토픽으로부터 소스를 만든다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTransaction")]),t._v(" 객체를\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" 객체에 매핑해야 한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTransaction")]),t._v(" 객체는 거래와 관련된 메타데이터를 갖고 있지만"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n거래와관련된 거래량"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("만 필요하다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 종목 코드로 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" 그룹을 만든다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 이 코드로 그룹을 만들면"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 전체 주식 거래량에서 그룹별 거래량으로\n데이터를 줄일 수 있다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 여기서 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("groupBy를 호출하면"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KGroupedStream")]),t._v(" 인스턴스를 반환하는데"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KGroupedStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reduce를 호출하면 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),t._v(" 인스턴스를 얻게 된다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("KGroupedStream은 KStream.groupBy나 KStream.groupByKey를 사용하면 반환되는 인스턴스로, 키별로 그룹화한 이벤트 스트림의 중간 표현일 뿐, 직접 작업하기 위한 것은 아니다. 대신 KGroupedStream은 집계 작업을 수행하기 위해 필요하며 항상 KTable이 된다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(336),alt:"ks"}})]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" shareVolume "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TRANSACTIONS_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    stockTransactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withOffsetResetPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EARLIEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// StockTransaction 객체를 SHareVolume 객체로 매핑")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapValues")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("st "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("st"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 주식 종목 코드에 따른 ShareVolume 객체 그룹화")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSymbol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shareVolumeSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 거래량 롤링 집계하기 위한 ShareVolume 객체 리듀스")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("GroupBy와 GroupByKey는 둘다 KGroupedStream을 반환하지만, GroupByKey는 KStream이 이미 null 이 아닌 키를 갖고 잇을 경우에 사용하고, GroupBy 메소드는 그룹화를 위한 키가 변경될 수 있다고 가정한다.\nGroupByKey는 리파티셔닝 필요 플래그가 설정되지 않고, GroupBy는 호출하면 조인 집계 등이 자동으로 리파티셔닝 된다.")])]),t._v(" "),n("ul",[n("li",[t._v("ShareVolume의 sum() 메소드를 살펴보자")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" csv1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" csv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" builder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("csv1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shares "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" csv1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shares "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" csv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shares"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[t._v("ShareVolue.sum()은 전체 거래량 집계를 제공하고, 전체 프로세싱 체인의 결과는 KTable<String, ShareVolume> 객체이다.")]),t._v(" "),n("li",[t._v("ShareVolume 객체가 들어오면 연관된 KTable은 가장 최근 업데이트를 유지한다.")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("집계 대신 리듀스를 사요앟는 이유는, 리듀스 작업은 같은 유형의 객체를 반환하지만, 집계는 다른 유형의 객체를 반환할 수 있기 때문이다.")])]),t._v(" "),n("ul",[n("li",[t._v("이제 이 KTable을 가져와서 상위 5개 집계(점유율에 의한)의 요약을 수행하는데 사용해 본다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 산업별로 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" 객체를 그룹화하는 또 다른 groupBy 작업을 수행하자"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),t._v(" 객체를 추가하자"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 이때 집계 객체는 고정 크기의 우선순위 큐다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 고정 크기 큐는\n거래량에 의한 상위 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("개 회사만 유지한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" 이 큐를 문자열로 매핑하고"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 거래량에 따른 산업별 상위 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("개 주식만 결과에 포함한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v(" 문자열 결과를 토픽에 쓴다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(337),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("위의 토폴로지는 산업별로 그룹화하고, 상위 5개만 집계해서 큐에 있는 상위 5개를 문자열로 매핑한 다음, 싱크 프로세서에서 토픽에 문자를 쓴다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Comparator")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" comparator "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sv1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" sv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getShares")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" sv1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getShares")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FixedSizePriorityQueue")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareVolume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" fixedQueue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FixedSizePriorityQueue")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("comparator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nshareVolume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeyValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pair")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIndustry")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shareVolumeSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 산업별 그룹화하고 필요한 serdes를 제공")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" fixedQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" agg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" agg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 집계의 메소드가 새 업데이트를 추가")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" agg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" agg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 집계의 remove 메소드가 기존 업데이트를 제거")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Materialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fixedSizePriorityQueueSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapValues")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("valueMapper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ValueMapper 인스턴스는 집계를 리포팅에 사용되는 문자열로 변환")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("peek")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n LOG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Stock volume by industry {} {}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stock-volume-by-company"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Produced")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("집계는 KTable 과 마찬가지로 같은 키로 업데이트된 레코드를 유일하게 만들어 준다.")]),t._v(" "),n("li",[t._v("같은 키가 있는 가장 최근 레코드를 집계한다.")]),t._v(" "),n("li",[t._v("레코드가 도착하면 이 레코드를 FixedSizePriorityQueue에 add 메소드로 추가하지만, 같은 키의 다른 레코드가 있다면 remove 메소드로 기존 레코드를 제거한다.")]),t._v(" "),n("li",[t._v("위의 예제를 보면 로컬 상태 저장소가 중요한지 알 수 있다. (로컬 상태는 이미 봤던 레코드를 추적 할 수 있게 한다.)")]),t._v(" "),n("li",[t._v("리듀스나 집계 연산을 실행할 때마다, 상태 저장소의 이름이 필요하다.")]),t._v(" "),n("li",[t._v("리듀스와 집계 연산은 KTable 인스턴스를 반환하고, 이 KTable은 기존 결과를 새 결과로 교체하기 위해 상태 저장소를 사용한다.")]),t._v(" "),n("li",[t._v("계속 본 것처럼 모든 업데이트가 다운스트림에 전달되는 것은 아니며, 집계 연산이 요약 정보를 모은다는 사실이 중요하다.")]),t._v(" "),n("li",[t._v("로컬 상태를 사용하지 않는다면, KTable은 모든 집계와 리듀스 결과를 전달 할 수밖에 없다.")])]),t._v(" "),n("h3",{attrs:{id:"_3-2-윈도-연산"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-윈도-연산"}},[t._v("#")]),t._v(" 3-2. 윈도 연산")]),t._v(" "),n("ul",[n("li",[t._v("어떠한 경우에는 주어진 시간 범위에 대해서만 작업을 수행할 필요도 있다.")])]),t._v(" "),n("h4",{attrs:{id:"고객별-주식-거래량-집계"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#고객별-주식-거래량-집계"}},[t._v("#")]),t._v(" 고객별 주식 거래량 집계")]),t._v(" "),n("ul",[n("li",[t._v("예제는 소수 거래자의 주식 거래를 추적해 볼 것이다.")]),t._v(" "),n("li",[t._v("추적을 위한 절차는 다음과 같다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 주식 거래 토픽을 읽어서 스트림을 만든다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 고객 ID와 주식 종목 코드별 유입 레코드를 그룹화한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" groupBy 호출은 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KGroupedStream")]),t._v(" 인스턴스를 반환\n한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" 윈도 스트림을 반환하기 위해 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KGroupedStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("windowedBy 메소드를 사용하면"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 특정 유형의 윈도 집계를\n수행할 수 있다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 제공한 윈도 타입에 따라 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeWindowedKStream")]),t._v(" 또는 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SessionWindowedKStream")]),t._v("을 반환\n받을 것이다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v(" 집계 연산을 위해 계산을 수행한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 윈도 스트림은 레코드를 이 계산에 포함할 것인지를 결정한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.")]),t._v(" 이 결과를 특정 토픽에 쓰거나"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 개발 중에는 콘솔에 결과를 출력한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(338),alt:"ks"}})]),t._v(" "),n("h4",{attrs:{id:"윈도-유형"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#윈도-유형"}},[t._v("#")]),t._v(" 윈도 유형")]),t._v(" "),n("ul",[n("li",[t._v("카프카 스트림즈에선 3가지 유형의 윈도를 사용할 수 있다.\n"),n("ul",[n("li",[t._v("세션 윈도")]),t._v(" "),n("li",[t._v("텀블링 윈도")]),t._v(" "),n("li",[t._v("슬라이딩 또는 호핑 윈도")])])])]),t._v(" "),n("h4",{attrs:{id:"세션-윈도"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#세션-윈도"}},[t._v("#")]),t._v(" 세션 윈도")]),t._v(" "),n("ul",[n("li",[t._v("시간에 엄격하게 제한받지 않고 사용자 활동과 관련이 이싿.")]),t._v(" "),n("li",[t._v("비활성화 기간으로 세션 윈도를 설명한다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(339),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("더 작은 세션은 비활성 구간이 짧기 때문에 왼쪽에 있는 세션에 병합될 것이다.")]),t._v(" "),n("li",[t._v("오른쪽에 있는 세션은 넓은 비활성 간격이 있으서 새로운 새션으로 분할 될 거싱다.")])]),t._v(" "),n("h4",{attrs:{id:"주식-거래-추적을-위한-세션-윈도-사용"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#주식-거래-추적을-위한-세션-윈도-사용"}},[t._v("#")]),t._v(" 주식 거래 추적을 위한 세션 윈도 사용")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serde")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" stringSerde "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serdes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serde")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" transactionSerde "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StreamsSerdes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StockTransactionSerde")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serde")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" transactionKeySerde "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StreamsSerdes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummarySerde")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" twentySeconds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" fifteenMinutes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Windowed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    customerTransactionCounts "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// groupBy와 count 호출로 생성된 KTable")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TRANSACTIONS_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withOffsetResetPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LATEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TransactionSummary 객체에 저장된 고객 ID와 주식 종목으로 레코드를 그룹화")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transactionKeySerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("windowedBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SessionWindows")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twentySeconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("until")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fifteenMinutes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 비활성 시간 20초, 유지시간 15분의 SessionWindow로 그룹을 윈도 처리한 다음, count()와 같은 집계를 수행")]),t._v("\n\n\ncustomerTransactionCounts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Printed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Windowed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toSysOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withLabel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Customer Transaction Counts"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("groupBy 연산을 할 때마다 일반적으로 일종의 집계 작업(집계, 리듀스, 카운트)을 수행한다.")]),t._v(" "),n("li",[t._v("이전 결과가 계속 축적되는 누적 집계를 수행하거나 지정된 시간 윈도 동안 레코드를 병합하는 윈도 집계를 수행할 수 있다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(340),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("windowedBy(SessionWindows.with(twentySeconds).until(fifteenMinutes))를 호출해 비활성 간격은 20초이고 유지 기간은 15분인 세션 윈도를 만든다.")]),t._v(" "),n("li",[t._v("20초의 비활성 시간은 현재 세션이 종료되거나 현재(활성) 세션 내의 시작 시간부터 20초 내에 도달하는 레코드를 어플리케이션이 포함한다는 뜻이다.")]),t._v(" "),n("li",[t._v("만약 들어오는 레코드가 비활성화 간격을 넘어선다면, 이 어플리케이션은 새 세션을 만든다.")]),t._v(" "),n("li",[t._v("세셔의 비활성화 기간 밖에 있더라도 병합이 가능한 경우라면 늦게 도착한 데이터도 병합을 허용한다.")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("도착순서")]),t._v(" "),n("th",[t._v("키")]),t._v(" "),n("th",[t._v("타임스탬프")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("1")]),t._v(" "),n("td",[t._v("{123-345-654,FFBE}")]),t._v(" "),n("td",[t._v("00:00:00")])]),t._v(" "),n("tr",[n("td",[t._v("2")]),t._v(" "),n("td",[t._v("{123-345-654,FFBE}")]),t._v(" "),n("td",[t._v("00:00:15")])]),t._v(" "),n("tr",[n("td",[t._v("3")]),t._v(" "),n("td",[t._v("{123-345-654,FFBE}")]),t._v(" "),n("td",[t._v("00:00:50")])]),t._v(" "),n("tr",[n("td",[t._v("4")]),t._v(" "),n("td",[t._v("{123-345-654,FFBE}")]),t._v(" "),n("td",[t._v("00:00:05")])])])]),t._v(" "),n("ul",[n("li",[t._v("레코드가 들어올 때, 같은 키가 있는 기존 세션이면서 '현재 타임스탬프 - 비활성 간격' 보다 작은 종료 시간을 갖고, '현재 타임스탬프 + 비활성 간격' 보다 더 큰 시작 시간을 갖는 세션을 찾는다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 레코드 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("은 첫 레코드이며"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 시작과 끝 시간은 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),t._v(" 이다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 레코드 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("가 도착하면 가장 이른 종료 시간 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("55")]),t._v("와 가장 늦은 시작 시간 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),t._v("를 가진 시간을 \n찾는다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 레코드 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("을 찾았기 때문에 세션 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("과 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("는 병합한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 세션 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" 시작 시간"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("가장 이른 시간"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("과 세션 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" 종료\n시간 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("최근"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("을 유지하므로"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 하나의 세션은 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),t._v("으로 시작해서 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("로 끝난다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" 레코드 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("이 도착하면"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("부터 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" 사이으 ㅣ세션을 찾아봐도 해당하는 세션이 없다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("345")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("654")]),t._v(" 키로 두 번째 세션을 추가하는데"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FFBE는 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("에 끝난다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.")]),t._v(" 레코드 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("가 도착하면 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),t._v("와 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" 사이의 세션을 검색한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 이번에는 세션 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("과 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" 둘 다 \n찾는다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 시작 시간이 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),t._v("이고 종료 시간이 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("00")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("인 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("개의 세션 모두 한 세션으로 병합된다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("ul",[n("li",[t._v("세션은 고정 크기 윈도가 아니다. 오히려 세션의 크기는 주어진 시간 프레임 내의 총 활성화 시간에 의해 결정된다.")]),t._v(" "),n("li",[t._v("데이터에 있어서 타임스탬프는 이벤트가 기존 세션에 맞는지 또는 비활성화 간격으로 나뉘는지 결정한다.")])]),t._v(" "),n("h4",{attrs:{id:"텀블링-윈도"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#텀블링-윈도"}},[t._v("#")]),t._v(" 텀블링 윈도")]),t._v(" "),n("ul",[n("li",[t._v("고정 또는 텀블링 윈도는 지정한 기간 내의 이벤트를 추적한다.")]),t._v(" "),n("li",[t._v("특정 회사의 전체 주식 거래를 20초마다 추적해야 하고, 그 시간 동안 모든 이베트를 수집한다고 하자.")]),t._v(" "),n("li",[t._v("20초가 경과하면 윈도는 다음 20초 감시주기로 '텀블링'한다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(341),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("이 윈도는 최근 20초 동안 들어온 개별 이벤트가 포함됐다. 새 윈도는 지정한 시간 후에 생성됐다.")]),t._v(" "),n("li",[t._v("지정된 기간 후에 텀블링 윈도는 초기화된다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Windowed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" customerTransactionCounts "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TRANSACTIONS_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                                            transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withOffsetResetPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LATEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transactionKeySerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("windowedBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeWindows")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("of")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twentySeconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("TimeWindows.of 를 호출하면 텀블링 윈도를 사용할 수 있다.")])]),t._v(" "),n("h4",{attrs:{id:"슬라이딩-또는-호핑-윈도"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#슬라이딩-또는-호핑-윈도"}},[t._v("#")]),t._v(" 슬라이딩 또는 호핑 윈도")]),t._v(" "),n("ul",[n("li",[t._v("텀블링 윈도와의 차이는 최근 이벤트를 처리할 새 윈도를 시작하기 전에 그 윈도 전체 시간을 기다리지 않는다.")]),t._v(" "),n("li",[t._v("슬라이딩 윈도는 전체 윈도 유지 기간보다는 더 짧은 간격 동안 기다린 후 새 연산을 수행한다.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(342),alt:"ks"}})]),t._v(" "),n("ul",[n("li",[t._v("왼쪽 박스는 첫 20초 윈도인데, 이 윈도는 새 윈도를 시작하기 위해 5초 뒤에 슬라이드하거나 업데이트 한다.")]),t._v(" "),n("li",[t._v("여기서는 겹쳐지는 이벤트를 보게 된다.")]),t._v(" "),n("li",[t._v("윈도 1은 [100, 200, 500, 400] 윈도 2는 [500, 400, 350, 600] 윈도 3은 [350,600,50,2500] 이다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Windowed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" customerTransactionCounts "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STOCK_TRANSACTIONS_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withOffsetResetPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LATEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transactionKeySerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("windowedBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeWindows")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("of")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twentySeconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("advanceBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiveSeconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("until")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fifteenMinutes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5초마다 이동하는 20초 간격의 호핑 윈도 사용")]),t._v("\n")])])]),n("ul",[n("li",[t._v("advanceBy() 메소드로 텀블링 윈도를 호핑 윈도로 변환할 수 있다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 세션 윈도는 시간에 의해 고정되지 않고"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 사용자 활동으로 유도된다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 텀플링 윈도는 지정된 시간 프레임 내에서 이벤트의 상황을 보게 한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" 호핑 윈도는 고정 길이이지만"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 자주 업데이트되며"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 개별 윈도에 겹치는 레코드가 들어 있을 수 있다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-3-kstream과-ktable-조인하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-kstream과-ktable-조인하기"}},[t._v("#")]),t._v(" 3-3. KStream과 KTable 조인하기")]),t._v(" "),n("ul",[n("li",[t._v("주식 거래 카운트를 가져와서 관련 산업 분야의 금융 뉴스와 조인해 보자")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" 주식 거래 카운트 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),t._v("을 키가 주식 종목인 산업별 카운트로 변경한 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),t._v("에 변환해 넣는다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 금융 관련 토픽 뉴스를 읽어 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),t._v("을 만든다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 새 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),t._v("은 산업별로 분류될 것이다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" 이 뉴스 업데이트를 산업별 주식 거래 카운트와 조인한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("h4",{attrs:{id:"ktable을-kstream으로-변환하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ktable을-kstream으로-변환하기"}},[t._v("#")]),t._v(" KTable을 KStream으로 변환하기")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 메소드를 호출한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" 키를 산업명으로 바꾸기 위해 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map 호출을 이용하고 윈도 인스턴스로부터 "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),t._v("\n객체를 추출한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KTable을 KStream으로 변환하기")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" countStream "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \n    customerTransactionCounts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// toStream 후 바로 map 호출")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),t._v(" transactionSummary "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" newKey "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" transactionSummary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIndustry")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 키를 주식 구매의 산업 분야로 설정")]),t._v("\n        transactionSummary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSummaryCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeyValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pair")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionSummary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// KStream을 위한 새 KeyValue 쌍 반환")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h4",{attrs:{id:"금융-뉴스-ktable-만들기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#금융-뉴스-ktable-만들기"}},[t._v("#")]),t._v(" 금융 뉴스 KTable 만들기")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" financialNews "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("table")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"financial-news"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EARLIEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// EARLIEST 속성을 사용해 financial-news 토픽으로 KTable 만듬")]),t._v("\n")])])]),n("h4",{attrs:{id:"뉴스-업데이트를-트랜잭션-카운트와-조인하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#뉴스-업데이트를-트랜잭션-카운트와-조인하기"}},[t._v("#")]),t._v(" 뉴스 업데이트를 트랜잭션 카운트와 조인하기")]),t._v(" "),n("ul",[n("li",[t._v("조인은 다음과 같이 진행한다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueJoiner")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" valueJoiner "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txnct"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" news"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%d shares purchased %s related news [%s]"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    txnct"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSummaryCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txnct"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStockTicker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" news"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ValueJoiner는 조인 결과로부터 값을 결합한다.")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" joined "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    countStream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("leftJoin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("financialNews"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" valueJoiner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Joined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionKeySerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// countStream KStream과 금융 뉴스 KTable 조인")]),t._v("\n\n    joined"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Printed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toSysOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withLabel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Transactions and News"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-4-globalktable"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-globalktable"}},[t._v("#")]),t._v(" 3-4. GlobalKTable")]),t._v(" "),n("ul",[n("li",[t._v("조인을 할 경우에, 키를 새 타입이나 값으로 매핑할 때 스트림 리파티셔닝이 필요하다.")])]),t._v(" "),n("h4",{attrs:{id:"리파티셔닝-비용"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#리파티셔닝-비용"}},[t._v("#")]),t._v(" 리파티셔닝 비용")]),t._v(" "),n("ul",[n("li",[t._v("리파티셔닝은 오버헤드가 있고, 다른 토픽에 중복 데이터를 저장하는 중간 토픽을 만들어 다른 토픽에서 읽어서 쓰기 때문에 지연 시간을 증가시킨다.")])]),t._v(" "),n("h4",{attrs:{id:"더-작은-데이터-집합과-조인하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#더-작은-데이터-집합과-조인하기"}},[t._v("#")]),t._v(" 더 작은 데이터 집합과 조인하기")]),t._v(" "),n("ul",[n("li",[t._v("어떤 경우 조인하려는 룩업 데이터는 비교적 작아서 이 조회 데이터 전체 사본을 개별 노드의 로컬에 배치할 수 있다.")]),t._v(" "),n("li",[t._v("조회 데이터가 상당히 작을 경우 카프카 스트림즈는 GlobalKTable을 사용할 수 있다.")]),t._v(" "),n("li",[t._v("어플리케이션이 모든 데이터를 각 노드에 동이하게 복제하기 때문에 GlobalKTable은 모두 같은 데이터를 갖는다.")]),t._v(" "),n("li",[t._v("전체 데이터가 개별 노드에 있기 때문에 이벤트 스트림은 모든 파티션에 데이터를 공급하기 위해 조회할 데이터 키로 파티셔닝할 필요가 없다.")]),t._v(" "),n("li",[t._v("또한 GlobalKTable은 키없는 조인이 가능하다.")])]),t._v(" "),n("h4",{attrs:{id:"globalktable로-kstream-조인하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#globalktable로-kstream-조인하기"}},[t._v("#")]),t._v(" GlobalKTable로 KStream 조인하기")]),t._v(" "),n("ul",[n("li",[t._v("countStream을 사용해 두 GlobalKTable과 조인하는 예시")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 세션 윈도를 사용한 주식 거래 집계")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KStream")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" countStream "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" STOCK_TRANSACTIONS_TOPIC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withOffsetResetPolicy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LATEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transaction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serialized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transactionSummarySerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactionSerde"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("windowedBy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SessionWindows")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twentySeconds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("transactionMapper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("두 개의 GlobalKTable을 정의한다.")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalKTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" publicCompanies "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("globalTable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("COMPANIES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("topicName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalKTable")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" clients "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    builder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("globalTable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CLIENTS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("topicName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("countStream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("leftJoin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("publicCompanies"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n    txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStockTicker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withCompanyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 주식 종목 코드를 키로 하는 publicCompanies와 leftJoin을 설정하고, 회사 이름이 추가된 transactionSummary 반환")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("leftJoin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("clients"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("\n    txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCustomerId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withCustomerName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 고객 ID를 키로 하는 clients 테이블과 leftJoin을 설정하고, 고객 이름이 추가된 transactionSummary 반환 ")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Printed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TransactionSummary")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toSysOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("withLabel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Resolved Transaction Summaries"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("위의 조인을 실행하면")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("customerId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'074-09-3705'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stockTicker"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GUTM'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("customerId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'037-34-5184'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stockTicker"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CORK'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\n")])])]),n("ul",[n("li",[t._v("이랬던 결과가")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("customer"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Barney, Smith'")]),t._v(" company"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Exxon"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transactions"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[t._v("이렇게 보기 좋게 나온다.")])]),t._v(" "),n("hr"),t._v(" "),n("ul",[n("li",[t._v("카프카 스트림즈의 조인은 다음과 같다")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("왼쪽 조인")]),t._v(" "),n("th",[t._v("내부 조인")]),t._v(" "),n("th",[t._v("외부 조인")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("KStream - KStream")]),t._v(" "),n("td",[t._v("KStream - KStream")]),t._v(" "),n("td",[t._v("KStream - KStream")])]),t._v(" "),n("tr",[n("td",[t._v("KStream - KTable")]),t._v(" "),n("td",[t._v("KStream - KTable")]),t._v(" "),n("td",[t._v("N/A")])]),t._v(" "),n("tr",[n("td",[t._v("KTable - KTable")]),t._v(" "),n("td",[t._v("KTable - KTable")]),t._v(" "),n("td",[t._v("KTable - KTable")])]),t._v(" "),n("tr",[n("td",[t._v("KStream - GlobalKTable")]),t._v(" "),n("td",[t._v("KStream - GlobalKTable")]),t._v(" "),n("td",[t._v("N/A")])])])]),t._v(" "),n("h3",{attrs:{id:"_3-5-쿼리-가능-상태"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-쿼리-가능-상태"}},[t._v("#")]),t._v(" 3-5. 쿼리 가능 상태")]),t._v(" "),n("ul",[n("li",[t._v("토픽에서 데이터를 읽는 것은 구체화된 뷰(materialized view)의 한 형태로 생각해 볼 수 있다.")]),t._v(" "),n("li",[t._v("카프카 스트림즈는 상태 저장소로부터 대화형 쿼리도 제공하는데, 이러한 구체화된 뷰에서 직접 데이터를 읽는 기능을 제공한다.")]),t._v(" "),n("li",[t._v("상태 저장소는 읽기 전용이므로, 읽기 전용 쿼리를 만들면 어플리케이션이 데이터를 연속적으로 처리하는 동안 상태 불일치 발생은 걱정할 필요가 없다.")]),t._v(" "),n("li",[t._v("상태 저장소를 쿼리 가능하게 만드는 것은 상당히 중요하다.")]),t._v(" "),n("li",[t._v("카프카 컨슈머에서 데이터를 소비하지 않고도 대시보드 어플리케이션을 만들 수 있다.")]),t._v(" "),n("li",[t._v("데이터를 다시 쓰지도 않아서 효율성도 증가한다.\n"),n("ul",[n("li",[t._v("이 데이터는 로컬에 있기 때문에 매우 빠르게 접근할 수 있다.")]),t._v(" "),n("li",[t._v("외부 저장소로 복사하지 않으므로 데이터 중복을 피할 수 있다.")])])]),t._v(" "),n("li",[t._v("상태 저장소에 직접 쿼리한다는 것은 코드양을 줄이고(컨슈머가 필요 없음) 필요한 소프트웨어 개수를 줄인다는 (결과를 저장할 디비가 필요 없음) 의미가 된다.")])]),t._v(" "),n("h2",{attrs:{id:"요약"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#요약"}},[t._v("#")]),t._v(" 요약")]),t._v(" "),n("ul",[n("li",[t._v("KStream은 데이터베이스에 삽입하는 것과 비슷한 이벤트 스트림을 나타낸다. KTable은 업데이트 스트림이고 데이터베이스에 변경하는 것과 비슷하다. KTable 크기는 계속 증가하지 않으며, 기존 레코드는 새 레코드로 교체된다.")]),t._v(" "),n("li",[t._v("KTable은 집계 작업이 필요하다.")]),t._v(" "),n("li",[t._v("윈도 연산으로 시간 버킷에 데이터를 집계해서 넣을 수 있다.")]),t._v(" "),n("li",[t._v("GlobalKTable은 파티션에 대한 고려 없이 어플리케이션 전체에 걸쳐 조회 데이터를 제공한다.")]),t._v(" "),n("li",[t._v("KStream, KTable, GLobalTable과 서로서로 조인 할 수 있다.")])])])}),[],!1,null,null,null);s.default=e.exports}}]);